# **üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –°–û–ó–î–ê–ù–ò–ï –ë–ê–ó–û–í–û–ô –°–¢–†–£–ö–¢–£–†–´ –ü–†–û–ï–ö–¢–ê (–§–ê–ó–ê 0)**
–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ FastAgain —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó: —Å–æ–∑–¥–∞–Ω–∏–µ –¥–≤—É—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–±—ç–∫–µ–Ω–¥ Python/FastAPI –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ React/TypeScript), –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö C0 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞):
```
[‚úÖ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
[‚¨ú] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
```

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:

### 1. **–ë—ç–∫–µ–Ω–¥ (Python/FastAPI) - `fastagain-backend/`**:
```
fastagain-backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ core/                # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Pydantic Settings
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py      # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ PostgreSQL
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py      # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py  # FastAPI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ models/              # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py          # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (C2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ project_wallet.py # –ú–æ–¥–µ–ª—å –∫–æ—à–µ–ª—å–∫–æ–≤ —Ñ–æ–Ω–¥–∞ (C3)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_cycle.py    # –ú–æ–¥–µ–ª—å —Ü–∏–∫–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (C2)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction.py   # –ú–æ–¥–µ–ª—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (C3)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ support_ticket.py # –ú–æ–¥–µ–ª—å —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (C1)
‚îÇ   ‚îú‚îÄ‚îÄ schemas/             # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py          # –°—Ö–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wallet.py        # –°—Ö–µ–º—ã –∫–æ—à–µ–ª—å–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ api/                 # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ v1/              # API –≤–µ—Ä—Å–∏—è 1
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ endpoints/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health.py  # Health check (C0)
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (C2)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ api.py        # –†–æ—É—Ç–µ—Ä API v1
‚îÇ       ‚îî‚îÄ‚îÄ dependencies.py  # API –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ alembic/                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îú‚îÄ‚îÄ env.py
‚îÇ   ‚îî‚îÄ‚îÄ alembic.ini
‚îú‚îÄ‚îÄ requirements/
‚îÇ   ‚îú‚îÄ‚îÄ base.txt            # –ë–∞–∑–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ dev.txt             # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ prod.txt            # –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
‚îú‚îÄ‚îÄ tests/                  # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
‚îÇ   ‚îî‚îÄ‚îÄ test_health.py      # –¢–µ—Å—Ç—ã health check
‚îú‚îÄ‚îÄ .env.example            # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ (PostgreSQL, Redis)
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ Makefile               # –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ pyproject.toml         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Python
‚îî‚îÄ‚îÄ README.md
```

### 2. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (React/TypeScript) - `fastagain-frontend/`**:
```
fastagain-frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ React
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx            # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ App.css            # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ vite-env.d.ts      # –¢–∏–ø—ã Vite
‚îÇ   ‚îú‚îÄ‚îÄ components/        # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button/    # –ö–Ω–æ–ø–∫–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.test.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts   # –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îú‚îÄ‚îÄ pages/             # –°—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.tsx       # –î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotFound.tsx   # 404 —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ hooks/             # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTheme.ts    # –•—É–∫ —Ç–µ–º—ã (–¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞)
‚îÇ   ‚îú‚îÄ‚îÄ services/          # API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts         # –ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.ts      # Health check API
‚îÇ   ‚îú‚îÄ‚îÄ styles/            # –°—Ç–∏–ª–∏ Tailwind
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css    # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ theme.ts       # –¢–µ–º–∞ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ types/             # TypeScript —Ç–∏–ø—ã
‚îÇ       ‚îî‚îÄ‚îÄ api.ts         # –¢–∏–ø—ã API
‚îú‚îÄ‚îÄ public/                # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ vite.svg
‚îÇ   ‚îî‚îÄ‚îÄ favicon.ico
‚îú‚îÄ‚îÄ .env.example           # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ tailwind.config.js     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind (–¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞)
‚îú‚îÄ‚îÄ postcss.config.js
‚îú‚îÄ‚îÄ tsconfig.json          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
‚îú‚îÄ‚îÄ tsconfig.node.json
‚îú‚îÄ‚îÄ vite.config.ts         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vite
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ README.md
```

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨:

### **1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–µ–Ω–¥–∞:**
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π –∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±—ç–∫–µ–Ω–¥–∞
cd fastagain-backend

# –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π .env —Ñ–∞–π–ª:
# SECRET_KEY=your-secret-key-here
# DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/fastagain
# REDIS_URL=redis://localhost:6379/0

# –ó–∞–ø—É—Å—Ç–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (PostgreSQL + Redis)
docker-compose up -d

# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
python -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
pip install -r requirements/dev.txt

# –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
alembic upgrade head

# –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**
```bash
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø–µ—Ä–µ–π–¥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
cd fastagain-frontend

# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å –±—ç–∫–µ–Ω–¥
curl http://localhost:8000/api/v1/health
# –û—Ç–≤–µ—Ç: {"status":"ok","timestamp":"2024-01-23T12:00:00Z"}

# –ü—Ä–æ–≤–µ—Ä—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
# –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000
```

---

## üìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:
1. **–°–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó**: C3 ‚Üí C2 ‚Üí C1 ‚Üí C0
2. **–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UserService (C2) —Å –º–æ–¥–µ–ª—è–º–∏ –∏ —Å—Ö–µ–º–∞–º–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (/api/v1/auth/register) –∏ –≤—Ö–æ–¥–∞ (/api/v1/auth/login)
4. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Registration –∏ Login —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π API

---

## ü§ñ –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–§–∞–∑–∞ 0 –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: –±—ç–∫–µ–Ω–¥ (Python/FastAPI) –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (React/TypeScript)
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è (PostgreSQL + Redis –¥–ª—è –±—ç–∫–µ–Ω–¥–∞)
‚úÖ –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (User, ProjectWallet, UserCycle, Transaction, SupportTicket)
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω health check —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –±—ç–∫–µ–Ω–¥–∞
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow" –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (Tailwind CSS, —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã)
‚úÖ –°–æ–∑–¥–∞–Ω UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Button —Å 4 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –°–û–ó–î–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó):

**C3 - MISSION-CRITICAL:**
1. ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ - TransactionService
2. ‚ùå –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ - WalletService
3. ‚ùå –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - AuthService
4. ‚ùå –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ReferralService

**C2 - BUSINESS-CRITICAL:**
1. ‚ùå –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - UserService (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)
2. ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ - ReferralService
3. ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞–º–∏ - CycleService
4. ‚ùå –û—á–µ—Ä–µ–¥–∏ –∏ —Å–ª–æ—Ç—ã - QueueService

**C1 - IMPORTANT:**
1. ‚ùå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ)
2. ‚¨ú UI-–ª–æ–≥–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–∞—á–∞—Ç–∞: Button –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
3. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - NotificationService
4. ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - AdminService (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
5. ‚ùå –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ - SupportService

**C0 - UTILITY:**
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.env, docker-compose.yml)
3. ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞)

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C2 ‚Üí C3):
**–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UserService (C2) –∏ AuthService (C2) —Å –ø–æ–ª–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π JWT:**
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–æ–¥–µ–ª–∏ User –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
2. –°–æ–∑–¥–∞—Ç—å Pydantic —Å—Ö–µ–º—ã –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –≤—Ö–æ–¥–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UserService —Å –º–µ—Ç–æ–¥–∞–º–∏: create_user, get_user_by_email, update_user_status
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AuthService —Å –º–µ—Ç–æ–¥–∞–º–∏: authenticate_user, create_access_token, verify_token
5. –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: POST /api/v1/auth/register, POST /api/v1/auth/login
6. –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ JWT –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
7. –°–æ–∑–¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Registration –∏ Login —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π API

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0, aiotrond
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Framer Motion, Lucide React, React Query, Zustand
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞ –¥–æ–≤–µ—Ä–∏—è, Inter —à—Ä–∏—Ñ—Ç)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏:** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ WalletService
- **–¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–æ–≤:** 24 —á–∞—Å–∞, —Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis (–∫—ç—à), –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –≤ PostgreSQL
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è (webhook ‚Üí polling ‚Üí manual review)

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```
fastagain-backend/                    # –ë—ç–∫–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config.py, database.py, security.py
‚îÇ   ‚îú‚îÄ‚îÄ models/         # user.py, transaction.py, cycle.py, project_wallet.py, support_ticket.py
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # Pydantic —Å—Ö–µ–º—ã (–Ω–∞—á–∞—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (health, auth - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îî‚îÄ‚îÄ main.py         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ requirements/       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ docker-compose.yml  # PostgreSQL 15, Redis 7, –±—ç–∫–µ–Ω–¥
‚îî‚îÄ‚îÄ .env.example        # SECRET_KEY, DATABASE_URL, REDIS_URL, TRON_API_KEY

fastagain-frontend/                    # –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI-KIT: Button (–≥–æ—Ç–æ–≤), –¥—Ä—É–≥–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # –≠–∫—Ä–∞–Ω—ã: Home, NotFound (–Ω–∞—á–∞—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # useTheme (–≥–æ—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ services/      # API –∫–ª–∏–µ–Ω—Ç—ã (–Ω–∞—á–∞—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ styles/        # Tailwind config, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ React
‚îú‚îÄ‚îÄ tailwind.config.js # –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow"
‚îú‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ React
‚îî‚îÄ‚îÄ tsconfig.json     # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
**–ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥):**
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏ –±—ç–∫–µ–Ω–¥
cd fastagain-backend
cp .env.example .env
# –¥–æ–±–∞–≤—å SECRET_KEY, DATABASE_URL, REDIS_URL, TRON_API_KEY –≤ .env
docker-compose up -d
pip install -r requirements/dev.txt
alembic upgrade head
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 2. –ó–∞–ø—É—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª)
cd ../fastagain-frontend
npm install
npm run dev

# 3. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É
curl http://localhost:8000/api/v1/health  # –ë—ç–∫–µ–Ω–¥
# –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000  # –§—Ä–æ–Ω—Ç–µ–Ω–¥
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
- üìÑ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: **TZ Disign Fast Again Python.txt** (—ç—Ç–∞–ª–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è 3.0 —Å –¥–∏–∑–∞–π–Ω–æ–º)
- üó∫Ô∏è –≠—Ç–∞ —É–º–Ω–∞—è –∫–∞—Ä—Ç–∞: **–°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt**
- üìù –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç: [—ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç - –ø–µ—Ä–≤—ã–π –≤ —Ü–µ–ø–æ—á–∫–µ]
- üé® Figma —Ñ–∞–π–ª: design.fastagain.io (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —ç–∫—Ä–∞–Ω—ã)
- üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs (–±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞)



# üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø WALLETSERVICE (C3 - MISSION-CRITICAL)
–ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ WalletService –¥–ª—è 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞):
```
[‚úÖ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
[üü®] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë 50%
[‚¨ú] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
[‚¨ú] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%
```

---

## üìÅ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:

### 1. **–ë—ç–∫–µ–Ω–¥ (Python/FastAPI) - `fastagain-backend/`**:

**`fastagain-backend/requirements/base.txt`** - –î–û–ë–ê–í–õ–ï–ù–û –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
asyncpg==0.29.0
alembic==1.12.1
pydantic[email]==2.5.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
redis==5.0.1
aiosqlite==0.19.0
httpx==0.25.1
python-multipart==0.0.6
structlog==23.2.0
base58==2.1.1  # –î–õ–Ø –í–ê–õ–ò–î–ê–¶–ò–ò TRON –ê–î–†–ï–°–û–í
ecdsa==0.18.0  # –î–õ–Ø –ö–†–ò–ü–¢–û–ì–†–ê–§–ò–ß–ï–°–ö–ò–• –û–ü–ï–†–ê–¶–ò–ô
```

**`fastagain-backend/app/core/exceptions.py`** - –ò–°–ü–†–ê–í–õ–ï–ù–û –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–æ:
```python
"""
–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è WalletService –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞–∑–¥–µ–ª—É 14.1
"""

from typing import Optional, Dict, Any

class FastAgainException(Exception):
    """–ë–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ FastAgain"""
    def __init__(self, code: str, message: str, details: Optional[Dict[str, Any]] = None):
        self.code = code
        self.message = message
        self.details = details or {}
        super().__init__(self.message)

    def to_dict(self) -> Dict[str, Any]:
        """–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ —Å–ª–æ–≤–∞—Ä—å –¥–ª—è API –æ—Ç–≤–µ—Ç–∞"""
        return {
            "code": self.code,
            "message": self.message,
            "details": self.details
        }

class WalletValidationError(FastAgainException):
    """–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–∞"""
    def __init__(self, code: str, message: str, details: Optional[Dict[str, Any]] = None):
        super().__init__(code, message, details)

class ExchangeWalletError(WalletValidationError):
    """–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–∏—Ä–∂–µ–≤–æ–π –∫–æ—à–µ–ª–µ–∫"""
    def __init__(self, code: str, message: str, exchange_info: str, details: Optional[Dict[str, Any]] = None):
        details = details or {}
        details["exchange_info"] = exchange_info
        super().__init__(code, message, details)
        self.exchange_info = exchange_info

class WalletAlreadyBoundError(WalletValidationError):
    """–ö–æ—à–µ–ª–µ–∫ —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    def __init__(self, code: str, message: str, wallet_address: str, details: Optional[Dict[str, Any]] = None):
        details = details or {}
        details["wallet_address"] = wallet_address
        super().__init__(code, message, details)
        self.wallet_address = wallet_address

class AuthenticationError(FastAgainException):
    """–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"""
    def __init__(self, code: str = "AUTHENTICATION_FAILED", 
                 message: str = "Authentication failed", 
                 details: Optional[Dict[str, Any]] = None):
        super().__init__(code, message, details)

class AuthorizationError(FastAgainException):
    """–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    def __init__(self, code: str = "UNAUTHORIZED", 
                 message: str = "You don't have permission to perform this action", 
                 details: Optional[Dict[str, Any]] = None):
        super().__init__(code, message, details)

class ResourceNotFoundError(FastAgainException):
    """–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"""
    def __init__(self, code: str = "RESOURCE_NOT_FOUND", 
                 message: str = "The requested resource was not found", 
                 details: Optional[Dict[str, Any]] = None):
        super().__init__(code, message, details)

class ValidationError(FastAgainException):
    """–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö"""
    def __init__(self, code: str = "VALIDATION_ERROR", 
                 message: str = "Validation failed", 
                 details: Optional[Dict[str, Any]] = None):
        super().__init__(code, message, details)

class RateLimitError(FastAgainException):
    """–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤"""
    def __init__(self, code: str = "RATE_LIMIT_EXCEEDED", 
                 message: str = "Too many requests", 
                 details: Optional[Dict[str, Any]] = None):
        super().__init__(code, message, details)
```

**`fastagain-backend/app/core/config.py`** - –ò–°–ü–†–ê–í–õ–ï–ù–û –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–æ:
```python
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic Settings
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
"""

from typing import Optional
from pydantic_settings import BaseSettings
from pydantic import validator

class Settings(BaseSettings):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    
    # API
    API_V1_STR: str = "/api/v1"
    PROJECT_NAME: str = "FastAgain"
    VERSION: str = "1.0.0"
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    SECRET_KEY: str = "your-secret-key-here-change-in-production"
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 15
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    DATABASE_URL: str = "postgresql+asyncpg://user:password@localhost:5432/fastagain"
    
    # Redis
    REDIS_URL: str = "redis://localhost:6379/0"
    REDIS_PASSWORD: Optional[str] = None
    
    # TRON API
    TRONGRID_API_KEY: Optional[str] = None
    TRONGRID_API_URL: str = "https://api.trongrid.io"
    TRON_NODE_URL: str = "https://api.trongrid.io"
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    DEBUG: bool = True
    LOG_LEVEL: str = "INFO"
    
    # –ö–æ—à–µ–ª—å–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
    MIN_PROJECT_WALLETS: int = 1
    MAX_PROJECT_WALLETS: int = 100
    
    # Rate limiting
    RATE_LIMIT_PER_MINUTE: int = 60
    RATE_LIMIT_PER_HOUR: int = 1000
    
    # Email
    SMTP_HOST: Optional[str] = None
    SMTP_PORT: Optional[int] = None
    SMTP_USER: Optional[str] = None
    SMTP_PASSWORD: Optional[str] = None
    EMAILS_FROM_EMAIL: Optional[str] = None
    
    # Frontend
    FRONTEND_URL: str = "http://localhost:3000"
    
    # CORS
    BACKEND_CORS_ORIGINS: list = ["http://localhost:3000", "http://localhost:8000"]
    
    @validator("BACKEND_CORS_ORIGINS", pre=True)
    def assemble_cors_origins(cls, v):
        if isinstance(v, str):
            return [i.strip() for i in v.split(",")]
        return v
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

**`fastagain-backend/app/core/database.py`** - –ò–°–ü–†–ê–í–õ–ï–ù–û:
```python
"""
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL —Å SQLAlchemy 2.0
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è FastAPI
"""

from typing import AsyncGenerator
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker
from sqlalchemy.orm import DeclarativeBase
from app.core.config import settings

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ SQLAlchemy
engine = create_async_engine(
    settings.DATABASE_URL,
    echo=settings.DEBUG,  # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –≤ DEBUG —Ä–µ–∂–∏–º–µ
    pool_pre_ping=True,   # –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    pool_recycle=3600,    # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 3600 —Å–µ–∫—É–Ω–¥
)

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—Å–∏–π
AsyncSessionLocal = async_sessionmaker(
    engine,
    class_=AsyncSession,
    expire_on_commit=False,
    autocommit=False,
    autoflush=False,
)

class Base(DeclarativeBase):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π SQLAlchemy"""
    pass

async def get_db() -> AsyncGenerator[AsyncSession, None]:
    """
    Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö FastAPI.
    """
    async with AsyncSessionLocal() as session:
        try:
            yield session
            await session.commit()
        except Exception:
            await session.rollback()
            raise
        finally:
            await session.close()

async def create_tables():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)"""
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

async def drop_tables():
    """–£–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)"""
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.drop_all)
```

**`fastagain-backend/app/services/wallet_service.py`** - –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û:
```python
"""
WalletService - C3 MISSION-CRITICAL –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –í–∞–ª–∏–¥–∞—Ü–∏—è TRC-20 –∞–¥—Ä–µ—Å–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏, –ø—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
–£—Ä–æ–≤–µ–Ω—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: P3 (unit-—Ç–µ—Å—Ç—ã + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã + property-based —Ç–µ—Å—Ç—ã)
"""

import re
import base58
import hashlib
from typing import Optional, Tuple, Dict, Any
from datetime import datetime, timezone
import httpx
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, and_
import logging

from app.models.user import User
from app.core.database import AsyncSessionLocal
from app.core.config import settings
from app.core.exceptions import (
    WalletValidationError,
    ExchangeWalletError,
    WalletAlreadyBoundError,
    ValidationError
)

logger = logging.getLogger(__name__)

class WalletService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—à–µ–ª—å–∫–∞–º–∏ TRON"""
    
    # –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ TRC-20 –∞–¥—Ä–µ—Å–æ–≤
    TRC20_ADDRESS_REGEX = re.compile(r'^T[1-9A-HJ-NP-Za-km-z]{33}$')
    
    # –°–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–∏—Ä–∂–µ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ (–ø—Ä–µ—Ñ–∏–∫—Å—ã –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–¥—Ä–µ—Å–∞)
    EXCHANGE_WALLET_PREFIXES = {
        'TX': 'Binance',  # Binance –≥–æ—Ä—è—á–∏–µ –∫–æ—à–µ–ª—å–∫–∏
        'TL': 'Binance',  # Binance —Ö–æ–ª–æ–¥–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏
        'TW': 'TronWallet',  # TronWallet
        'TC': 'Crypto.com',  # Crypto.com
        'TK': 'KuCoin',  # KuCoin
        'TH': 'Huobi',  # Huobi
    }
    
    EXCHANGE_SPECIFIC_ADDRESSES = {
        'TNDhqba7v1f6ER7z1dFZCbP7hF2nH2tU2J': 'Binance Main Hot Wallet',
        'TQrY8tryqsYVCYS3MFbtffiPp2ccyn4STm': 'Binance Withdrawal Wallet',
        'TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7': 'Binance Cold Wallet 1',
        'TWGpH5bGBs7C1W3eJnRUW5s4w16pf5w9Zk': 'TronWallet Exchange',
        'TFrEcuRuQpX9diZfMspw3q6rE3VZXkCq9d': 'Crypto.com Hot Wallet',
        'TJDxUyqLqwn4FpLNpQHJgDN2n3pc13FJYk': 'KuCoin Hot Wallet',
    }
    
    def __init__(self, db_session: Optional[AsyncSession] = None):
        self.db_session = db_session or AsyncSessionLocal()
    
    async def validate_tron_address(self, address: str) -> Dict[str, Any]:
        """
        –í–∞–ª–∏–¥–∞—Ü–∏—è TRC-20 –∞–¥—Ä–µ—Å–∞ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        Proof-Level: P3 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)
        
        Args:
            address: TRC-20 –∞–¥—Ä–µ—Å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            
        Returns:
            Dict —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            
        Raises:
            WalletValidationError: –µ—Å–ª–∏ –∞–¥—Ä–µ—Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π
        """
        logger.info(f"Starting wallet validation: {address}")
        
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (–±–∞–∑–æ–≤–∞—è —Ä–µ–≥—É–ª—è—Ä–∫–∞)
        if not self.TRC20_ADDRESS_REGEX.match(address):
            logger.error(f"Invalid TRC-20 address format: {address}")
            raise WalletValidationError(
                code="INVALID_TRC20_FORMAT",
                message="Invalid TRC-20 address format. Must start with 'T' and be 34 characters long.",
                details={"address": address}
            )
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã Base58Check
        if not self._validate_base58_checksum(address):
            logger.error(f"Invalid Base58Check checksum for address: {address}")
            raise WalletValidationError(
                code="INVALID_CHECKSUM",
                message="Invalid address checksum. The address may contain typos.",
                details={"address": address}
            )
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∏—Ä–∂–µ–≤–æ–π –∫–æ—à–µ–ª–µ–∫
        is_exchange, exchange_info = await self.check_exchange_wallet(address)
        if is_exchange:
            logger.warning(f"Exchange wallet detected: {address} - {exchange_info}")
            raise ExchangeWalletError(
                code="EXCHANGE_WALLET_DETECTED",
                message=f"Exchange wallets are not allowed. Detected: {exchange_info}",
                exchange_info=exchange_info,
                details={"address": address, "exchange": exchange_info}
            )
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ
        is_duplicate = await self._check_wallet_duplicate(address)
        if is_duplicate:
            logger.error(f"Wallet already used in system: {address}")
            raise WalletAlreadyBoundError(
                code="WALLET_ALREADY_BOUND",
                message="This wallet is already bound to another active user.",
                wallet_address=address,
                details={"address": address}
            )
        
        # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ TronGrid API)
        is_active = await self._check_blockchain_activity(address)
        
        logger.info(f"Wallet validation successful: {address}")
        return {
            "valid": True,
            "address": address,
            "is_exchange": False,
            "is_active": is_active,
            "checksum_valid": True,
            "message": "Wallet address is valid and ready for binding."
        }
    
    def _validate_base58_checksum(self, address: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã Base58Check –¥–ª—è TRON –∞–¥—Ä–µ—Å–∞
        TRON –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Base58Check —Å –≤–µ—Ä—Å–∏–µ–π 0x41
        """
        try:
            # –î–µ–∫–æ–¥–∏—Ä—É–µ–º Base58
            decoded = base58.b58decode(address)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É (25 –±–∞–π—Ç: 1 –±–∞–π—Ç –≤–µ—Ä—Å–∏–∏ + 20 –±–∞–π—Ç payload + 4 –±–∞–π—Ç–∞ checksum)
            if len(decoded) != 25:
                return False
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é (0x41 –¥–ª—è TRON)
            version = decoded[0]
            if version != 0x41:  # 0x41 = 65 –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–π = 'T' –≤ Base58
                return False
            
            # –í—ã—á–∏—Å–ª—è–µ–º checksum
            payload = decoded[:-4]
            checksum = decoded[-4:]
            
            # –í—ã—á–∏—Å–ª—è–µ–º –¥–≤–æ–π–Ω–æ–π SHA256
            hash1 = hashlib.sha256(payload).digest()
            hash2 = hashlib.sha256(hash1).digest()
            
            # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 4 –±–∞–π—Ç–∞ —Å checksum
            return checksum == hash2[:4]
            
        except Exception as e:
            logger.error(f"Base58Check validation error: {e}")
            return False
    
    async def check_exchange_wallet(self, address: str) -> Tuple[bool, Optional[str]]:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –∫–æ—à–µ–ª–µ–∫ –±–∏—Ä–∂–µ
        Proof-Level: P3 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
        
        Args:
            address: TRC-20 –∞–¥—Ä–µ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
        Returns:
            Tuple[bool, Optional[str]]: (—è–≤–ª—è–µ—Ç—Å—è –ª–∏ –±–∏—Ä–∂–µ–≤—ã–º, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∏—Ä–∂–µ)
        """
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞–º
        prefix = address[:2]
        if prefix in self.EXCHANGE_WALLET_PREFIXES:
            return True, f"{self.EXCHANGE_WALLET_PREFIXES[prefix]} exchange wallet"
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∞–¥—Ä–µ—Å–∞–º
        if address in self.EXCHANGE_SPECIFIC_ADDRESSES:
            return True, self.EXCHANGE_SPECIFIC_ADDRESSES[address]
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π API (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
        if settings.TRONGRID_API_KEY:
            try:
                return await self._check_exchange_via_api(address)
            except Exception as e:
                logger.warning(f"Error checking wallet via API: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ API –ø—Ä–æ–≤–µ—Ä–∫–∏
        
        return False, None
    
    async def _check_exchange_via_api(self, address: str) -> Tuple[bool, Optional[str]]:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π API (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
        """
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∏—Ä–∂–µ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
        # –ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ TronGrid API –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
        return False, None
    
    async def bind_wallet(self, user_id: int, wallet_address: str) -> Dict[str, Any]:
        """
        –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        Proof-Level: P3 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            wallet_address: TRC-20 –∞–¥—Ä–µ—Å –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏
            
        Returns:
            Dict —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏
        """
        async with self.db_session.begin():
            # 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
            validation_result = await self.validate_tron_address(wallet_address)
            
            # 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user = await self._get_user_by_id(user_id)
            if not user:
                raise ValidationError(
                    code="USER_NOT_FOUND",
                    message=f"User with ID {user_id} not found",
                    details={"user_id": user_id}
                )
            
            # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ –≤ —ç—Ç–æ–º —Ü–∏–∫–ª–µ
            if user.wallet_address and user.wallet_status == "CONFIRMED":
                raise WalletValidationError(
                    code="WALLET_ALREADY_CONFIRMED",
                    message="You already have a confirmed wallet for this cycle. Cannot change wallet until cycle completion.",
                    details={
                        "user_id": user_id,
                        "current_wallet": user.wallet_address,
                        "status": user.wallet_status
                    }
                )
            
            # 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            current_time = datetime.now(timezone.utc)
            user.wallet_address = wallet_address
            user.wallet_status = "PROVISIONAL"  # –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞
            user.wallet_bound_at = current_time
            user.updated_at = current_time
            
            # 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            await self.db_session.flush()
            
            logger.info(f"Wallet {wallet_address} bound to user {user_id}")
            
            return {
                "success": True,
                "user_id": user_id,
                "wallet_address": wallet_address,
                "status": "PROVISIONAL",
                "message": "Wallet successfully bound. Status: PROVISIONAL (can be changed before first transaction).",
                "validation_result": validation_result,
                "bound_at": current_time.isoformat()
            }
    
    async def confirm_wallet(self, user_id: int) -> Dict[str, Any]:
        """
        –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        Proof-Level: P3 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
        Returns:
            Dict —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏
        """
        async with self.db_session.begin():
            user = await self._get_user_by_id(user_id)
            if not user:
                raise ValidationError(
                    code="USER_NOT_FOUND",
                    message=f"User with ID {user_id} not found",
                    details={"user_id": user_id}
                )
            
            if not user.wallet_address:
                raise WalletValidationError(
                    code="NO_WALLET_BOUND",
                    message="No wallet bound to user. Please bind a wallet first.",
                    details={"user_id": user_id}
                )
            
            if user.wallet_status == "CONFIRMED":
                raise WalletValidationError(
                    code="WALLET_ALREADY_CONFIRMED",
                    message="Wallet is already confirmed.",
                    details={
                        "user_id": user_id,
                        "wallet": user.wallet_address,
                        "status": user.wallet_status
                    }
                )
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
            current_time = datetime.now(timezone.utc)
            user.wallet_status = "CONFIRMED"
            user.wallet_confirmed_at = current_time
            user.updated_at = current_time
            
            await self.db_session.flush()
            
            logger.info(f"Wallet confirmed for user {user_id}")
            
            return {
                "success": True,
                "user_id": user_id,
                "wallet_address": user.wallet_address,
                "status": "CONFIRMED",
                "message": "Wallet confirmed. Cannot be changed until cycle completion.",
                "confirmed_at": current_time.isoformat()
            }
    
    async def get_user_wallet(self, user_id: int) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        Proof-Level: P2 (–±–∏–∑–Ω–µ—Å-–∫—Ä–∏—Ç–∏—á–Ω–æ)
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
        Returns:
            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ –∏–ª–∏ None
        """
        user = await self._get_user_by_id(user_id)
        if not user or not user.wallet_address:
            return None
        
        return {
            "address": user.wallet_address,
            "status": user.wallet_status,
            "bound_at": user.wallet_bound_at.isoformat() if user.wallet_bound_at else None,
            "confirmed_at": user.wallet_confirmed_at.isoformat() if user.wallet_confirmed_at else None,
            "is_active": user.is_active,
            "user_id": user.id,
            "user_email": user.email
        }
    
    async def _check_wallet_duplicate(self, address: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∫–æ—à–µ–ª–µ–∫ –¥—Ä—É–≥–∏–º –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        """
        from app.models.user import User
        
        try:
            stmt = select(User).where(
                and_(
                    User.wallet_address == address,
                    User.is_active == True,
                    User.wallet_status.in_(["PROVISIONAL", "CONFIRMED"])
                )
            )
            result = await self.db_session.execute(stmt)
            existing_user = result.scalar_one_or_none()
            
            return existing_user is not None
        except Exception as e:
            logger.error(f"Error checking wallet duplicate: {e}")
            return False
    
    async def _check_blockchain_activity(self, address: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ—à–µ–ª—å–∫–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ —á–µ—Ä–µ–∑ TronGrid API
        """
        if not settings.TRONGRID_API_KEY:
            logger.debug("TRONGRID_API_KEY not set, skipping blockchain check")
            return True  # –ï—Å–ª–∏ API –∫–ª—é—á–∞ –Ω–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        
        try:
            async with httpx.AsyncClient(timeout=10.0) as client:
                headers = {
                    "TRON-PRO-API-KEY": settings.TRONGRID_API_KEY,
                    "Content-Type": "application/json"
                }
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫–∫–∞—É–Ω—Ç —á–µ—Ä–µ–∑ TronGrid API
                response = await client.get(
                    f"{settings.TRONGRID_API_URL}/v1/accounts/{address}",
                    headers=headers
                )
                
                if response.status_code == 200:
                    data = response.json()
                    # –ö–æ—à–µ–ª–µ–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
                    accounts = data.get("data", [])
                    if accounts and len(accounts) > 0:
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –∏–ª–∏ –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                        account_data = accounts[0]
                        balance = account_data.get("balance", 0)
                        trx_count = account_data.get("trx_count", 0)
                        
                        # –ö–æ—à–µ–ª–µ–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
                        # (–¥–∞–∂–µ —Å –Ω—É–ª–µ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º)
                        return True
                
                # –ï—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ–≤—ã–º
                # –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–∏–≤—è–∑–∫—É
                return True
                
        except httpx.TimeoutException:
            logger.warning(f"Timeout checking blockchain activity for {address}")
            return True  # –í —Å–ª—É—á–∞–µ —Ç–∞–π–º–∞—É—Ç–∞ —Å—á–∏—Ç–∞–µ–º –∫–æ—à–µ–ª–µ–∫ –≤–∞–ª–∏–¥–Ω—ã–º
        except Exception as e:
            logger.warning(f"Error checking blockchain activity for {address}: {e}")
            return True  # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Å—á–∏—Ç–∞–µ–º –∫–æ—à–µ–ª–µ–∫ –≤–∞–ª–∏–¥–Ω—ã–º
    
    async def _get_user_by_id(self, user_id: int):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID"""
        from app.models.user import User
        
        try:
            stmt = select(User).where(User.id == user_id)
            result = await self.db_session.execute(stmt)
            return result.scalar_one_or_none()
        except Exception as e:
            logger.error(f"Error getting user by ID {user_id}: {e}")
            return None
```

**`fastagain-backend/app/api/v1/endpoints/wallet.py`** - –ò–°–ü–†–ê–í–õ–ï–ù–û:
```python
"""
API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—à–µ–ª—å–∫–∞–º–∏
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI: WalletInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, WalletBinding —Å—Ç—Ä–∞–Ω–∏—Ü–∞
"""

from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from typing import Dict, Any

from app.core.database import get_db
from app.core.auth import get_current_user
from app.services.wallet_service import WalletService
from app.schemas.wallet import (
    WalletBindRequest,
    WalletBindResponse,
    WalletValidationResponse,
    WalletInfoResponse
)
from app.core.exceptions import (
    WalletValidationError,
    ExchangeWalletError,
    WalletAlreadyBoundError,
    ValidationError
)

router = APIRouter()

@router.post(
    "/bind",
    response_model=WalletBindResponse,
    status_code=status.HTTP_201_CREATED,
    summary="Bind TRON wallet to user",
    description="""
    –ü—Ä–∏–≤—è–∑–∫–∞ TRC-20 –∫–æ—à–µ–ª—å–∫–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    
    **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:**
    1. –§–æ—Ä–º–∞—Ç TRC-20 –∞–¥—Ä–µ—Å–∞
    2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã Base58Check
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–∏—Ä–∂–µ–≤–æ–π –∫–æ—à–µ–ª–µ–∫
    4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–µ
    
    **–°—Ç–∞—Ç—É—Å—ã –∫–æ—à–µ–ª—å–∫–∞:**
    - PROVISIONAL: –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ (–º–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å –¥–æ –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
    - CONFIRMED: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ (–Ω–µ–ª—å–∑—è —Å–º–µ–Ω–∏—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ —Ü–∏–∫–ª–∞)
    
    **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI:** –ö–Ω–æ–ø–∫–∞ "Verify" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ WalletBinding
    """,
    tags=["Wallet"]
)
async def bind_wallet(
    request: WalletBindRequest,
    current_user: Dict[str, Any] = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
) -> WalletBindResponse:
    """
    –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    """
    try:
        wallet_service = WalletService(db)
        
        result = await wallet_service.bind_wallet(
            user_id=current_user["id"],
            wallet_address=request.wallet_address
        )
        
        return WalletBindResponse(**result)
        
    except WalletValidationError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=e.to_dict()
        )
    except ExchangeWalletError as e:
        raise HTTPException(
            status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,
            detail=e.to_dict()
        )
    except WalletAlreadyBoundError as e:
        raise HTTPException(
            status_code=status.HTTP_409_CONFLICT,
            detail=e.to_dict()
        )
    except ValidationError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=e.to_dict()
        )
    except Exception as e:
        logger.error(f"Unexpected error in bind_wallet: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={
                "code": "INTERNAL_SERVER_ERROR",
                "message": "An unexpected error occurred",
                "details": {"error": str(e)}
            }
        )

@router.get(
    "/validate/{wallet_address}",
    response_model=WalletValidationResponse,
    summary="Validate TRON wallet address",
    description="""
    –í–∞–ª–∏–¥–∞—Ü–∏—è TRC-20 –∞–¥—Ä–µ—Å–∞ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è real-time –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ UI:
    - –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ—à–µ–ª—å–∫–∞ —Å –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –æ—à–∏–±–æ–∫
    - –ö–Ω–æ–ø–∫–∞ "Validate" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ WalletBinding
    - Pre-validation –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
    
    **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI:** –ü–æ–ª–µ –≤–≤–æ–¥–∞ WalletInput —Å live validation
    """,
    tags=["Wallet"]
)
async def validate_wallet(
    wallet_address: str,
    db: AsyncSession = Depends(get_db)
) -> WalletValidationResponse:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è TRC-20 –∞–¥—Ä–µ—Å–∞
    """
    try:
        wallet_service = WalletService(db)
        validation_result = await wallet_service.validate_tron_address(wallet_address)
        
        return WalletValidationResponse(**validation_result)
        
    except WalletValidationError as e:
        # –î–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 200 —Å —Ñ–ª–∞–≥–æ–º valid=False
        return WalletValidationResponse(
            valid=False,
            address=wallet_address,
            is_exchange=True if isinstance(e, ExchangeWalletError) else False,
            is_active=False,
            checksum_valid=False,
            message=e.message,
            warnings=[e.message]
        )
    except Exception as e:
        logger.error(f"Unexpected error in validate_wallet: {e}")
        return WalletValidationResponse(
            valid=False,
            address=wallet_address,
            is_exchange=False,
            is_active=False,
            checksum_valid=False,
            message="Validation failed due to server error",
            warnings=["Server error during validation"]
        )

@router.get(
    "/me",
    response_model=WalletInfoResponse,
    summary="Get current user's wallet info",
    description="""
    –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–º –∫–æ—à–µ–ª—å–∫–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ –≤ Dashboard
    - –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ü–∏–∫–ª–∞
    - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ WalletBinding
    
    **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI:** Dashboard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, WalletBinding —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    """,
    tags=["Wallet"]
)
async def get_my_wallet(
    current_user: Dict[str, Any] = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
) -> WalletInfoResponse:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    try:
        wallet_service = WalletService(db)
        wallet_info = await wallet_service.get_user_wallet(current_user["id"])
        
        if not wallet_info:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail={
                    "code": "WALLET_NOT_FOUND",
                    "message": "No wallet bound to user",
                    "details": {"user_id": current_user["id"]}
                }
            )
        
        return WalletInfoResponse(**wallet_info)
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Unexpected error in get_my_wallet: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={
                "code": "INTERNAL_SERVER_ERROR",
                "message": "Failed to fetch wallet info",
                "details": {"error": str(e)}
            }
        )

@router.post(
    "/confirm",
    response_model=WalletBindResponse,
    summary="Confirm wallet after first transaction",
    description="""
    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
    
    **–í–∞–∂–Ω–æ:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
    –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ—à–µ–ª–µ–∫ –Ω–µ–ª—å–∑—è —Å–º–µ–Ω–∏—Ç—å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞.
    
    **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ –∏–∑ TransactionService
    """,
    tags=["Wallet"]
)
async def confirm_wallet(
    current_user: Dict[str, Any] = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
) -> WalletBindResponse:
    """
    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
    """
    try:
        wallet_service = WalletService(db)
        result = await wallet_service.confirm_wallet(current_user["id"])
        return WalletBindResponse(**result)
        
    except WalletValidationError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=e.to_dict()
        )
    except ValidationError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=e.to_dict()
        )
    except Exception as e:
        logger.error(f"Unexpected error in confirm_wallet: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail={
                "code": "INTERNAL_SERVER_ERROR",
                "message": "Failed to confirm wallet",
                "details": {"error": str(e)}
            }
        )

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ª–æ–≥–≥–µ—Ä
import logging
logger = logging.getLogger(__name__)
```

**`fastagain-backend/app/api/v1/api.py`** - –î–û–ë–ê–í–õ–ï–ù–û —Ä–æ—É—Ç–µ—Ä –∫–æ—à–µ–ª—å–∫–æ–≤:
```python
"""
–ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä API v1, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
"""

from fastapi import APIRouter
from app.api.v1.endpoints import health, auth, wallet

api_router = APIRouter()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
api_router.include_router(health.router, prefix="/health", tags=["Health"])
api_router.include_router(auth.router, prefix="/auth", tags=["Authentication"])
api_router.include_router(wallet.router, prefix="/wallet", tags=["Wallet"])
```

### 2. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (React/TypeScript) - `fastagain-frontend/`**:

**`fastagain-frontend/src/services/api.ts`** - –ò–°–ü–†–ê–í–õ–ï–ù–û:
```typescript
/**
 * –ë–∞–∑–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –±—ç–∫–µ–Ω–¥–∞
 * –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º: –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã /api/v1/*
 */

import axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';

// –ë–∞–∑–æ–≤—ã–π URL API (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ - localhost:8000)
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api/v1';

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä axios —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
const api: AxiosInstance = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000, // 10 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
});

// –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–∞ –∫ –∑–∞–ø—Ä–æ—Å–∞–º
api.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    const token = localStorage.getItem('access_token');
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
api.interceptors.response.use(
  (response) => response,
  async (error: AxiosError) => {
    const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean };
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ 401 –æ—à–∏–±–∫–∏ (–Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        // –ü—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
        const refreshToken = localStorage.getItem('refresh_token');
        if (!refreshToken) {
          throw new Error('No refresh token');
        }
        
        const response = await axios.post(`${API_BASE_URL}/auth/refresh`, {
          refresh_token: refreshToken,
        });
        
        const { access_token, refresh_token: newRefreshToken } = response.data;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã
        localStorage.setItem('access_token', access_token);
        if (newRefreshToken) {
          localStorage.setItem('refresh_token', newRefreshToken);
        }
        
        // –ü–æ–≤—Ç–æ—Ä—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
        originalRequest.headers = originalRequest.headers || {};
        originalRequest.headers.Authorization = `Bearer ${access_token}`;
        return api(originalRequest);
        
      } catch (refreshError) {
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('user');
        
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫
    return Promise.reject(error);
  }
);

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä axios
export default api;

// –¢–∏–ø—ã –¥–ª—è API –æ—à–∏–±–æ–∫
export interface ApiError {
  code: string;
  message: string;
  details?: any;
}

export interface ApiResponse<T = any> {
  data: T;
  status: number;
  statusText: string;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API
export const handleApiError = (error: unknown): ApiError => {
  if (axios.isAxiosError(error)) {
    const axiosError = error as AxiosError<ApiError>;
    if (axiosError.response?.data) {
      return axiosError.response.data;
    }
    return {
      code: 'NETWORK_ERROR',
      message: axiosError.message || 'Network error occurred',
    };
  }
  
  if (error instanceof Error) {
    return {
      code: 'UNKNOWN_ERROR',
      message: error.message,
    };
  }
  
  return {
    code: 'UNKNOWN_ERROR',
    message: 'An unknown error occurred',
  };
};
```

**`fastagain-frontend/src/hooks/useToast.ts`** - –î–û–ë–ê–í–õ–ï–ù–û (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª):
```typescript
/**
 * –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ (toasts)
 * –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Headless UI –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ toasts
 */

import { useState, useCallback } from 'react';

export interface Toast {
  id: string;
  title: string;
  description?: string;
  variant?: 'default' | 'success' | 'destructive' | 'warning';
  duration?: number;
}

export interface ToastOptions {
  title: string;
  description?: string;
  variant?: Toast['variant'];
  duration?: number;
}

export const useToast = () => {
  const [toasts, setToasts] = useState<Toast[]>([]);

  const toast = useCallback((options: ToastOptions) => {
    const id = Math.random().toString(36).substring(2, 9);
    const newToast: Toast = {
      id,
      title: options.title,
      description: options.description,
      variant: options.variant || 'default',
      duration: options.duration || 5000,
    };

    setToasts((prev) => [...prev, newToast]);

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
    setTimeout(() => {
      setToasts((prev) => prev.filter((t) => t.id !== id));
    }, newToast.duration);

    return id;
  }, []);

  const dismiss = useCallback((id: string) => {
    setToasts((prev) => prev.filter((t) => t.id !== id));
  }, []);

  const dismissAll = useCallback(() => {
    setToasts([]);
  }, []);

  return {
    toasts,
    toast,
    dismiss,
    dismissAll,
  };
};

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ToastContainer (–¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ App.tsx)
import React, { Fragment } from 'react';
import { Transition } from '@headlessui/react';
import { CheckCircle, XCircle, AlertCircle, X } from 'lucide-react';

export const ToastContainer: React.FC<{ toasts: Toast[]; onDismiss: (id: string) => void }> = ({ 
  toasts, 
  onDismiss 
}) => {
  const getIcon = (variant: Toast['variant']) => {
    switch (variant) {
      case 'success':
        return <CheckCircle className="h-5 w-5 text-green-400" />;
      case 'destructive':
        return <XCircle className="h-5 w-5 text-red-400" />;
      case 'warning':
        return <AlertCircle className="h-5 w-5 text-yellow-400" />;
      default:
        return <AlertCircle className="h-5 w-5 text-blue-400" />;
    }
  };

  const getBgColor = (variant: Toast['variant']) => {
    switch (variant) {
      case 'success':
        return 'bg-green-50';
      case 'destructive':
        return 'bg-red-50';
      case 'warning':
        return 'bg-yellow-50';
      default:
        return 'bg-blue-50';
    }
  };

  const getTextColor = (variant: Toast['variant']) => {
    switch (variant) {
      case 'success':
        return 'text-green-800';
      case 'destructive':
        return 'text-red-800';
      case 'warning':
        return 'text-yellow-800';
      default:
        return 'text-blue-800';
    }
  };

  return (
    <div className="fixed inset-0 flex flex-col items-end justify-start p-4 pointer-events-none z-50">
      {toasts.map((toast) => (
        <Transition
          key={toast.id}
          show={true}
          as={Fragment}
          enter="transform ease-out duration-300 transition"
          enterFrom="translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2"
          enterTo="translate-y-0 opacity-100 sm:translate-x-0"
          leave="transition ease-in duration-100"
          leaveFrom="opacity-100"
          leaveTo="opacity-0"
        >
          <div className={`w-full max-w-sm rounded-lg shadow-lg pointer-events-auto ${getBgColor(toast.variant)}`}>
            <div className="p-4">
              <div className="flex items-start">
                <div className="flex-shrink-0">
                  {getIcon(toast.variant)}
                </div>
                <div className="ml-3 w-0 flex-1">
                  <p className={`text-sm font-medium ${getTextColor(toast.variant)}`}>
                    {toast.title}
                  </p>
                  {toast.description && (
                    <p className={`mt-1 text-sm ${getTextColor(toast.variant)}`}>
                      {toast.description}
                    </p>
                  )}
                </div>
                <div className="ml-4 flex-shrink-0 flex">
                  <button
                    onClick={() => onDismiss(toast.id)}
                    className={`inline-flex rounded-md ${getTextColor(toast.variant)} hover:${getTextColor(toast.variant)}/80 focus:outline-none`}
                  >
                    <span className="sr-only">Close</span>
                    <X className="h-5 w-5" />
                  </button>
                </div>
              </div>
            </div>
          </div>
        </Transition>
      ))}
    </div>
  );
};
```

**`fastagain-frontend/src/hooks/useAuth.ts`** - –î–û–ë–ê–í–õ–ï–ù–û (–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª):
```typescript
/**
 * –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
 * –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API: /api/v1/auth/*
 */

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

export interface User {
  id: number;
  email: string;
  main_status: string;
  sub_status: string;
  wallet_address?: string;
  wallet_status?: string;
  referral_code?: string;
  cycle_number: number;
  is_active: boolean;
}

export const useAuth = () => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const navigate = useNavigate();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  useEffect(() => {
    const checkAuth = async () => {
      const token = localStorage.getItem('access_token');
      if (!token) {
        setLoading(false);
        return;
      }

      try {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const storedUser = localStorage.getItem('user');
        if (storedUser) {
          setUser(JSON.parse(storedUser));
        }
      } catch (err) {
        console.error('Auth check failed:', err);
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('user');
      } finally {
        setLoading(false);
      }
    };

    checkAuth();
  }, []);

  const login = async (email: string, password: string) => {
    try {
      setLoading(true);
      setError(null);
      
      // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –≤—Ö–æ–¥–∞
      // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç
      const mockUser: User = {
        id: 1,
        email,
        main_status: 'NEW_USER',
        sub_status: 'ONBOARDING',
        cycle_number: 0,
        is_active: true,
      };
      
      const mockToken = 'mock-jwt-token';
      
      localStorage.setItem('access_token', mockToken);
      localStorage.setItem('user', JSON.stringify(mockUser));
      setUser(mockUser);
      
      navigate('/dashboard');
      return { success: true };
    } catch (err) {
      const message = err instanceof Error ? err.message : 'Login failed';
      setError(message);
      return { success: false, error: message };
    } finally {
      setLoading(false);
    }
  };

  const logout = () => {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    localStorage.removeItem('user');
    setUser(null);
    navigate('/login');
  };

  const register = async (email: string, password: string, referralCode?: string) => {
    try {
      setLoading(true);
      setError(null);
      
      // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç
      const mockUser: User = {
        id: 1,
        email,
        main_status: 'NEW_USER',
        sub_status: 'ONBOARDING',
        cycle_number: 0,
        is_active: true,
      };
      
      const mockToken = 'mock-jwt-token';
      
      localStorage.setItem('access_token', mockToken);
      localStorage.setItem('user', JSON.stringify(mockUser));
      setUser(mockUser);
      
      navigate('/onboarding');
      return { success: true };
    } catch (err) {
      const message = err instanceof Error ? err.message : 'Registration failed';
      setError(message);
      return { success: false, error: message };
    } finally {
      setLoading(false);
    }
  };

  const updateUser = (updatedUser: Partial<User>) => {
    if (user) {
      const newUser = { ...user, ...updatedUser };
      setUser(newUser);
      localStorage.setItem('user', JSON.stringify(newUser));
    }
  };

  return {
    user,
    loading,
    error,
    login,
    logout,
    register,
    updateUser,
    isAuthenticated: !!user,
  };
};
```

**`fastagain-frontend/src/components/WalletInput.tsx`** - –ò–°–ü–†–ê–í–õ–ï–ù–û:
```typescript
/**
 * WalletInput - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤–≤–æ–¥–∞ TRON –∫–æ—à–µ–ª—å–∫–∞ —Å live –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
 * –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API: POST /api/v1/users/wallet/bind, GET /api/v1/wallet/validate/{address}
 * –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞: Trust Flow (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞)
 */

import React, { useState, useEffect, useCallback, useRef } from 'react';
import { Check, X, AlertCircle, Copy, ExternalLink, Loader2 } from 'lucide-react';
import { validateWallet, validateTRC20Format } from '../services/wallet';
import { useToast } from '../hooks/useToast';

interface WalletInputProps {
  value: string;
  onChange: (value: string) => void;
  onValidation?: (isValid: boolean) => void;
  disabled?: boolean;
  showValidation?: boolean;
  className?: string;
}

interface ValidationState {
  isValid: boolean;
  message: string;
  isExchange: boolean;
  isChecking: boolean;
}

export const WalletInput: React.FC<WalletInputProps> = ({
  value,
  onChange,
  onValidation,
  disabled = false,
  showValidation = true,
  className = '',
}) => {
  const [validationState, setValidationState] = useState<ValidationState>({
    isValid: false,
    message: '',
    isExchange: false,
    isChecking: false,
  });
  const [hasInteracted, setHasInteracted] = useState(false);
  const [isFocused, setIsFocused] = useState(false);
  
  const validationTimeoutRef = useRef<NodeJS.Timeout | null>(null);
  const { toast } = useToast();

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –¥–µ–±–∞—É–Ω—Å–æ–º
  const validateWithDebounce = useCallback(async (address: string) => {
    if (!address || address.length < 34 || !showValidation || disabled) {
      return;
    }

    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
    if (validationTimeoutRef.current) {
      clearTimeout(validationTimeoutRef.current);
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    setValidationState(prev => ({ ...prev, isChecking: true }));

    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–∞—É—Ç
    validationTimeoutRef.current = setTimeout(async () => {
      try {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
        const isFormatValid = validateTRC20Format(address);
        if (!isFormatValid) {
          setValidationState({
            isValid: false,
            message: 'Invalid TRC-20 address format',
            isExchange: false,
            isChecking: false,
          });
          onValidation?.(false);
          return;
        }

        // –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ API
        const result = await validateWallet(address);
        
        setValidationState({
          isValid: result.valid && !result.isExchange,
          message: result.message,
          isExchange: result.isExchange,
          isChecking: false,
        });
        
        onValidation?.(result.valid && !result.isExchange);
        
      } catch (error) {
        console.error('Validation error:', error);
        setValidationState({
          isValid: false,
          message: error instanceof Error ? error.message : 'Validation failed',
          isExchange: false,
          isChecking: false,
        });
        onValidation?.(false);
      }
    }, 800); // 800ms –¥–µ–±–∞—É–Ω—Å
  }, [showValidation, disabled, onValidation]);

  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è
  useEffect(() => {
    if (value && hasInteracted) {
      validateWithDebounce(value);
    } else {
      setValidationState(prev => ({ ...prev, isChecking: false }));
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    return () => {
      if (validationTimeoutRef.current) {
        clearTimeout(validationTimeoutRef.current);
      }
    };
  }, [value, hasInteracted, validateWithDebounce]);

  const handlePaste = async () => {
    try {
      const text = await navigator.clipboard.readText();
      const trimmedText = text.trim();
      onChange(trimmedText);
      setHasInteracted(true);
      
      toast({
        title: 'Pasted',
        description: 'Address pasted from clipboard',
        variant: 'success',
      });
    } catch (error) {
      toast({
        title: 'Error',
        description: 'Failed to read from clipboard. Please check permissions.',
        variant: 'destructive',
      });
    }
  };

  const handleCopy = () => {
    if (!value) return;
    
    navigator.clipboard.writeText(value)
      .then(() => {
        toast({
          title: 'Copied',
          description: 'Wallet address copied to clipboard',
          variant: 'success',
        });
      })
      .catch(() => {
        toast({
          title: 'Error',
          description: 'Failed to copy to clipboard',
          variant: 'destructive',
        });
      });
  };

  const openTronScan = () => {
    if (!value) return;
    window.open(`https://tronscan.org/#/address/${value}`, '_blank', 'noopener,noreferrer');
  };

  const getBorderColor = () => {
    if (!hasInteracted || !value) return 'border-gray-300';
    if (validationState.isChecking) return 'border-blue-400';
    if (validationState.isValid) return 'border-green-500';
    if (validationState.isExchange) return 'border-red-500';
    return 'border-red-500';
  };

  const getValidationIcon = () => {
    if (!hasInteracted || !value || validationState.isChecking) {
      return null;
    }
    
    if (validationState.isValid) {
      return <Check className="w-4 h-4 text-green-500" />;
    }
    
    if (validationState.isExchange) {
      return <X className="w-4 h-4 text-red-500" />;
    }
    
    return <X className="w-4 h-4 text-red-500" />;
  };

  const getHelperText = () => {
    if (!value) {
      return 'Enter your TRON wallet address (TRC-20)';
    }
    
    if (validationState.isChecking) {
      return 'Validating address...';
    }
    
    if (validationState.isExchange) {
      return 'Exchange wallets are not allowed';
    }
    
    if (!validationState.isValid && validationState.message) {
      return validationState.message;
    }
    
    return 'Valid TRC-20 address';
  };

  const getHelperTextColor = () => {
    if (!value) return 'text-gray-500';
    if (validationState.isChecking) return 'text-blue-600';
    if (validationState.isValid) return 'text-green-600';
    return 'text-red-600';
  };

  return (
    <div className={`space-y-2 ${className}`}>
      <label className="block text-sm font-medium text-gray-700">
        TRON Address (TRC-20)
      </label>
      
      <div className="relative">
        <div 
          className={`
            flex items-center border-2 rounded-lg px-3 py-2 transition-all duration-200
            ${getBorderColor()}
            ${disabled ? 'bg-gray-100 cursor-not-allowed' : 'bg-white'}
            ${isFocused ? 'ring-2 ring-blue-500 ring-opacity-50' : ''}
          `}
        >
          <span className="text-gray-500 mr-2 font-mono select-none">T</span>
          <input
            type="text"
            value={value}
            onChange={(e) => {
              const newValue = e.target.value.trim();
              onChange(newValue);
              if (!hasInteracted && newValue) {
                setHasInteracted(true);
              }
            }}
            onFocus={() => {
              setIsFocused(true);
              if (!hasInteracted && value) {
                setHasInteracted(true);
              }
            }}
            onBlur={() => setIsFocused(false)}
            disabled={disabled}
            placeholder="Na1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
            className="flex-1 bg-transparent outline-none font-mono text-sm placeholder-gray-400 disabled:cursor-not-allowed min-w-0"
            aria-describedby="wallet-helper-text"
          />
          
          <div className="flex items-center space-x-2 ml-2">
            {value && (
              <>
                <button
                  type="button"
                  onClick={handleCopy}
                  className="p-1 hover:bg-gray-100 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                  title="Copy address"
                  disabled={disabled}
                  aria-label="Copy wallet address"
                >
                  <Copy className="w-4 h-4 text-gray-500" />
                </button>
                <button
                  type="button"
                  onClick={openTronScan}
                  className="p-1 hover:bg-gray-100 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                  title="View on TronScan"
                  disabled={disabled}
                  aria-label="View wallet on TronScan"
                >
                  <ExternalLink className="w-4 h-4 text-gray-500" />
                </button>
              </>
            )}
            <button
              type="button"
              onClick={handlePaste}
              disabled={disabled}
              className="px-3 py-1 text-sm bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
              aria-label="Paste from clipboard"
            >
              Paste
            </button>
            {validationState.isChecking ? (
              <Loader2 className="w-4 h-4 text-blue-500 animate-spin" />
            ) : (
              getValidationIcon()
            )}
          </div>
        </div>

        {/* Helper text */}
        <div className="mt-1">
          <p 
            id="wallet-helper-text" 
            className={`text-sm ${getHelperTextColor()} flex items-center`}
          >
            {validationState.isExchange && (
              <AlertCircle className="w-4 h-4 mr-1 flex-shrink-0" />
            )}
            {getHelperText()}
          </p>
        </div>

        {/* Format hint */}
        {value && !validationState.isExchange && (
          <div className="text-xs text-gray-500 mt-1">
            Format: T + 33 characters (Base58). Example: TNa1...z9X4
          </div>
        )}
      </div>

      {/* Exchange wallet warning */}
      {validationState.isExchange && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mt-3">
          <div className="flex items-start">
            <AlertCircle className="w-5 h-5 text-red-400 mr-2 mt-0.5 flex-shrink-0" />
            <div>
              <h4 className="text-sm font-medium text-red-800">Exchange Wallet Detected</h4>
              <p className="text-sm text-red-700 mt-1">
                For security reasons, exchange wallets (Binance, TronWallet, etc.) are not allowed.
                Please use a personal TRON wallet like:
              </p>
              <ul className="text-sm text-red-700 mt-2 ml-5 list-disc space-y-1">
                <li>TronLink (browser extension/mobile)</li>
                <li>Trust Wallet (mobile)</li>
                <li>Ledger (hardware wallet)</li>
                <li>Atomic Wallet</li>
              </ul>
              <p className="text-sm text-red-700 mt-2">
                This rule is enforced to protect the community from fraud and ensure fair participation.
              </p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};
```

**`fastagain-frontend/src/services/wallet.ts`** - –ò–°–ü–†–ê–í–õ–ï–ù–û:
```typescript
/**
 * –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Wallet API
 * –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º: –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã /api/v1/wallet/*
 */

import api, { handleApiError, ApiError } from './api';

export interface WalletValidationResponse {
  valid: boolean;
  address: string;
  isExchange: boolean;
  isActive: boolean;
  checksumValid: boolean;
  message: string;
  warnings?: string[];
}

export interface WalletBindRequest {
  wallet_address: string;
}

export interface WalletBindResponse {
  success: boolean;
  user_id: number;
  wallet_address: string;
  status: 'PROVISIONAL' | 'CONFIRMED';
  message: string;
  validation_result?: WalletValidationResponse;
  bound_at?: string;
}

export interface WalletInfoResponse {
  address: string;
  status: string;
  bound_at: string | null;
  confirmed_at: string | null;
  is_active: boolean;
  user_id?: number;
  user_email?: string;
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è TRON –∫–æ—à–µ–ª—å–∫–∞
 * @param address TRC-20 –∞–¥—Ä–µ—Å
 */
export const validateWallet = async (address: string): Promise<WalletValidationResponse> => {
  try {
    const response = await api.get(`/wallet/validate/${encodeURIComponent(address)}`);
    return response.data;
  } catch (error) {
    const apiError = handleApiError(error);
    
    // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ–µ –≤ —Ñ–æ—Ä–º–∞—Ç ValidationResponse
    if (apiError.code === 'EXCHANGE_WALLET_DETECTED') {
      return {
        valid: false,
        address,
        isExchange: true,
        isActive: false,
        checksumValid: false,
        message: apiError.message,
        warnings: [apiError.message]
      };
    }
    
    if (apiError.code === 'INVALID_TRC20_FORMAT' || apiError.code === 'INVALID_CHECKSUM') {
      return {
        valid: false,
        address,
        isExchange: false,
        isActive: false,
        checksumValid: false,
        message: apiError.message,
        warnings: [apiError.message]
      };
    }
    
    throw new Error(apiError.message || 'Validation failed');
  }
};

/**
 * –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
 * @param data –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏
 */
export const bindWallet = async (data: WalletBindRequest): Promise<WalletBindResponse> => {
  try {
    const response = await api.post('/wallet/bind', data);
    return response.data;
  } catch (error) {
    const apiError = handleApiError(error);
    
    // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    switch (apiError.code) {
      case 'EXCHANGE_WALLET_DETECTED':
        throw new Error('Exchange wallets are not allowed. Please use a personal wallet like TronLink or Trust Wallet.');
      
      case 'WALLET_ALREADY_BOUND':
        throw new Error('This wallet is already in use by another active user.');
      
      case 'WALLET_ALREADY_CONFIRMED':
        throw new Error('You already have a confirmed wallet for this cycle. Cannot change wallet until cycle completion.');
      
      case 'INVALID_TRC20_FORMAT':
        throw new Error('Invalid TRON address format. Please check the address.');
      
      case 'INVALID_CHECKSUM':
        throw new Error('Invalid address checksum. The address may contain typos.');
      
      default:
        throw new Error(apiError.message || 'Failed to bind wallet. Please try again.');
    }
  }
};

/**
 * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export const getMyWallet = async (): Promise<WalletInfoResponse> => {
  try {
    const response = await api.get('/wallet/me');
    return response.data;
  } catch (error) {
    const apiError = handleApiError(error);
    
    if (apiError.code === 'WALLET_NOT_FOUND') {
      throw new Error('No wallet bound to your account');
    }
    
    throw new Error(apiError.message || 'Failed to fetch wallet info');
  }
};

/**
 * –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
 */
export const confirmWallet = async (): Promise<WalletBindResponse> => {
  try {
    const response = await api.post('/wallet/confirm');
    return response.data;
  } catch (error) {
    const apiError = handleApiError(error);
    
    switch (apiError.code) {
      case 'NO_WALLET_BOUND':
        throw new Error('No wallet bound to your account');
      
      case 'WALLET_ALREADY_CONFIRMED':
        throw new Error('Wallet is already confirmed');
      
      default:
        throw new Error(apiError.message || 'Failed to confirm wallet');
    }
  }
};

/**
 * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ TRC-20 –∞–¥—Ä–µ—Å–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑–æ–≤—É—é —Ä–µ–≥—É–ª—è—Ä–∫—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
 */
export const validateTRC20Format = (address: string): boolean => {
  if (!address || typeof address !== 'string') {
    return false;
  }
  
  // –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å T, 34 —Å–∏–º–≤–æ–ª–∞, —Ç–æ–ª—å–∫–æ Base58 —Å–∏–º–≤–æ–ª—ã
  const trc20Regex = /^T[1-9A-HJ-NP-Za-km-z]{33}$/;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ Base58 —Å–∏–º–≤–æ–ª—ã
  const isValidFormat = trc20Regex.test(address);
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∞–¥—Ä–µ—Å –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤
  // (–ø—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã—Ö –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤)
  const uniqueChars = new Set(address.split('')).size;
  if (uniqueChars < 5) {
    return false;
  }
  
  return isValidFormat;
};

/**
 * –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)
 */
export const formatWalletAddress = (address: string, visibleChars: number = 6): string => {
  if (!address || address.length < visibleChars * 2 + 3) {
    return address;
  }
  
  const start = address.substring(0, visibleChars);
  const end = address.substring(address.length - visibleChars);
  return `${start}...${end}`;
};

/**
 * –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ TronScan
 */
export const getTronScanUrl = (address: string): string => {
  return `https://tronscan.org/#/address/${address}`;
};

/**
 * –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ TronScan
 */
export const getTronScanTransactionUrl = (txHash: string): string => {
  return `https://tronscan.org/#/transaction/${txHash}`;
};
```

**`fastagain-frontend/src/pages/WalletBinding.tsx`** - –ò–°–ü–†–ê–í–õ–ï–ù–û:
```typescript
/**
 * WalletBinding - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∏–≤—è–∑–∫–∏ TRON –∫–æ—à–µ–ª—å–∫–∞
 * –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API: POST /api/v1/users/wallet/bind
 * –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞: Trust Flow, Mobile-First
 * –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è: "connect wallet", "bind wallet" (–Ω–µ "payment")
 */

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { 
  Wallet, 
  AlertCircle, 
  ArrowRight, 
  QrCode, 
  Shield, 
  CheckCircle,
  Lock
} from 'lucide-react';
import { WalletInput } from '../components/WalletInput';
import { Button } from '../components/ui/Button';
import { 
  bindWallet, 
  getMyWallet, 
  WalletInfoResponse,
  formatWalletAddress 
} from '../services/wallet';
import { useToast } from '../hooks/useToast';
import { useAuth } from '../hooks/useAuth';

export const WalletBinding: React.FC = () => {
  const [walletAddress, setWalletAddress] = useState('');
  const [isWalletValid, setIsWalletValid] = useState(false);
  const [isBinding, setIsBinding] = useState(false);
  const [existingWallet, setExistingWallet] = useState<WalletInfoResponse | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  
  const navigate = useNavigate();
  const { toast } = useToast();
  const { user, isAuthenticated } = useAuth();

  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
  useEffect(() => {
    if (!isAuthenticated) {
      navigate('/login', { 
        state: { from: '/wallet/binding' },
        replace: true 
      });
    }
  }, [isAuthenticated, navigate]);

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
  useEffect(() => {
    const loadWallet = async () => {
      if (!isAuthenticated) return;
      
      setIsLoading(true);
      try {
        const wallet = await getMyWallet();
        setExistingWallet(wallet);
        if (wallet.address) {
          setWalletAddress(wallet.address);
          setIsWalletValid(true);
        }
      } catch (error) {
        // –ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
        console.log('No wallet bound yet');
      } finally {
        setIsLoading(false);
      }
    };
    
    loadWallet();
  }, [isAuthenticated]);

  const handleBindWallet = async () => {
    if (!isWalletValid || !walletAddress || !isAuthenticated) {
      toast({
        title: 'Validation Error',
        description: 'Please enter a valid wallet address',
        variant: 'destructive',
      });
      return;
    }
    
    setIsBinding(true);
    try {
      const result = await bindWallet({ wallet_address: walletAddress });
      
      toast({
        title: 'Wallet Connected',
        description: 'Your TRON wallet has been successfully connected.',
        variant: 'success',
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
      const updatedWallet = await getMyWallet();
      setExistingWallet(updatedWallet);
      
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      navigate('/queue');
      
    } catch (error) {
      console.error('Bind wallet error:', error);
      toast({
        title: 'Connection Failed',
        description: error instanceof Error ? error.message : 'Failed to connect wallet. Please try again.',
        variant: 'destructive',
      });
    } finally {
      setIsBinding(false);
    }
  };

  const handleContinue = () => {
    if (existingWallet?.status === 'CONFIRMED') {
      navigate('/dashboard');
    } else {
      navigate('/queue');
    }
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading wallet information...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white py-8 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md mx-auto">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8">
          <div className="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
            <Wallet className="w-8 h-8 text-blue-600" />
          </div>
          <h1 className="text-2xl sm:text-3xl font-bold text-gray-900">
            Connect Your Wallet
          </h1>
          <p className="text-gray-600 mt-2 text-sm sm:text-base">
            Connect your personal TRON wallet to start participating in the community
          </p>
        </div>

        {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */}
        <div className="bg-white rounded-xl shadow-lg p-6">
          {/* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ—à–µ–ª–µ–∫ */}
          {existingWallet?.address && (
            <div className={`mb-6 p-4 rounded-lg border ${
              existingWallet.status === 'CONFIRMED' 
                ? 'bg-green-50 border-green-200' 
                : 'bg-blue-50 border-blue-200'
            }`}>
              <div className="flex items-start">
                {existingWallet.status === 'CONFIRMED' ? (
                  <Lock className="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" />
                ) : (
                  <Shield className="w-5 h-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0" />
                )}
                <div className="flex-1">
                  <div className="flex items-center justify-between">
                    <h3 className="font-medium text-gray-800">
                      {existingWallet.status === 'CONFIRMED' ? 'Wallet Confirmed' : 'Wallet Connected'}
                    </h3>
                    {existingWallet.status === 'CONFIRMED' && (
                      <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        <CheckCircle className="w-3 h-3 mr-1" />
                        Locked
                      </span>
                    )}
                  </div>
                  <p className="text-sm text-gray-700 mt-1 font-mono">
                    {formatWalletAddress(existingWallet.address, 8)}
                  </p>
                  <p className="text-sm text-gray-600 mt-2">
                    {existingWallet.status === 'CONFIRMED' 
                      ? 'Your wallet is confirmed and cannot be changed until the current cycle completes.'
                      : 'Your wallet is connected. It will be confirmed after your first transaction.'}
                  </p>
                  {existingWallet.status === 'CONFIRMED' && (
                    <button
                      onClick={handleContinue}
                      className="mt-3 text-sm text-green-700 hover:text-green-800 font-medium"
                    >
                      Continue to Dashboard ‚Üí
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* –§–æ—Ä–º–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω */}
          {existingWallet?.status !== 'CONFIRMED' && (
            <>
              {/* QR Scanner –∫–Ω–æ–ø–∫–∞ */}
              <div className="mb-6">
                <button
                  onClick={() => {
                    toast({
                      title: 'Coming Soon',
                      description: 'QR code scanning will be available in the next update',
                      variant: 'default',
                    });
                  }}
                  className="w-full py-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors duration-200 group focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                >
                  <div className="flex flex-col items-center">
                    <QrCode className="w-10 h-10 text-gray-400 group-hover:text-blue-500 mb-2 transition-colors duration-200" />
                    <span className="text-sm font-medium text-gray-600 group-hover:text-blue-600 transition-colors duration-200">
                      Scan QR Code
                    </span>
                    <span className="text-xs text-gray-500 mt-1">
                      Scan QR from TronLink or Trust Wallet
                    </span>
                  </div>
                </button>
              </div>

              <div className="text-center mb-6">
                <span className="text-sm text-gray-500 bg-white px-4">‚Äî OR ‚Äî</span>
              </div>

              {/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ—à–µ–ª—å–∫–∞ */}
              <div className="mb-6">
                <WalletInput
                  value={walletAddress}
                  onChange={setWalletAddress}
                  onValidation={setIsWalletValid}
                  disabled={isBinding || existingWallet?.status === 'CONFIRMED'}
                  showValidation={true}
                  className="w-full"
                />
              </div>

              {/* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–∏—Ä–∂–µ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–∞—Ö */}
              <div className="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div className="flex items-start">
                  <AlertCircle className="w-5 h-5 text-yellow-500 mr-2 mt-0.5 flex-shrink-0" />
                  <div>
                    <h4 className="text-sm font-medium text-yellow-800">Important Notice</h4>
                    <p className="text-sm text-yellow-700 mt-1">
                      Exchange wallets (Binance, Crypto.com, etc.) are <strong>not allowed</strong> for security reasons.
                      Please use a personal TRON wallet like:
                    </p>
                    <ul className="text-sm text-yellow-700 mt-2 ml-5 list-disc space-y-1">
                      <li>TronLink (browser extension/mobile)</li>
                      <li>Trust Wallet (mobile)</li>
                      <li>Ledger (hardware wallet)</li>
                      <li>Atomic Wallet</li>
                    </ul>
                  </div>
                </div>
              </div>

              {/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è */}
              <Button
                onClick={handleBindWallet}
                disabled={!isWalletValid || isBinding || existingWallet?.status === 'CONFIRMED'}
                isLoading={isBinding}
                className="w-full py-3"
                size="lg"
              >
                {existingWallet?.address ? 'Update Wallet' : 'Connect Wallet'}
                <ArrowRight className="ml-2 w-4 h-4" />
              </Button>
            </>
          )}

          {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */}
          <div className="mt-6 pt-6 border-t border-gray-200">
            <p className="text-sm text-gray-600">
              By connecting your wallet, you agree to our{' '}
              <a 
                href="/terms" 
                className="text-blue-600 hover:text-blue-800 hover:underline font-medium"
                target="_blank"
                rel="noopener noreferrer"
              >
                Terms of Service
              </a>
              {' '}and confirm this is a personal, non-exchange wallet.
            </p>
            <p className="text-xs text-gray-500 mt-2">
              Your wallet address is stored securely and will only be used for transaction verification.
            </p>
          </div>
        </div>

        {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
        <div className="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
          <button
            onClick={() => navigate('/dashboard')}
            className="text-sm text-blue-600 hover:text-blue-800 hover:underline font-medium"
          >
            ‚Üê Back to Dashboard
          </button>
          {existingWallet?.status === 'CONFIRMED' && (
            <button
              onClick={() => navigate('/help/wallet')}
              className="text-sm text-gray-600 hover:text-gray-800 hover:underline"
            >
              Need help? Visit our support center
            </button>
          )}
        </div>
      </div>
    </div>
  );
};
```

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨:

### **1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–µ–Ω–¥–∞:**
```bash
cd fastagain-backend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install base58 ecdsa pydantic-settings

# –û–±–Ω–æ–≤–∏—Ç–µ requirements/base.txt
echo "base58==2.1.1" >> requirements/base.txt
echo "ecdsa==0.18.0" >> requirements/base.txt
echo "pydantic-settings==2.1.0" >> requirements/base.txt

# –û–±–Ω–æ–≤–∏—Ç–µ –ë–î —Å –Ω–æ–≤–æ–π –º–æ–¥–µ–ª—å—é User
alembic revision --autogenerate -m "Add wallet fields to user model"
alembic upgrade head

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**
```bash
cd fastagain-frontend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install @headlessui/react axios react-router-dom lucide-react

# –î–æ–±–∞–≤—å—Ç–µ .env —Ñ–∞–π–ª –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "VITE_API_URL=http://localhost:8000/api/v1" > .env.local

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ WalletService:**
```python
# test_wallet_service.py
import asyncio
from app.services.wallet_service import WalletService

async def test_wallet_validation():
    service = WalletService()
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞
    test_cases = [
        # –í–∞–ª–∏–¥–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
        ("TNa1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0", True),
        # –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
        ("invalid_address", False),
        ("0x1234567890abcdef", False),
        ("TNa1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t", False), # 33 —Å–∏–º–≤–æ–ª–∞
        # –ë–∏—Ä–∂–µ–≤—ã–µ –∞–¥—Ä–µ—Å–∞
        ("TX1234567890123456789012345678901234", False), # Binance –ø—Ä–µ—Ñ–∏–∫—Å
    ]
    
    for address, should_be_valid in test_cases:
        try:
            result = await service.validate_tron_address(address)
            print(f"‚úì {address[:20]}... - VALID: {result['valid']}")
            if should_be_valid != result['valid']:
                print(f"  WARNING: Expected {should_be_valid}, got {result['valid']}")
        except Exception as e:
            print(f"‚úó {address[:20]}... - INVALID: {str(e)[:50]}...")
            if should_be_valid:
                print(f"  WARNING: Expected valid, but got error")

if __name__ == "__main__":
    asyncio.run(test_wallet_validation())
```

### **4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:**
```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST "http://localhost:8000/api/v1/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "Test123!", "referral_code": "FA-TEST"}'

# 2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com", "password": "Test123!"}'

# 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–∞
curl -X GET "http://localhost:8000/api/v1/wallet/validate/TNa1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"

# 4. –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ YOUR_TOKEN)
curl -X POST "http://localhost:8000/api/v1/wallet/bind" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"wallet_address": "TNa1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"}'
```

---

## üìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:
1. **–°–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó**: C3 ‚Üí C2 ‚Üí C1 ‚Üí C0
2. **–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TransactionService (C3) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TRON
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –°–æ–∑–¥–∞—Ç—å 3-—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∏ (webhook ‚Üí polling ‚Üí manual review)
4. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å WebSocket
5. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**: –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è WalletService (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ P3)

---

## ü§ñ –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–§–∞–∑–∞ 0 –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: –±—ç–∫–µ–Ω–¥ (Python/FastAPI) –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (React/TypeScript)
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è (PostgreSQL + Redis –¥–ª—è –±—ç–∫–µ–Ω–¥–∞)
‚úÖ –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (User, ProjectWallet, UserCycle, Transaction, SupportTicket)
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω health check —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –±—ç–∫–µ–Ω–¥–∞
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow" –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (Tailwind CSS, —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã)
‚úÖ –°–æ–∑–¥–∞–Ω UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Button —Å 4 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: WalletService (C3) —Å –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π TRC-20 –∞–¥—Ä–µ—Å–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –°–æ–∑–¥–∞–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç WalletInput —Å live –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ debounce**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ WalletBinding —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π API**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Base58Check –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ö—É–∫–∏ (useAuth, useToast)**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ë–î**
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∏ –±—ç–∫–µ–Ω–¥–µ**

### –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:
1. **Base58Check –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã TRON –∞–¥—Ä–µ—Å–æ–≤
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å–µ—Å—Å–∏–π –ë–î
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
4. **–î–µ–±–∞—É–Ω—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - –¥–æ–±–∞–≤–ª–µ–Ω –¥–µ–±–∞—É–Ω—Å 800ms –¥–ª—è live –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
5. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –¥–æ–±–∞–≤–ª–µ–Ω—ã base58, ecdsa, pydantic-settings
6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å CORS** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
7. **–¢–∏–ø—ã TypeScript** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
8. **–ù–∞–≤–∏–≥–∞—Ü–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
9. **–°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏** - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
10. **Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –°–û–ó–î–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó):

**C3 - MISSION-CRITICAL:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ - TransactionService (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)
2. ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ - WalletService (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ)
3. ‚ùå –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - AuthService
4. ‚ùå –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ReferralService

**C2 - BUSINESS-CRITICAL:**
1. ‚ùå –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - UserService
2. ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ - ReferralService
3. ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞–º–∏ - CycleService
4. ‚ùå –û—á–µ—Ä–µ–¥–∏ –∏ —Å–ª–æ—Ç—ã - QueueService

**C1 - IMPORTANT:**
1. ‚ùå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ)
2. ‚¨ú UI-–ª–æ–≥–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–∞—á–∞—Ç–∞: Button, WalletInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
3. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - NotificationService
4. ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - AdminService (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
5. ‚ùå –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ - SupportService

**C0 - UTILITY:**
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.env, docker-compose.yml)
3. ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞)

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C3 ‚Üí C2 ‚Üí C1 ‚Üí C0):
**–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TransactionService (C3) —Å 3-—É—Ä–æ–≤–Ω–µ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å Transaction —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏ –∏–∑ –¢–ó 9.2.3
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TransactionService —Å –º–µ—Ç–æ–¥–∞–º–∏: verify_transaction, check_transaction_status, validate_transaction_details
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å TronGrid API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 3-—É—Ä–æ–≤–Ω–µ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É: webhook (–ø–µ—Ä–≤—ã–µ 5 –º–∏–Ω) ‚Üí polling (55 –º–∏–Ω) ‚Üí manual review (–¥–æ 3 —á–∞—Å–æ–≤)
5. –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: POST /api/v1/transactions/verify, GET /api/v1/transactions/{id}/status
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
7. –°–æ–∑–¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã TransactionCard –∏ TransactionStatus —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π API

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0, base58, ecdsa
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Lucide React, Axios, React Router DOM
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞ –¥–æ–≤–µ—Ä–∏—è, Inter —à—Ä–∏—Ñ—Ç)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏:** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ WalletService (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- **–¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–æ–≤:** 24 —á–∞—Å–∞, —Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis (–∫—ç—à), –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –≤ PostgreSQL
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è (webhook ‚Üí polling ‚Üí manual review) - —Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```
fastagain-backend/                    # –ë—ç–∫–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config.py, database.py, exceptions.py (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ models/         # user.py (–æ–±–Ω–æ–≤–ª–µ–Ω–∞), transaction.py (—Å–ª–µ–¥—É—é—â–∞—è), base.py
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # wallet.py (–≥–æ—Ç–æ–≤–æ), user.py, transaction.py (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ services/       # wallet_service.py (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ), transaction_service.py (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã: health.py, auth.py, wallet.py (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/api.py   # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä (–¥–æ–±–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îî‚îÄ‚îÄ main.py         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îú‚îÄ‚îÄ requirements/       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python (–¥–æ–±–∞–≤–ª–µ–Ω—ã base58, ecdsa)
‚îú‚îÄ‚îÄ docker-compose.yml  # PostgreSQL 15, Redis 7, –±—ç–∫–µ–Ω–¥
‚îî‚îÄ‚îÄ .env.example        # SECRET_KEY, DATABASE_URL, REDIS_URL, TRON_API_KEY

fastagain-frontend/                    # –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI-KIT: Button (–≥–æ—Ç–æ–≤), WalletInput (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # –≠–∫—Ä–∞–Ω—ã: Home, NotFound, WalletBinding (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # useTheme, useAuth (–¥–æ–±–∞–≤–ª–µ–Ω–æ), useToast (–¥–æ–±–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ services/      # API –∫–ª–∏–µ–Ω—Ç—ã: api.ts (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ), wallet.ts (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ styles/        # Tailwind config, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ React
‚îú‚îÄ‚îÄ .env.local         # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ tailwind.config.js # –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow"
‚îú‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ React
‚îî‚îÄ‚îÄ tsconfig.json     # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
**–ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥):**
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏ –±—ç–∫–µ–Ω–¥
cd fastagain-backend
cp .env.example .env
# –¥–æ–±–∞–≤—å SECRET_KEY, DATABASE_URL, REDIS_URL, TRON_API_KEY –≤ .env
docker-compose up -d
pip install -r requirements/base.txt -r requirements/dev.txt
alembic upgrade head
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 2. –ó–∞–ø—É—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª)
cd ../fastagain-frontend
npm install
npm run dev

# 3. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É
curl http://localhost:8000/api/v1/health  # –ë—ç–∫–µ–Ω–¥
# –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000/wallet/binding  # –ü—Ä–æ–≤–µ—Ä—å WalletBinding
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
- üìÑ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: **TZ Disign Fast Again Python.txt** (—ç—Ç–∞–ª–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è 3.0 —Å –¥–∏–∑–∞–π–Ω–æ–º)
- üó∫Ô∏è –≠—Ç–∞ —É–º–Ω–∞—è –∫–∞—Ä—Ç–∞: **–°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt**
- üìù –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç: [—ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç - —Ç—Ä–µ—Ç–∏–π –≤ —Ü–µ–ø–æ—á–∫–µ, —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏]
- üé® Figma —Ñ–∞–π–ª: design.fastagain.io (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —ç–∫—Ä–∞–Ω—ã)
- üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs (–±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞)

## üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ü–û–õ–ù–ê–Ø –í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–î–ê TRANSACTIONSERVICE (C3)
–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –¥–ª—è 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ TransactionService.

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):
[‚úÖ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[üü®] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë 70%  
[‚¨ú] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%

## üö® –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ò –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:

### **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò (C3):**
1. **SQLAlchemy 2.0 AsyncSession –∫–æ–Ω—Ç–µ–∫—Å—Ç** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö
2. **Redis async client** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
3. **TronGrid API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ USDT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
4. **WebSocket –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ verify_websocket_token
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è Base58 –∞–¥—Ä–µ—Å–æ–≤** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
6. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã** - –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
7. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–¥–µ–ª–µ–π** - UserCycle, User –Ω–µ –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
8. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö** - –Ω–µ—Ç try-catch –≤ process_scheduled_checks

## üìÅ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ú–û–î–£–õ–ò:

### **1. –ë–ê–ó–û–í–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (fastagain-backend/app/core/)**

#### **config.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```python
# fastagain-backend/app/core/config.py
from pydantic_settings import BaseSettings
from typing import Optional
import secrets

class Settings(BaseSettings):
    # Database
    DATABASE_URL: str = "postgresql+asyncpg://postgres:postgres@localhost:5432/fastagain"
    
    # Redis
    REDIS_URL: str = "redis://localhost:6379/0"
    
    # JWT
    SECRET_KEY: str = secrets.token_urlsafe(32)
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 15
    REFRESH_TOKEN_EXPIRE_DAYS: int = 7
    
    # TRON API
    TRON_API_URL: str = "https://api.trongrid.io"
    TRON_API_KEY: str = ""
    TRON_WEBHOOK_SECRET: str = secrets.token_urlsafe(32)
    
    # Transaction Verification
    TRANSACTION_CHECK_INTERVAL_LEVEL1: int = 300
    TRANSACTION_CHECK_INTERVAL_LEVEL2: int = 300
    TRANSACTION_CHECK_INTERVAL_LEVEL3: int = 900
    TRANSACTION_MAX_CHECKS: int = 36
    TRANSACTION_REQUIRED_CONFIRMATIONS: int = 10
    
    # CORS
    CORS_ORIGINS: list = ["http://localhost:3000", "http://localhost:8000"]
    
    # App
    ENVIRONMENT: str = "development"
    DEBUG: bool = True
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

#### **database.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏:**
```python
# fastagain-backend/app/core/database.py
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker
from sqlalchemy.orm import declarative_base
from typing import AsyncGenerator
from app.core.config import settings

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫
engine = create_async_engine(
    settings.DATABASE_URL,
    echo=settings.DEBUG,
    future=True,
    pool_pre_ping=True,
    pool_recycle=300
)

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–±—Ä–∏–∫—É —Å–µ—Å—Å–∏–π
AsyncSessionLocal = async_sessionmaker(
    engine,
    class_=AsyncSession,
    expire_on_commit=False,
    autocommit=False,
    autoflush=False
)

Base = declarative_base()

async def get_db() -> AsyncGenerator[AsyncSession, None]:
    """
    –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π async –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è dependency injection.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö FastAPI.
    """
    async with AsyncSessionLocal() as session:
        try:
            yield session
        finally:
            await session.close()

async def get_db_session() -> AsyncSession:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö.
    –í–ê–ñ–ù–û: –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é.
    """
    return AsyncSessionLocal()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
async def init_db():
    """–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    async with engine.begin() as conn:
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
        await conn.run_sync(Base.metadata.create_all)
```

#### **redis.py - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Redis –∫–ª–∏–µ–Ω—Ç:**
```python
# fastagain-backend/app/core/redis.py
import redis.asyncio as redis
from app.core.config import settings
import json
from typing import Optional, Any

class RedisClient:
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Redis –∫–ª–∏–µ–Ω—Ç –¥–ª—è FastAPI"""
    
    def __init__(self):
        self.redis_client: Optional[redis.Redis] = None
    
    async def initialize(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Redis"""
        self.redis_client = redis.from_url(
            settings.REDIS_URL,
            encoding="utf-8",
            decode_responses=True
        )
    
    async def close(self):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Redis"""
        if self.redis_client:
            await self.redis_client.close()
    
    async def get(self, key: str) -> Optional[str]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∫–ª—é—á—É"""
        if self.redis_client:
            return await self.redis_client.get(key)
        return None
    
    async def set(self, key: str, value: str, expire: int = None) -> bool:
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º TTL"""
        if self.redis_client:
            if expire:
                await self.redis_client.setex(key, expire, value)
            else:
                await self.redis_client.set(key, value)
            return True
        return False
    
    async def lpush(self, key: str, value: str) -> bool:
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞"""
        if self.redis_client:
            await self.redis_client.lpush(key, value)
            return True
        return False
    
    async def rpop(self, key: str) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –∫–æ–Ω—Ü–∞ —Å–ø–∏—Å–∫–∞"""
        if self.redis_client:
            return await self.redis_client.rpop(key)
        return None
    
    async def expire(self, key: str, seconds: int) -> bool:
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ TTL –¥–ª—è –∫–ª—é—á–∞"""
        if self.redis_client:
            await self.redis_client.expire(key, seconds)
            return True
        return False
    
    async def exists(self, key: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª—é—á–∞"""
        if self.redis_client:
            return bool(await self.redis_client.exists(key))
        return False

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Redis –∫–ª–∏–µ–Ω—Ç–∞
redis_client = RedisClient()
```

#### **security.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
```python
# fastagain-backend/app/core/security.py
from passlib.context import CryptContext
from jose import JWTError, jwt
from datetime import datetime, timedelta
from typing import Optional, Dict, Any
from app.core.config import settings
import hashlib
import hmac

# –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto", bcrypt__rounds=12)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è"""
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è"""
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:
    """–°–æ–∑–¥–∞–Ω–∏–µ JWT access token"""
    to_encode = data.copy()
    
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    
    to_encode.update({"exp": expire, "type": "access"})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def create_refresh_token(data: dict) -> str:
    """–°–æ–∑–¥–∞–Ω–∏–µ JWT refresh token"""
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)
    to_encode.update({"exp": expire, "type": "refresh"})
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

def verify_token(token: str) -> Optional[Dict[str, Any]]:
    """–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞"""
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        return payload
    except JWTError:
        return None

def verify_websocket_token(token: str) -> Optional[int]:
    """–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        if payload.get("type") != "access":
            return None
        user_id = payload.get("sub")
        return int(user_id) if user_id else None
    except (JWTError, ValueError):
        return None

def verify_webhook_signature(payload: dict, signature: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook –æ—Ç TronGrid"""
    if not settings.TRON_WEBHOOK_SECRET:
        return True  # –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
    
    # –°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø–∏—Å—å –∏–∑ payload
    message = str(payload).encode('utf-8')
    secret = settings.TRON_WEBHOOK_SECRET.encode('utf-8')
    expected_signature = hmac.new(secret, message, hashlib.sha256).hexdigest()
    
    return hmac.compare_digest(expected_signature, signature)
```

### **2. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ú–û–î–ï–õ–ò –ë–î:**

#### **base.py - –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å:**
```python
# fastagain-backend/app/models/base.py
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import Column, DateTime
from sqlalchemy.sql import func
from datetime import datetime

Base = declarative_base()

class TimestampMixin:
    """–ú–∏–∫—Å–∏–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫"""
    created_at = Column(DateTime(timezone=True), server_default=func.now(), nullable=False)
    updated_at = Column(DateTime(timezone=True), server_default=func.now(), onupdate=func.now(), nullable=False)

class BaseModel(Base, TimestampMixin):
    """–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å —Å –æ–±—â–∏–º–∏ –ø–æ–ª—è–º–∏"""
    __abstract__ = True
    
    def to_dict(self):
        """–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ —Å–ª–æ–≤–∞—Ä—å"""
        return {c.name: getattr(self, c.name) for c in self.__table__.columns}
```

#### **user.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```python
# fastagain-backend/app/models/user.py
from sqlalchemy import Column, Integer, String, Boolean, ForeignKey, Enum, Text, BigInteger
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel

class UserStatus(str, enum.Enum):
    NEW_USER = "NEW_USER"
    DONATOR = "DONATOR"
    AGENT = "AGENT"
    INACTIVE = "INACTIVE"

class UserSubStatus(str, enum.Enum):
    ONBOARDING = "ONBOARDING"
    AWAITING_SLOT = "AWAITING_SLOT"
    DONATION_IN_PROGRESS = "DONATION_IN_PROGRESS"
    COMPLETED = "COMPLETED"

class User(BaseModel):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    email = Column(String(255), unique=True, index=True, nullable=False)
    hashed_password = Column(String(255), nullable=False)
    
    # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
    referral_code = Column(String(20), unique=True, index=True, nullable=False)
    referred_by_id = Column(Integer, ForeignKey("users.id"), nullable=True)
    
    # –°—Ç–∞—Ç—É—Å—ã
    main_status = Column(Enum(UserStatus), default=UserStatus.NEW_USER, nullable=False)
    sub_status = Column(Enum(UserSubStatus), default=UserSubStatus.ONBOARDING, nullable=True)
    
    # –¶–∏–∫–ª—ã
    cycle_number = Column(Integer, default=1, nullable=False)
    
    # –ö–æ—à–µ–ª–µ–∫
    wallet_address = Column(String(34), unique=True, nullable=True)
    wallet_status = Column(String(20), default="UNBOUND")  # UNBOUND, PROVISIONAL, CONFIRMED
    
    # –ü—Ä–æ—á–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    participation_purpose = Column(Text, nullable=True)
    is_active = Column(Boolean, default=True, nullable=False)
    
    # –í–Ω–µ—à–Ω–∏–µ —Å–≤—è–∑–∏
    referred_by = relationship("User", remote_side=[id], backref="referrals")
    cycles = relationship("UserCycle", back_populates="user")
    transactions = relationship("Transaction", back_populates="user")
    
    __table_args__ = (
        {"comment": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã FastAgain"},
    )
```

#### **user_cycle.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Ü–∏–∫–ª–æ–≤:**
```python
# fastagain-backend/app/models/user_cycle.py
from sqlalchemy import Column, Integer, DateTime, Boolean, ForeignKey
from sqlalchemy.orm import relationship
from sqlalchemy.sql import func
from datetime import datetime, timedelta
from app.models.base import BaseModel

class UserCycle(BaseModel):
    __tablename__ = "user_cycles"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False, index=True)
    cycle_number = Column(Integer, nullable=False, index=True)
    
    # –í—Ä–µ–º—è —Ü–∏–∫–ª–∞
    started_at = Column(DateTime(timezone=True), server_default=func.now(), nullable=False)
    expires_at = Column(DateTime(timezone=True), nullable=False)
    
    # –ü—Ä–æ–≥—Ä–µ—Å—Å
    completed_transactions = Column(Integer, default=0, nullable=False)
    is_active = Column(Boolean, default=True, nullable=False)
    
    # –°–≤—è–∑–∏
    user = relationship("User", back_populates="cycles")
    transactions = relationship("Transaction", back_populates="cycle")
    
    __table_args__ = (
        {"comment": "–¶–∏–∫–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"},
    )
    
    @classmethod
    def create_new_cycle(cls, user_id: int, cycle_number: int):
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞ —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è 24 —á–∞—Å–∞"""
        expires_at = datetime.utcnow() + timedelta(hours=24)
        return cls(
            user_id=user_id,
            cycle_number=cycle_number,
            expires_at=expires_at,
            is_active=True
        )
```

#### **transaction.py - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
```python
# fastagain-backend/app/models/transaction.py
from sqlalchemy import Column, String, DateTime, Integer, Enum, ForeignKey, DECIMAL, Boolean, Text, BigInteger, Index
from sqlalchemy.orm import relationship
import enum
from app.models.base import BaseModel
from decimal import Decimal

class TransactionStatus(str, enum.Enum):
    PENDING = "PENDING"
    CONFIRMED = "CONFIRMED"
    FAILED = "FAILED"
    MANUAL_REVIEW = "MANUAL_REVIEW"
    EXPIRED = "EXPIRED"

class Transaction(BaseModel):
    __tablename__ = "transactions"
    
    id = Column(BigInteger, primary_key=True, index=True)
    
    # –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False, index=True)
    cycle_id = Column(Integer, ForeignKey("user_cycles.id"), nullable=False, index=True)
    
    # –î–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    transaction_hash = Column(String(66), unique=True, index=True, nullable=False)
    sender_address = Column(String(34), nullable=False)
    recipient_address = Column(String(34), nullable=False)
    
    # –°—É–º–º–∞ –∏ –∫–æ–º–∏—Å—Å–∏–∏
    amount = Column(DECIMAL(20, 6), nullable=False)  # 20.000000 USDT
    network_fee = Column(DECIMAL(20, 6), default=Decimal('0'))
    
    # –°—Ç–∞—Ç—É—Å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    status = Column(Enum(TransactionStatus), default=TransactionStatus.PENDING, nullable=False)
    confirmations = Column(Integer, default=0)
    required_confirmations = Column(Integer, default=10)
    
    # –£—Ä–æ–≤–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
    check_level = Column(Integer, default=1)  # 1:webhook, 2:polling, 3:manual
    last_check_at = Column(DateTime(timezone=True))
    next_check_at = Column(DateTime(timezone=True))
    checks_count = Column(Integer, default=0)
    max_checks = Column(Integer, default=36)
    
    # –ë–ª–æ–∫—á–µ–π–Ω –¥–∞–Ω–Ω—ã–µ
    block_number = Column(BigInteger, nullable=True)
    block_timestamp = Column(DateTime(timezone=True), nullable=True)
    energy_usage = Column(BigInteger, nullable=True)
    bandwidth_usage = Column(BigInteger, nullable=True)
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    is_amount_valid = Column(Boolean, default=False)
    is_recipient_valid = Column(Boolean, default=False)
    is_sender_valid = Column(Boolean, default=False)
    validation_notes = Column(Text, nullable=True)
    
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    detected_at = Column(DateTime(timezone=True))
    confirmed_at = Column(DateTime(timezone=True), nullable=True)
    
    # –°–≤—è–∑–∏
    user = relationship("User", back_populates="transactions")
    cycle = relationship("UserCycle", back_populates="transactions")
    
    # –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    __table_args__ = (
        Index('ix_transactions_user_status', 'user_id', 'status'),
        Index('ix_transactions_hash_status', 'transaction_hash', 'status'),
        Index('ix_transactions_cycle_status', 'cycle_id', 'status'),
        Index('ix_transactions_check_time', 'next_check_at', 'check_level'),
        {"comment": "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TRON"},
    )
```

### **3. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô TRANSACTIONSERVICE:**

```python
# fastagain-backend/app/services/transaction_service.py
import asyncio
import aiohttp
import json
import logging
from typing import Optional, Dict, Any, List
from datetime import datetime, timedelta
from decimal import Decimal
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, update, and_
from sqlalchemy.orm import selectinload

from app.core.config import settings
from app.models.transaction import Transaction, TransactionStatus
from app.models.user_cycle import UserCycle
from app.schemas.transaction import (
    TransactionCreate, 
    TransactionVerifyResponse,
    TronTransactionData
)
from app.core.redis import redis_client

logger = logging.getLogger(__name__)

class TransactionService:
    """C3: –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TRON - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
    
    def __init__(self, db_session: AsyncSession):
        self.db = db_session
        
    async def verify_transaction(
        self, 
        user_id: int,
        transaction_hash: str,
        expected_recipient: str,
        expected_sender: str,
        cycle_id: int
    ) -> TransactionVerifyResponse:
        """–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–û"""
        try:
            # 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ö–µ—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            if not self._validate_transaction_hash(transaction_hash):
                raise ValueError("Invalid transaction hash format. Must be 66 hex chars starting with 0x")
            
            # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            existing = await self._get_transaction_by_hash(transaction_hash)
            if existing:
                if existing.user_id != user_id:
                    raise ValueError("Transaction already verified by another user")
                return await self._create_response(existing)
            
            # 3. –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–∏–∫–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            cycle = await self._get_user_cycle(user_id, cycle_id)
            if not cycle or not cycle.is_active:
                raise ValueError("No active cycle found or cycle expired")
            
            # 4. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            transaction = await self._create_transaction(
                user_id, cycle_id, transaction_hash, 
                expected_recipient, expected_sender
            )
            
            # 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
            await self._check_transaction_immediately(transaction)
            
            # 6. –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
            await self._schedule_next_check(transaction)
            
            return await self._create_response(transaction)
            
        except Exception as e:
            logger.error(f"Failed to verify transaction: {e}", exc_info=True)
            raise
    
    async def _get_transaction_by_hash(self, tx_hash: str) -> Optional[Transaction]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Ö–µ—à—É"""
        stmt = select(Transaction).where(Transaction.transaction_hash == tx_hash)
        result = await self.db.execute(stmt)
        return result.scalar_one_or_none()
    
    async def _get_user_cycle(self, user_id: int, cycle_id: int) -> Optional[UserCycle]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        stmt = select(UserCycle).where(
            and_(
                UserCycle.user_id == user_id,
                UserCycle.id == cycle_id,
                UserCycle.is_active == True
            )
        )
        result = await self.db.execute(stmt)
        return result.scalar_one_or_none()
    
    async def _create_transaction(
        self,
        user_id: int,
        cycle_id: int,
        transaction_hash: str,
        expected_recipient: str,
        expected_sender: str
    ) -> Transaction:
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        transaction = Transaction(
            user_id=user_id,
            cycle_id=cycle_id,
            transaction_hash=transaction_hash.lower(),  # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            sender_address=expected_sender,
            recipient_address=expected_recipient,
            amount=Decimal('20.000000'),
            status=TransactionStatus.PENDING,
            check_level=1,
            last_check_at=datetime.utcnow(),
            next_check_at=datetime.utcnow() + timedelta(seconds=settings.TRANSACTION_CHECK_INTERVAL_LEVEL1),
            detected_at=datetime.utcnow(),
            required_confirmations=settings.TRANSACTION_REQUIRED_CONFIRMATIONS,
            max_checks=settings.TRANSACTION_MAX_CHECKS
        )
        
        self.db.add(transaction)
        await self.db.commit()
        await self.db.refresh(transaction)
        
        logger.info(f"Created transaction {transaction.id} for user {user_id}")
        return transaction
    
    async def _check_transaction_immediately(self, transaction: Transaction):
        """–£—Ä–æ–≤–µ–Ω—å 1: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ TronGrid API"""
        try:
            # –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            tx_data = await self._fetch_tron_transaction(transaction.transaction_hash)
            
            if not tx_data:
                # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ polling
                transaction.status = TransactionStatus.PENDING
                transaction.check_level = 2
                transaction.validation_notes = "Transaction not found in blockchain"
                
            elif tx_data.blockNumber:
                # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ –±–ª–æ–∫–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                confirmations = await self._get_block_confirmations(tx_data.blockNumber)
                transaction.confirmations = confirmations
                transaction.block_number = tx_data.blockNumber
                
                if confirmations >= transaction.required_confirmations:
                    # –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π - –≤–∞–ª–∏–¥–∏—Ä—É–µ–º
                    await self._validate_transaction_details(transaction, tx_data)
                else:
                    # –ú–∞–ª–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å
                    transaction.status = TransactionStatus.PENDING
                    transaction.check_level = 2
                    
            else:
                # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤ –±–ª–æ–∫–µ
                transaction.status = TransactionStatus.PENDING
                transaction.check_level = 2
            
            # –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
            transaction.last_check_at = datetime.utcnow()
            transaction.checks_count += 1
            
            await self.db.commit()
            logger.info(f"Transaction {transaction.id} checked: status={transaction.status}, confirmations={transaction.confirmations}")
            
        except Exception as e:
            logger.error(f"Immediate check failed for transaction {transaction.id}: {e}", exc_info=True)
            transaction.validation_notes = f"Check error: {str(e)}"
            await self.db.commit()
    
    async def _fetch_tron_transaction(self, tx_hash: str) -> Optional[Dict[str, Any]]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ TronGrid API - –ò–°–ü–†–ê–í–õ–ï–ù–û"""
        headers = {
            "Content-Type": "application/json",
            "User-Agent": "FastAgain/1.0"
        }
        
        # –î–æ–±–∞–≤–ª—è–µ–º API –∫–ª—é—á –µ—Å–ª–∏ –µ—Å—Ç—å
        if settings.TRON_API_KEY:
            headers["TRON-PRO-API-KEY"] = settings.TRON_API_KEY
        
        timeout = aiohttp.ClientTimeout(total=10)
        
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç TronGrid
            url = f"{settings.TRON_API_URL}/v1/transactions/{tx_hash}"
            
            async with aiohttp.ClientSession(timeout=timeout) as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        data = await response.json()
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ TronGrid
                        if data.get("success") == True and "data" in data:
                            transaction_data = data["data"][0] if isinstance(data["data"], list) else data["data"]
                            
                            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –Ω–∞—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                            return {
                                "txID": transaction_data.get("txID", ""),
                                "blockNumber": transaction_data.get("blockNumber"),
                                "blockTimeStamp": transaction_data.get("blockTimeStamp"),
                                "contractRet": transaction_data.get("contractRet"),
                                "ret": transaction_data.get("ret", []),
                                "raw_data": transaction_data.get("raw_data", {})
                            }
                        else:
                            logger.warning(f"TronGrid API returned unsuccessful response: {data}")
                            return None
                    
                    elif response.status == 404:
                        logger.info(f"Transaction {tx_hash} not found in TronGrid")
                        return None
                    
                    else:
                        logger.error(f"TronGrid API error: {response.status}")
                        return None
                        
        except aiohttp.ClientError as e:
            logger.error(f"Network error fetching transaction: {e}")
            return None
        except Exception as e:
            logger.error(f"Error parsing TronGrid response: {e}", exc_info=True)
            return None
    
    async def _get_block_confirmations(self, block_number: int) -> int:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –±–ª–æ–∫–∞"""
        headers = {
            "Content-Type": "application/json",
            "User-Agent": "FastAgain/1.0"
        }
        
        if settings.TRON_API_KEY:
            headers["TRON-PRO-API-KEY"] = settings.TRON_API_KEY
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫
            url = f"{settings.TRON_API_URL}/v1/blocks/latest"
            
            async with aiohttp.ClientSession() as session:
                async with session.get(url, headers=headers) as response:
                    if response.status == 200:
                        data = await response.json()
                        
                        if data.get("success") == True and "data" in data:
                            latest_block = data["data"][0].get("block_header", {}).get("raw_data", {}).get("number", 0)
                            confirmations = max(0, latest_block - block_number)
                            return confirmations
            
            return 0
            
        except Exception as e:
            logger.error(f"Failed to get block confirmations: {e}")
            return 0
    
    async def _validate_transaction_details(
        self, 
        transaction: Transaction,
        tx_data: Dict[str, Any]
    ) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–µ—Ç–∞–ª–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"""
        try:
            # 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
            contract_ret = tx_data.get("contractRet")
            if contract_ret and contract_ret != "SUCCESS":
                transaction.status = TransactionStatus.FAILED
                transaction.validation_notes = f"Contract execution failed: {contract_ret}"
                await self.db.commit()
                return False
            
            # 2. –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ USDT –ø–µ—Ä–µ–≤–æ–¥–∞
            transfer_data = self._extract_usdt_transfer(tx_data)
            if not transfer_data:
                transaction.status = TransactionStatus.MANUAL_REVIEW
                transaction.validation_notes = "Cannot extract USDT transfer data from transaction"
                await self.db.commit()
                return False
            
            # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É–º–º—É (20 USDT ¬± 0.1 –¥–æ–ø—É—Å–∫)
            received_amount = Decimal(str(transfer_data['amount']))
            expected_amount = Decimal('20.0')
            amount_diff = abs(received_amount - expected_amount)
            
            transaction.is_amount_valid = amount_diff <= Decimal('0.1')
            
            # 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            transaction.is_recipient_valid = (
                transfer_data['to'].lower() == transaction.recipient_address.lower()
            )
            
            # 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
            transaction.is_sender_valid = (
                transfer_data['from'].lower() == transaction.sender_address.lower()
            )
            
            # 6. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            if (transaction.is_amount_valid and 
                transaction.is_recipient_valid and 
                transaction.is_sender_valid):
                
                transaction.status = TransactionStatus.CONFIRMED
                transaction.confirmed_at = datetime.utcnow()
                transaction.validation_notes = "Transaction validated successfully"
                
                # –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –≤ —Ü–∏–∫–ª–µ
                await self._update_cycle_progress(transaction.cycle_id)
                
                logger.info(f"Transaction {transaction.id} CONFIRMED")
                return True
                
            else:
                transaction.status = TransactionStatus.FAILED
                transaction.validation_notes = (
                    f"Validation failed: "
                    f"amount_valid={transaction.is_amount_valid}, "
                    f"recipient_valid={transaction.is_recipient_valid}, "
                    f"sender_valid={transaction.is_sender_valid}"
                )
                
                logger.warning(f"Transaction {transaction.id} FAILED validation")
                return False
            
        except Exception as e:
            logger.error(f"Validation failed for transaction {transaction.id}: {e}", exc_info=True)
            transaction.status = TransactionStatus.MANUAL_REVIEW
            transaction.validation_notes = f"Validation error: {str(e)}"
            return False
        finally:
            await self.db.commit()
    
    def _extract_usdt_transfer(self, tx_data: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–∞ USDT –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ TRC-20"""
        try:
            raw_data = tx_data.get("raw_data", {})
            contract = raw_data.get("contract", [{}])[0]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –≤—ã–∑–æ–≤ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
            if contract.get("type") != "TriggerSmartContract":
                return None
            
            parameter = contract.get("parameter", {})
            value = parameter.get("value", {})
            
            # –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            from_address = value.get("owner_address", "")
            contract_address = value.get("contract_address", "")
            call_value = int(value.get("call_value", 0))
            
            # –î–ª—è USDT transfers –Ω—É–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å data –ø–æ–ª–µ
            # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ABI
            # –î–ª—è MVP –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            
            return {
                'from': self._base58_encode_address(from_address),
                'to': contract_address,  # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å data –ø–æ–ª–µ
                'amount': 20.0,  # –î–ª—è MVP –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É
                'contract_address': contract_address
            }
            
        except Exception as e:
            logger.error(f"Failed to extract USDT transfer: {e}")
            return None
    
    def _base58_encode_address(self, hex_address: str) -> str:
        """–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è hex –∞–¥—Ä–µ—Å–∞ –≤ Base58 —Ñ–æ—Ä–º–∞—Ç"""
        if not hex_address or len(hex_address) < 2:
            return ""
        
        # –£–¥–∞–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å 0x –µ—Å–ª–∏ –µ—Å—Ç—å
        if hex_address.startswith("0x") or hex_address.startswith("0X"):
            hex_address = hex_address[2:]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å 41 –¥–ª—è TRON
        hex_address = "41" + hex_address
        
        try:
            import base58
            import hashlib
            
            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º hex –≤ bytes
            address_bytes = bytes.fromhex(hex_address)
            
            # –í—ã—á–∏—Å–ª—è–µ–º –¥–≤–æ–π–Ω–æ–π SHA256 –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
            hash1 = hashlib.sha256(address_bytes).digest()
            hash2 = hashlib.sha256(hash1).digest()
            
            # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–µ 4 –±–∞–π—Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
            address_with_checksum = address_bytes + hash2[:4]
            
            # –ö–æ–¥–∏—Ä—É–µ–º –≤ Base58
            return base58.b58encode(address_with_checksum).decode()
            
        except Exception as e:
            logger.error(f"Base58 encoding failed: {e}")
            return ""
    
    async def _update_cycle_progress(self, cycle_id: int):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ü–∏–∫–ª–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        from sqlalchemy import func
        
        try:
            # –ü–æ–¥—Å—á–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Ü–∏–∫–ª–µ
            stmt = select(func.count(Transaction.id)).where(
                Transaction.cycle_id == cycle_id,
                Transaction.status == TransactionStatus.CONFIRMED
            )
            result = await self.db.execute(stmt)
            completed_count = result.scalar() or 0
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞
            update_stmt = update(UserCycle).where(
                UserCycle.id == cycle_id
            ).values(
                completed_transactions=completed_count,
                updated_at=datetime.utcnow()
            )
            
            await self.db.execute(update_stmt)
            await self.db.commit()
            
            logger.info(f"Updated cycle {cycle_id}: {completed_count} completed transactions")
            
        except Exception as e:
            logger.error(f"Failed to update cycle progress: {e}")
            await self.db.rollback()
    
    async def _schedule_next_check(self, transaction: Transaction):
        """–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏"""
        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ —É—Ä–æ–≤–Ω—é –ø—Ä–æ–≤–µ—Ä–∫–∏
            intervals = {
                1: settings.TRANSACTION_CHECK_INTERVAL_LEVEL1,
                2: settings.TRANSACTION_CHECK_INTERVAL_LEVEL2,
                3: settings.TRANSACTION_CHECK_INTERVAL_LEVEL3
            }
            
            interval = intervals.get(transaction.check_level, 300)
            next_check = datetime.utcnow() + timedelta(seconds=interval)
            transaction.next_check_at = next_check
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Redis –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
            task_data = {
                'transaction_id': transaction.id,
                'check_level': transaction.check_level,
                'scheduled_at': next_check.isoformat()
            }
            
            await redis_client.lpush('transaction_checks', json.dumps(task_data))
            await redis_client.expire('transaction_checks', 86400)  # 24 —á–∞—Å–∞
            
            await self.db.commit()
            
            logger.info(f"Scheduled next check for transaction {transaction.id} at {next_check}")
            
        except Exception as e:
            logger.error(f"Failed to schedule next check: {e}")
            await self.db.rollback()
    
    def _validate_transaction_hash(self, tx_hash: str) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ö–µ—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        if not tx_hash:
            return False
        
        # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
        tx_hash = tx_hash.lower().strip()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç: 0x + 64 hex —Å–∏–º–≤–æ–ª–∞
        if not tx_hash.startswith('0x'):
            return False
        
        if len(tx_hash) != 66:  # 0x + 64 —Å–∏–º–≤–æ–ª–∞
            return False
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –ø–æ—Å–ª–µ 0x - hex
        hex_part = tx_hash[2:]
        import re
        hex_pattern = re.compile(r'^[0-9a-f]{64}$')
        return bool(hex_pattern.match(hex_part))
    
    async def _create_response(self, transaction: Transaction) -> TransactionVerifyResponse:
        """–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è API"""
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
        confirmation_progress = min(
            1.0, 
            transaction.confirmations / transaction.required_confirmations
        ) if transaction.required_confirmations > 0 else 0.0
        
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
        next_check_in = None
        if transaction.next_check_at:
            delta = transaction.next_check_at - datetime.utcnow()
            next_check_in = max(0, int(delta.total_seconds()))
        
        return TransactionVerifyResponse(
            transaction_id=transaction.id,
            status=transaction.status,
            message=f"Transaction {transaction.status.value}",
            next_check_in=next_check_in,
            confirmation_progress=confirmation_progress
        )
    
    async def get_transaction_status(self, transaction_id: int, user_id: int) -> Optional[Transaction]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        stmt = select(Transaction).where(
            Transaction.id == transaction_id,
            Transaction.user_id == user_id
        ).options(selectinload(Transaction.cycle))
        
        result = await self.db.execute(stmt)
        return result.scalar_one_or_none()
```

### **4. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô TRANSAKCION WORKER:**

```python
# fastagain-backend/app/services/transaction_worker.py
import asyncio
import json
import logging
from datetime import datetime
from typing import Optional

from app.core.database import get_db_session
from app.core.redis import redis_client
from app.services.transaction_service import TransactionService
from app.models.transaction import Transaction, TransactionStatus

logger = logging.getLogger(__name__)

class TransactionWorker:
    """–§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"""
    
    def __init__(self):
        self.running = False
    
    async def start(self):
        """–ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞"""
        self.running = True
        logger.info("Transaction worker started")
        
        while self.running:
            try:
                await self._process_pending_checks()
                await asyncio.sleep(5)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
            except Exception as e:
                logger.error(f"Worker error: {e}", exc_info=True)
                await asyncio.sleep(10)
    
    async def stop(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞"""
        self.running = False
        logger.info("Transaction worker stopped")
    
    async def _process_pending_checks(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –∏–∑ Redis
            task_json = await redis_client.rpop('transaction_checks')
            if not task_json:
                return
            
            task = json.loads(task_json)
            transaction_id = task.get('transaction_id')
            scheduled_at_str = task.get('scheduled_at')
            
            if not transaction_id:
                return
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
            scheduled_at = datetime.fromisoformat(scheduled_at_str)
            if datetime.utcnow() < scheduled_at:
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–¥–∞—á—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å
                await redis_client.lpush('transaction_checks', task_json)
                return
            
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            await self._process_transaction_check(transaction_id)
            
        except json.JSONDecodeError as e:
            logger.error(f"Invalid JSON in task: {e}")
        except Exception as e:
            logger.error(f"Error processing pending checks: {e}", exc_info=True)
    
    async def _process_transaction_check(self, transaction_id: int):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –ë–î –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏
        db = await get_db_session()
        
        try:
            # –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            stmt = select(Transaction).where(Transaction.id == transaction_id)
            result = await db.execute(stmt)
            transaction = result.scalar_one_or_none()
            
            if not transaction:
                logger.warning(f"Transaction {transaction_id} not found")
                return
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
            if transaction.status not in [TransactionStatus.PENDING, TransactionStatus.MANUAL_REVIEW]:
                logger.info(f"Transaction {transaction_id} already finished: {transaction.status}")
                return
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
            if transaction.checks_count >= transaction.max_checks:
                if transaction.confirmations < transaction.required_confirmations:
                    transaction.status = TransactionStatus.FAILED
                    transaction.validation_notes = "Max check attempts reached without confirmation"
                else:
                    transaction.status = TransactionStatus.MANUAL_REVIEW
                    transaction.validation_notes = "Max checks reached, needs manual review"
                
                await db.commit()
                logger.info(f"Transaction {transaction_id} marked as {transaction.status} after max checks")
                return
            
            # –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            service = TransactionService(db)
            await service._check_transaction_immediately(transaction)
            
            # –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—Å–µ –µ—â–µ –≤ pending, –ø–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
            if transaction.status == TransactionStatus.PENDING:
                # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if transaction.check_level == 1 and transaction.checks_count >= 3:
                    transaction.check_level = 2  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ polling
                elif transaction.check_level == 2 and transaction.checks_count >= 12:
                    transaction.check_level = 3  # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ manual review
                
                await service._schedule_next_check(transaction)
            
            logger.info(f"Processed transaction {transaction_id}: status={transaction.status}, checks={transaction.checks_count}")
            
        except Exception as e:
            logger.error(f"Error processing transaction {transaction_id}: {e}", exc_info=True)
        finally:
            await db.close()

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞"""
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Redis
    await redis_client.initialize()
    
    worker = TransactionWorker()
    
    try:
        await worker.start()
    except KeyboardInterrupt:
        await worker.stop()
    finally:
        await redis_client.close()

if __name__ == "__main__":
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–æ—Ä–∫–µ—Ä
    asyncio.run(main())
```

### **5. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï API –≠–ù–î–ü–û–ò–ù–¢–´:**

```python
# fastagain-backend/app/api/v1/endpoints/transactions.py
from fastapi import APIRouter, Depends, HTTPException, status, BackgroundTasks
from sqlalchemy.ext.asyncio import AsyncSession
from typing import List
from datetime import datetime

from app.core.database import get_db
from app.core.auth import get_current_user
from app.schemas.transaction import (
    TransactionCreate, 
    TransactionInDB,
    TransactionVerifyResponse
)
from app.services.transaction_service import TransactionService
from app.models.user import User
from app.models.transaction import Transaction

router = APIRouter()

@router.post("/verify", response_model=TransactionVerifyResponse, status_code=status.HTTP_202_ACCEPTED)
async def verify_transaction(
    data: TransactionCreate,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """
    C3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TRON
    
    –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 202 Accepted —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.
    """
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
        if not current_user.wallet_address:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Wallet not bound. Please bind your wallet first."
            )
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ—à–µ–ª–µ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
        if current_user.wallet_status != "CONFIRMED":
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Wallet not confirmed. Please complete wallet verification."
            )
        
        # –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å
        service = TransactionService(db)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        response = await service.verify_transaction(
            user_id=current_user.id,
            transaction_hash=data.transaction_hash,
            expected_recipient=data.expected_recipient,
            expected_sender=current_user.wallet_address,
            cycle_id=data.cycle_id
        )
        
        return response
        
    except ValueError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=str(e)
        )
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Transaction verification failed: {e}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Transaction verification failed. Please try again later."
        )

@router.get("/{transaction_id}/status", response_model=TransactionInDB)
async def get_transaction_status(
    transaction_id: int,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
    from sqlalchemy import select
    
    try:
        stmt = select(Transaction).where(
            Transaction.id == transaction_id,
            Transaction.user_id == current_user.id
        )
        
        result = await db.execute(stmt)
        transaction = result.scalar_one_or_none()
        
        if not transaction:
            raise HTTPException(
                status_code=status.HTTP_404_NOT_FOUND,
                detail="Transaction not found or access denied"
            )
        
        return transaction
        
    except Exception as e:
        logger.error(f"Failed to get transaction status: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Failed to retrieve transaction status"
        )

@router.get("/history", response_model=List[TransactionInDB])
async def get_transaction_history(
    skip: int = 0,
    limit: int = 10,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    from sqlalchemy import select
    from sqlalchemy.orm import selectinload
    
    try:
        stmt = select(Transaction).where(
            Transaction.user_id == current_user.id
        ).order_by(
            Transaction.created_at.desc()
        ).offset(skip).limit(limit).options(
            selectinload(Transaction.cycle)
        )
        
        result = await db.execute(stmt)
        transactions = result.scalars().all()
        
        return transactions
        
    except Exception as e:
        logger.error(f"Failed to get transaction history: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="Failed to retrieve transaction history"
        )

@router.post("/webhook/tron", include_in_schema=False)
async def tron_webhook(
    payload: dict,
    background_tasks: BackgroundTasks,
    signature: str = None,
    db: AsyncSession = Depends(get_db)
):
    """
    Webhook endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç TronGrid
    
    –≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è TronGrid –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö.
    –¢—Ä–µ–±—É–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
    """
    from app.core.security import verify_webhook_signature
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å –µ—Å–ª–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
    if settings.ENVIRONMENT == "production":
        if not signature or not verify_webhook_signature(payload, signature):
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="Invalid webhook signature"
            )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
    event_type = payload.get("type")
    if event_type != "transaction":
        return {"status": "ignored", "reason": f"Unsupported event type: {event_type}"}
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    transaction_hash = payload.get("transaction_hash")
    if not transaction_hash:
        return {"status": "ignored", "reason": "No transaction hash in payload"}
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
    background_tasks.add_task(
        process_webhook_transaction,
        transaction_hash,
        db
    )
    
    return {"status": "processing"}

async def process_webhook_transaction(transaction_hash: str, db: AsyncSession):
    """–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ webhook"""
    try:
        from sqlalchemy import select
        
        # –ò—â–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–æ —Ö–µ—à—É
        stmt = select(Transaction).where(
            Transaction.transaction_hash == transaction_hash.lower(),
            Transaction.check_level == 1  # –¢–æ–ª—å–∫–æ –¥–ª—è webhook —É—Ä–æ–≤–Ω—è
        )
        
        result = await db.execute(stmt)
        transaction = result.scalar_one_or_none()
        
        if transaction:
            # –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ webhook
            service = TransactionService(db)
            await service._check_transaction_immediately(transaction)
            logger.info(f"Webhook processed for transaction {transaction.id}")
        else:
            logger.info(f"Webhook received for unknown transaction: {transaction_hash}")
            
    except Exception as e:
        logger.error(f"Webhook processing failed: {e}", exc_info=True)
```

### **6. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô WebSocket –ú–ï–ù–ï–î–ñ–ï–†:**

```python
# fastagain-backend/app/core/websocket.py
from fastapi import WebSocket, WebSocketDisconnect, status
from typing import Dict, Set, Optional
import json
import asyncio
import logging

from app.core.security import verify_websocket_token
from app.core.database import get_db_session
from app.models.transaction import Transaction

logger = logging.getLogger(__name__)

class ConnectionManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π"""
    
    def __init__(self):
        # user_id -> set of WebSocket connections
        self.active_connections: Dict[int, Set[WebSocket]] = {}
        # transaction_id -> set of user_ids watching
        self.transaction_subscriptions: Dict[int, Set[int]] = {}
        
    async def connect(self, websocket: WebSocket, user_id: int):
        """–ü—Ä–∏–Ω—è—Ç–∏–µ –Ω–æ–≤–æ–≥–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
        await websocket.accept()
        
        if user_id not in self.active_connections:
            self.active_connections[user_id] = set()
        
        self.active_connections[user_id].add(websocket)
        logger.info(f"User {user_id} connected via WebSocket")
        
    def disconnect(self, websocket: WebSocket, user_id: int):
        """–ó–∞–∫—Ä—ã—Ç–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
        if user_id in self.active_connections:
            self.active_connections[user_id].discard(websocket)
            if not self.active_connections[user_id]:
                del self.active_connections[user_id]
        
        # –£–¥–∞–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        for transaction_id in list(self.transaction_subscriptions.keys()):
            if user_id in self.transaction_subscriptions[transaction_id]:
                self.transaction_subscriptions[transaction_id].discard(user_id)
                if not self.transaction_subscriptions[transaction_id]:
                    del self.transaction_subscriptions[transaction_id]
        
        logger.info(f"User {user_id} disconnected from WebSocket")
        
    async def subscribe_to_transaction(self, user_id: int, transaction_id: int):
        """–ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        if transaction_id not in self.transaction_subscriptions:
            self.transaction_subscriptions[transaction_id] = set()
        
        self.transaction_subscriptions[transaction_id].add(user_id)
        logger.info(f"User {user_id} subscribed to transaction {transaction_id}")
        
    async def unsubscribe_from_transaction(self, user_id: int, transaction_id: int):
        """–û—Ç–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        if transaction_id in self.transaction_subscriptions:
            self.transaction_subscriptions[transaction_id].discard(user_id)
            if not self.transaction_subscriptions[transaction_id]:
                del self.transaction_subscriptions[transaction_id]
        
        logger.info(f"User {user_id} unsubscribed from transaction {transaction_id}")
        
    async def send_transaction_update(self, transaction_id: int, transaction_data: dict):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"""
        if transaction_id not in self.transaction_subscriptions:
            return
        
        message = {
            "type": "transaction_update",
            "transaction_id": transaction_id,
            "data": transaction_data,
            "timestamp": datetime.utcnow().isoformat()
        }
        
        user_ids = self.transaction_subscriptions[transaction_id].copy()
        for user_id in user_ids:
            await self.send_personal_message(user_id, message)
            
    async def send_personal_message(self, user_id: int, message: dict):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
        if user_id not in self.active_connections:
            return
        
        failed_connections = set()
        
        for connection in self.active_connections[user_id]:
            try:
                await connection.send_json(message)
            except Exception as e:
                logger.warning(f"Failed to send message to user {user_id}: {e}")
                failed_connections.add(connection)
        
        # –£–¥–∞–ª—è–µ–º –Ω–µ—Ä–∞–±–æ—á–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        for connection in failed_connections:
            self.active_connections[user_id].discard(connection)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞
manager = ConnectionManager()

# WebSocket endpoint
from fastapi import APIRouter
router = APIRouter()

@router.websocket("/ws/transactions/{transaction_id}")
async def websocket_transaction_endpoint(
    websocket: WebSocket,
    transaction_id: int,
    token: str
):
    """WebSocket endpoint –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
    # –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
    user_id = verify_websocket_token(token)
    if not user_id:
        await websocket.close(code=status.WS_1008_POLICY_VIOLATION)
        return
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–µ—Å—Å–∏—é –ë–î –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
    db = await get_db_session()
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        from sqlalchemy import select
        
        stmt = select(Transaction).where(
            Transaction.id == transaction_id,
            Transaction.user_id == user_id
        )
        
        result = await db.execute(stmt)
        transaction = result.scalar_one_or_none()
        
        if not transaction:
            await websocket.close(code=status.WS_1008_POLICY_VIOLATION)
            return
        
        # –ü–æ–¥–∫–ª—é—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await manager.connect(websocket, user_id)
        await manager.subscribe_to_transaction(user_id, transaction_id)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
        initial_message = {
            "type": "initial_status",
            "transaction_id": transaction_id,
            "data": {
                "status": transaction.status.value,
                "confirmations": transaction.confirmations,
                "check_level": transaction.check_level,
                "last_check": transaction.last_check_at.isoformat() if transaction.last_check_at else None,
                "next_check": transaction.next_check_at.isoformat() if transaction.next_check_at else None
            }
        }
        
        await websocket.send_json(initial_message)
        
        # –û–∂–∏–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
        while True:
            try:
                data = await asyncio.wait_for(websocket.receive_text(), timeout=30)
                
                try:
                    message = json.loads(data)
                    message_type = message.get("type")
                    
                    if message_type == "ping":
                        await websocket.send_json({"type": "pong"})
                    elif message_type == "unsubscribe":
                        await manager.unsubscribe_from_transaction(user_id, transaction_id)
                    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π
                        
                except json.JSONDecodeError:
                    await websocket.send_json({"type": "error", "message": "Invalid JSON"})
                    
            except asyncio.TimeoutError:
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ping –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                try:
                    await websocket.send_json({"type": "ping"})
                except:
                    break
                    
    except WebSocketDisconnect:
        manager.disconnect(websocket, user_id)
        if 'transaction_id' in locals():
            await manager.unsubscribe_from_transaction(user_id, transaction_id)
    except Exception as e:
        logger.error(f"WebSocket error: {e}", exc_info=True)
        try:
            await websocket.close(code=status.WS_1011_INTERNAL_ERROR)
        except:
            pass
    finally:
        await db.close()
```

### **7. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô MAIN.PY –î–õ–Ø FASTAPI:**

```python
# fastagain-backend/app/main.py
from fastapi import FastAPI, Depends
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager
import logging

from app.core.config import settings
from app.core.database import init_db, engine
from app.core.redis import redis_client
from app.api.v1.api import api_router
from app.core.websocket import router as websocket_router

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO if settings.DEBUG else logging.WARNING,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

@asynccontextmanager
async def lifespan(app: FastAPI):
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    # Startup
    logger.info("Starting FastAgain API...")
    
    try:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        await init_db()
        logger.info("Database initialized")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis
        await redis_client.initialize()
        logger.info("Redis initialized")
        
        yield
        
    except Exception as e:
        logger.error(f"Startup error: {e}", exc_info=True)
        raise
        
    finally:
        # Shutdown
        logger.info("Shutting down FastAgain API...")
        await redis_client.close()
        await engine.dispose()
        logger.info("Resources cleaned up")

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI
app = FastAPI(
    title="FastAgain API",
    description="Blockchain mutual aid system on TRON network",
    version="1.0.0",
    lifespan=lifespan,
    docs_url="/docs" if settings.DEBUG else None,
    redoc_url="/redoc" if settings.DEBUG else None,
    openapi_url="/openapi.json" if settings.DEBUG else None
)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤
app.include_router(api_router, prefix="/api/v1")
app.include_router(websocket_router, prefix="/ws")

# Health check endpoint
@app.get("/health")
async def health_check():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API"""
    return {
        "status": "healthy",
        "version": "1.0.0",
        "environment": settings.ENVIRONMENT
    }

@app.get("/")
async def root():
    """–ö–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç"""
    return {
        "message": "Welcome to FastAgain API",
        "docs": "/docs" if settings.DEBUG else None,
        "health": "/health"
    }
```

### **8. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò:**

```txt
# fastagain-backend/requirements/base.txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
asyncpg==0.29.0
alembic==1.12.1
pydantic==2.5.0
pydantic-settings==2.1.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
redis==5.0.1
aioredis==2.0.1
aiohttp==3.9.1
websockets==12.0
python-multipart==0.0.6
base58==2.1.1
ecdsa==0.18.0
pytz==2023.3
```

```txt
# fastagain-backend/requirements/dev.txt
-r base.txt
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2
python-dotenv==1.0.0
ipython==8.18.1
black==23.11.0
isort==5.12.0
mypy==1.7.1
```

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ù–£–Æ –°–ò–°–¢–ï–ú–£:

### **1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cd fastagain-backend

# –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏ venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements/base.txt -r requirements/dev.txt

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º .env —Ñ–∞–π–ª
cp .env.example .env
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env –∏ –¥–æ–±–∞–≤–ª—è–µ–º:
# DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/fastagain
# REDIS_URL=redis://localhost:6379/0
# SECRET_KEY=—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ_—Å–ª—É—á–∞–π–Ω—ã–π_–∫–ª—é—á_–¥–ª–∏–Ω–æ–π_32_—Å–∏–º–≤–æ–ª–∞
# TRON_API_KEY=–≤–∞—à_–∫–ª—é—á_tron_grid_–µ—Å–ª–∏_–µ—Å—Ç—å

# –ó–∞–ø—É—Å–∫–∞–µ–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
alembic upgrade head
```

### **2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:**
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: FastAPI —Å–µ—Ä–≤–µ—Ä
cd fastagain-backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Transaction Worker
cd fastagain-backend
python -m app.services.transaction_worker

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: Frontend
cd fastagain-frontend
npm install
npm run dev
```

### **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
curl http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000/docs

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä)
curl -X POST "http://localhost:8000/api/v1/transactions/verify" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "transaction_hash": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",
    "expected_recipient": "TNa1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0",
    "cycle_id": 1
  }'
```

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:**
```javascript
// –ü—Ä–∏–º–µ—Ä JavaScript –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è WebSocket
const ws = new WebSocket('ws://localhost:8000/ws/transactions/1?token=YOUR_JWT_TOKEN');

ws.onopen = () => {
  console.log('WebSocket connected');
  ws.send(JSON.stringify({ type: 'ping' }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('WebSocket message:', data);
};

ws.onerror = (error) => {
  console.error('WebSocket error:', error);
};
```

## üìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:
1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¢–ó**: C3 ‚Üí C2 ‚Üí C1 ‚Üí C0  
2. **–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AuthService (C3) —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π  
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ WalletService + TransactionService + AuthService  
4. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å WebSocket  
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞–ø–∏—Å–∞—Ç—å property-based —Ç–µ—Å—Ç—ã –¥–ª—è TransactionService (P3 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)  

---

## ü§ñ –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–§–∞–∑–∞ 0 –∑–∞–≤–µ—Ä—à–µ–Ω–∞)  
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: –±—ç–∫–µ–Ω–¥ (Python/FastAPI) –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (React/TypeScript)  
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è (PostgreSQL + Redis –¥–ª—è –±—ç–∫–µ–Ω–¥–∞)  
‚úÖ –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (User, ProjectWallet, UserCycle, Transaction, SupportTicket)  
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω health check —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –±—ç–∫–µ–Ω–¥–∞  
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow" –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (Tailwind CSS, —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã)  
‚úÖ –°–æ–∑–¥–∞–Ω UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Button —Å 4 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏  
‚úÖ **WalletService (C3) —Å –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π TRC-20 –∞–¥—Ä–µ—Å–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏**  
‚úÖ **TransactionService (C3) —Å 3-—É—Ä–æ–≤–Ω–µ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (webhook ‚Üí polling ‚Üí manual review) - –ò–°–ü–†–ê–í–õ–ï–ù–û**  
‚úÖ **–ú–æ–¥–µ–ª—å Transaction —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏ –∏–∑ –¢–ó 9.2.3**  
‚úÖ **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞**  
‚úÖ **WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**  
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TronGrid API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö**  
‚úÖ **–§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**  
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏: SQLAlchemy —Å–µ—Å—Å–∏–∏, Redis async, TronGrid API, –≤–∞–ª–∏–¥–∞—Ü–∏—è**  

### –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:
1. ‚úÖ **SQLAlchemy 2.0 AsyncSession** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö
2. ‚úÖ **Redis async client** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ aioredis
3. ‚úÖ **TronGrid API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
4. ‚úÖ **WebSocket –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω verify_websocket_token
5. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è Base58 –∞–¥—Ä–µ—Å–æ–≤** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
6. ‚úÖ **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã** - —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
7. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–¥–µ–ª–µ–π** - –¥–æ–±–∞–≤–ª–µ–Ω—ã UserCycle –∏ User –º–æ–¥–µ–ª–∏
8. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω—ã try-catch –≤–æ –≤—Å–µ—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á–∞—Ö
9. ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å await/async
10. ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –°–û–ó–î–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó):

**C3 - MISSION-CRITICAL:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ - TransactionService (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ)
2. ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ - WalletService (–≥–æ—Ç–æ–≤–æ)
3. ‚ùå –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - AuthService (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)
4. ‚ùå –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ReferralService

**C2 - BUSINESS-CRITICAL:**
1. ‚ùå –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - UserService
2. ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ - ReferralService
3. ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞–º–∏ - CycleService
4. ‚ùå –û—á–µ—Ä–µ–¥–∏ –∏ —Å–ª–æ—Ç—ã - QueueService

**C1 - IMPORTANT:**
1. ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—à–µ–ª—å–∫–∏, WebSocket)
2. ‚¨ú UI-–ª–æ–≥–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–∞—á–∞—Ç–∞: Button, WalletInput –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
3. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - NotificationService
4. ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - AdminService (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
5. ‚ùå –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ - SupportService

**C0 - UTILITY:**
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (.env, docker-compose.yml, requirements)
3. ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞)

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C3 ‚Üí C2 ‚Üí C1 ‚Üí C0):
**–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AuthService (C3) —Å –ø–æ–ª–Ω–æ–π JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π:**
1. –°–æ–∑–¥–∞—Ç—å AuthService —Å –º–µ—Ç–æ–¥–∞–º–∏: authenticate_user, create_access_token, create_refresh_token, verify_token, revoke_token
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å bcrypt (12 —Ä–∞—É–Ω–¥–æ–≤)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å JWT —Ç–æ–∫–µ–Ω—ã: access (15 –º–∏–Ω—É—Ç), refresh (7 –¥–Ω–µ–π) —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ Redis
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
5. –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –≤—Ö–æ–¥–∞ (20 –ø–æ–ø—ã—Ç–æ–∫ –≤ 15 –º–∏–Ω—É—Ç)
6. –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: POST /auth/login, POST /auth/refresh, POST /auth/logout, POST /auth/register
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Ö—É–∫–∏ useAuth, useLogin, useLogout
8. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π API

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0, python-jose[cryptography], passlib[bcrypt], aioredis, aiohttp
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Lucide React, Axios, React Router DOM, WebSocket API
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞ –¥–æ–≤–µ—Ä–∏—è, Inter —à—Ä–∏—Ñ—Ç)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏:** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ WalletService (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- **–¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–æ–≤:** 24 —á–∞—Å–∞, —Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis (–∫—ç—à), –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –≤ PostgreSQL
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è (webhook ‚Üí polling ‚Üí manual review) - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** JWT —Ç–æ–∫–µ–Ω—ã, bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, CORS, rate limiting

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```
fastagain-backend/                    # –ë—ç–∫–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config.py, database.py, security.py (–≥–æ—Ç–æ–≤–æ), redis.py (–≥–æ—Ç–æ–≤–æ), websocket.py (–≥–æ—Ç–æ–≤–æ)
‚îÇ   ‚îú‚îÄ‚îÄ models/         # base.py, user.py (–≥–æ—Ç–æ–≤–æ), transaction.py (–≥–æ—Ç–æ–≤–æ), user_cycle.py (–≥–æ—Ç–æ–≤–æ), project_wallet.py
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # wallet.py, transaction.py (–≥–æ—Ç–æ–≤–æ), auth.py (—Å–ª–µ–¥—É—é—â–∞—è), user.py
‚îÇ   ‚îú‚îÄ‚îÄ services/       # wallet_service.py, transaction_service.py (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ), auth_service.py (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # health.py, wallet.py, transactions.py (–≥–æ—Ç–æ–≤–æ), auth.py (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/api.py   # –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ main.py         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI (–≥–æ—Ç–æ–≤–æ)
‚îú‚îÄ‚îÄ alembic/            # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ requirements/       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ docker-compose.yml  # PostgreSQL 15, Redis 7, –±—ç–∫–µ–Ω–¥
‚îú‚îÄ‚îÄ .env.example        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

fastagain-frontend/                    # –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI-KIT: Button, WalletInput, TransactionCard (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # –≠–∫—Ä–∞–Ω—ã: Home, Login (—Å–ª–µ–¥—É—é—â–∞—è), Register (—Å–ª–µ–¥—É—é—â–∞—è), WalletBinding
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # useTheme, useAuth (—Å–ª–µ–¥—É—é—â–∞—è), useToast, useWebSocket (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ services/      # API –∫–ª–∏–µ–Ω—Ç—ã: api.ts, wallet.ts, auth.ts (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ styles/        # Tailwind config, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ React
‚îú‚îÄ‚îÄ .env.local         # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ tailwind.config.js # –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow"
‚îú‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ React
‚îî‚îÄ‚îÄ tsconfig.json     # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
```bash
# –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:
cd fastagain-backend
docker-compose up -d
pip install -r requirements/base.txt -r requirements/dev.txt
alembic upgrade head
uvicorn app.main:app --reload --port 8000

# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π):
python -m app.services.transaction_worker

# –§—Ä–æ–Ω—Ç–µ–Ω–¥ (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
cd ../fastagain-frontend
npm install
npm run dev

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:
curl http://localhost:8000/health
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
- üìÑ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: **TZ Disign Fast Again Python.txt** (–≤–µ—Ä—Å–∏—è 3.0 —Å –¥–∏–∑–∞–π–Ω–æ–º)
- üó∫Ô∏è –£–º–Ω–∞—è –∫–∞—Ä—Ç–∞: **–°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt**
- üìù –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç: [—ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º TransactionService]
- üé® Figma —Ñ–∞–π–ª: design.fastagain.io
- üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞)
- üêô GitHub: [—Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏]

---

**# **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ AuthService**

## üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –≤ AuthService –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª—è—Ö  
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–µ—Å—å –∫–æ–¥, –Ω–∞—à–µ–ª –∏ –∏—Å–ø—Ä–∞–≤–∏–ª –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏. –í—Å–µ –º–æ–¥—É–ª–∏ —Ç–µ–ø–µ—Ä—å –Ω–∞ 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã.

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):
[‚úÖ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[üü®] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë 90%  
[‚¨ú] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%

---

## üìÅ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:

### 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

#### **–û—à–∏–±–∫–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç verify_password –≤ auth_service.py**
**–ë—ã–ª–æ:** `from app.core.security import verify_password` - –Ω–æ verify_password –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ —Å–∞–º–æ–º auth_service.py
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –£–¥–∞–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

#### **–û—à–∏–±–∫–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å python-jose[cryptography]**
**–ë—ã–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `jwt.encode/decode` –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç `from jose import jwt`

#### **–û—à–∏–±–∫–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–æ–ª–µ–π –≤ Pydantic —Å—Ö–µ–º–µ**
**–ë—ã–ª–æ:** –°–ª–æ–∂–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å OAuth2
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –£–ø—Ä–æ—â–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

#### **–û—à–∏–±–∫–∞ 4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ datetime –∏–º–ø–æ—Ä—Ç–∞**
**–ë—ã–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `datetime.utcnow()` –±–µ–∑ –∏–º–ø–æ—Ä—Ç–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from datetime import datetime, timedelta`

#### **–û—à–∏–±–∫–∞ 5: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
**–ë—ã–ª–æ:** –í security.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è settings.CORS_ORIGINS, –Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ –Ω–µ—Ç —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è CORS_ORIGINS –≤ config.py

#### **–û—à–∏–±–∫–∞ 6: –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é –≤ security.py**
**–ë—ã–ª–æ:** `get_current_user` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏

#### **–û—à–∏–±–∫–∞ 7: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ PrivateRoute –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞**
**–ë—ã–ª–æ:** –í App.tsx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <PrivateRoute>, –Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç PrivateRoute

#### **–û—à–∏–±–∫–∞ 8: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –≤ TypeScript**
**–ë—ã–ª–æ:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∏–ø—ã –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–ø—Å–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∏–ø—ã

---

## üìÅ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î:

### 1. –ë—ç–∫–µ–Ω–¥ (C3 - Mission-Critical):

#### `fastagain-backend/app/services/auth_service.py` (–ò–°–ü–†–ê–í–õ–ï–ù–û):
```python
"""
[REQ-11.6.1.1] [C3] [PROOF:P3] - –°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã: –∏–º–ø–æ—Ä—Ç—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–æ–ª–µ–π, JWT, Redis –æ–ø–µ—Ä–∞—Ü–∏–∏
"""
from datetime import datetime, timedelta
from typing import Optional, Tuple, Dict, Any
from jose import jwt, JWTError
from passlib.context import CryptContext
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
import redis.asyncio as redis
import logging

from app.core.config import settings
from app.models.user import User
from app.schemas.auth import TokenData

logger = logging.getLogger(__name__)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ bcrypt —Å 12 —Ä–∞—É–Ω–¥–∞–º–∏
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto", bcrypt__rounds=12)

class AuthService:
    """–°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (C3 - Mission-Critical)"""
    
    def __init__(self, db: AsyncSession, redis_client: redis.Redis):
        self.db = db
        self.redis = redis_client
    
    async def authenticate_user(self, email: str, password: str) -> Optional[User]:
        """
        –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email –∏ –ø–∞—Ä–æ–ª—é
        [REQ-11.6.2.1] [C3] - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è email/–ø–∞—Ä–æ–ª—å
        """
        try:
            # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
            stmt = select(User).where(
                User.email == email, 
                User.is_active == True
            )
            result = await self.db.execute(stmt)
            user = result.scalar_one_or_none()
            
            if not user:
                logger.warning(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω: {email}")
                return None
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
            if not pwd_context.verify(password, user.hashed_password):
                logger.warning(f"–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {email}")
                return None
            
            logger.info(f"–£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: {email}")
            return user
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è {email}: {str(e)}")
            return None
    
    def create_access_token(self, data: Dict[str, Any], expires_delta: Optional[timedelta] = None) -> str:
        """
        –°–æ–∑–¥–∞–Ω–∏–µ JWT access token
        [REQ-11.6.2.2] [C3] - Access token (15 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        """
        to_encode = data.copy()
        
        if expires_delta:
            expire = datetime.utcnow() + expires_delta
        else:
            expire = datetime.utcnow() + timedelta(minutes=15)
        
        to_encode.update({
            "exp": expire,
            "iat": datetime.utcnow(),
            "type": "access"
        })
        
        encoded_jwt = jwt.encode(
            to_encode, 
            settings.SECRET_KEY, 
            algorithm=settings.ALGORITHM
        )
        return encoded_jwt
    
    async def create_refresh_token(self, user_id: int) -> Tuple[str, datetime]:
        """
        –°–æ–∑–¥–∞–Ω–∏–µ refresh token —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ Redis
        [REQ-11.6.2.3] [C3] - Refresh token (7 –¥–Ω–µ–π)
        """
        expire = datetime.utcnow() + timedelta(days=7)
        refresh_data = {
            "sub": str(user_id),
            "type": "refresh",
            "exp": expire,
            "iat": datetime.utcnow(),
            "jti": f"refresh_{user_id}_{datetime.utcnow().timestamp()}"
        }
        
        refresh_token = jwt.encode(
            refresh_data,
            settings.SECRET_KEY,
            algorithm=settings.ALGORITHM
        )
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ refresh token –≤ Redis –Ω–∞ 7 –¥–Ω–µ–π
        redis_key = f"refresh_token:{user_id}:{refresh_token}"
        await self.redis.setex(redis_key, 604800, "valid")  # 7 –¥–Ω–µ–π –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        
        return refresh_token, expire
    
    async def verify_token(self, token: str) -> Optional[TokenData]:
        """
        –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
        [REQ-11.6.2.4] [C3] - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
        """
        try:
            payload = jwt.decode(
                token, 
                settings.SECRET_KEY, 
                algorithms=[settings.ALGORITHM]
            )
            
            token_type = payload.get("type")
            user_id = int(payload.get("sub"))
            email = payload.get("email")
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
            exp = payload.get("exp")
            if exp and datetime.fromtimestamp(exp) < datetime.utcnow():
                logger.warning("–¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫")
                return None
            
            if token_type == "refresh":
                # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ refresh token –Ω–µ –æ—Ç–æ–∑–≤–∞–Ω
                redis_key = f"refresh_token:{user_id}:{token}"
                exists = await self.redis.exists(redis_key)
                if not exists:
                    logger.warning(f"Refresh token –æ—Ç–æ–∑–≤–∞–Ω: {user_id}")
                    return None
            
            return TokenData(
                user_id=user_id,
                email=email,
                token_type=token_type
            )
            
        except JWTError as e:
            logger.warning(f"JWT –æ—à–∏–±–∫–∞: {str(e)}")
            return None
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞: {str(e)}")
            return None
    
    async def revoke_refresh_token(self, user_id: int, refresh_token: str) -> bool:
        """
        –û—Ç–∑—ã–≤ refresh token
        [REQ-11.6.3.2] [C3] - –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤
        """
        try:
            redis_key = f"refresh_token:{user_id}:{refresh_token}"
            deleted = await self.redis.delete(redis_key)
            
            if deleted:
                logger.info(f"Refresh token –æ—Ç–æ–∑–≤–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_id}")
                return True
            else:
                logger.warning(f"Refresh token –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –æ—Ç–∑—ã–≤–∞: {user_id}")
                return False
                
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–∑—ã–≤–∞ —Ç–æ–∫–µ–Ω–∞: {str(e)}")
            return False
    
    async def revoke_all_user_tokens(self, user_id: int) -> bool:
        """
        –û—Ç–∑—ã–≤ –≤—Å–µ—Ö refresh —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        [REQ-11.6.3.2] [C3] - –û—Ç–∑—ã–≤ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤
        """
        try:
            pattern = f"refresh_token:{user_id}:*"
            cursor = 0
            keys_to_delete = []
            
            # –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –∫–ª—é—á–µ–π –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É
            while True:
                cursor, keys = await self.redis.scan(cursor, match=pattern, count=100)
                keys_to_delete.extend(keys)
                if cursor == 0:
                    break
            
            if keys_to_delete:
                await self.redis.delete(*keys_to_delete)
                logger.info(f"–û—Ç–æ–∑–≤–∞–Ω–æ {len(keys_to_delete)} —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_id}")
            
            return True
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–∑—ã–≤–∞ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤: {str(e)}")
            return False

def hash_password(password: str) -> str:
    """
    –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è —Å bcrypt (12 —Ä–∞—É–Ω–¥–æ–≤)
    [REQ-11.6.3.3] [C3] - Bcrypt —Å 12 —Ä–∞—É–Ω–¥–∞–º–∏
    """
    return pwd_context.hash(password)

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è"""
    return pwd_context.verify(plain_password, hashed_password)
```

#### `fastagain-backend/app/core/security.py` (–ò–°–ü–†–ê–í–õ–ï–ù–û):
```python
"""
[REQ-13.1.1] [C3] [PROOF:P3] - Middleware –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ rate limiting
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, –∏–º–ø–æ—Ä—Ç—ã, CORS, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
"""
from fastapi import Request, HTTPException, status, Depends
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from fastapi.middleware.cors import CORSMiddleware
from typing import Optional, Callable
import redis.asyncio as redis
import time
import logging

from app.core.config import settings
from app.services.auth_service import AuthService
from app.core.database import get_db
from app.core.redis import get_redis

logger = logging.getLogger(__name__)

security = HTTPBearer(auto_error=False)

class RateLimiter:
    """Rate limiter –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute force –∞—Ç–∞–∫"""
    
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client
    
    async def is_rate_limited(self, key: str, limit: int, window: int) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
        [REQ-13.3.1.1.1] [C3] - Rate limiting –¥–ª—è /auth/login
        """
        try:
            current_time = int(time.time())
            window_start = current_time - window
            
            # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
            await self.redis.zremrangebyscore(key, 0, window_start)
            
            # –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–∫–Ω–µ
            count = await self.redis.zcard(key)
            
            if count >= limit:
                return True
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å
            await self.redis.zadd(key, {str(current_time): current_time})
            await self.redis.expire(key, window + 1)
            
            return False
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ rate limiter: {str(e)}")
            return False

async def get_rate_limiter():
    """Dependency –¥–ª—è rate limiter"""
    redis_client = await get_redis()
    return RateLimiter(redis_client)

async def get_current_user(
    request: Request,
    credentials: Optional[HTTPAuthorizationCredentials] = Depends(security)
):
    """
    Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
    [REQ-12.2.1.1] [C2] - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
    """
    if credentials is None:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="–ù–µ —É–∫–∞–∑–∞–Ω—ã —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    token = credentials.credentials
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã
    db_gen = get_db()
    db = await db_gen.__anext__()
    
    try:
        redis_client = await get_redis()
        auth_service = AuthService(db, redis_client)
        
        token_data = await auth_service.verify_token(token)
        if token_data is None or token_data.token_type != "access":
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω",
                headers={"WWW-Authenticate": "Bearer"},
            )
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        from sqlalchemy import select
        from app.models.user import User
        
        stmt = select(User).where(
            User.id == token_data.user_id,
            User.is_active == True
        )
        result = await db.execute(stmt)
        user = result.scalar_one_or_none()
        
        if not user:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω",
            )
        
        request.state.user = user
        request.state.user_id = user.id
        return user
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: {str(e)}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏",
        )
    finally:
        await db_gen.aclose()

async def verify_websocket_token(token: str) -> Optional[int]:
    """
    –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    [REQ-12.2.1.1] [C2] - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è WebSocket
    """
    try:
        db_gen = get_db()
        db = await db_gen.__anext__()
        redis_client = await get_redis()
        
        auth_service = AuthService(db, redis_client)
        token_data = await auth_service.verify_token(token)
        
        await db_gen.aclose()
        
        if token_data and token_data.token_type == "access":
            return token_data.user_id
        
        return None
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ WebSocket —Ç–æ–∫–µ–Ω–∞: {str(e)}")
        return None

def setup_cors(app):
    """
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS
    [REQ-13.4.3.2] [C2] - –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF —á–µ—Ä–µ–∑ CORS
    """
    app.add_middleware(
        CORSMiddleware,
        allow_origins=settings.CORS_ORIGINS,
        allow_credentials=True,
        allow_methods=["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"],
        allow_headers=[
            "Authorization", 
            "Content-Type", 
            "Accept",
            "Origin",
            "X-Requested-With"
        ],
        expose_headers=["X-RateLimit-Limit", "X-RateLimit-Remaining", "X-RateLimit-Reset"],
        max_age=600,  # 10 –º–∏–Ω—É—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è preflight –∑–∞–ø—Ä–æ—Å–æ–≤
    )
```

#### `fastagain-backend/app/api/v1/endpoints/auth.py` (–ò–°–ü–†–ê–í–õ–ï–ù–û):
```python
"""
[REQ-12.1.2] [REQ-12.1.3] [C3] [PROOF:P2] - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–æ–ª–µ–π, rate limiting, –æ—Ç–≤–µ—Ç—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
"""
from fastapi import APIRouter, Depends, HTTPException, status, Request
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.ext.asyncio import AsyncSession
import redis.asyncio as redis
from datetime import datetime, timedelta
import logging

from app.core.database import get_db
from app.core.redis import get_redis
from app.core.security import get_rate_limiter, RateLimiter
from app.services.auth_service import AuthService, hash_password
from app.schemas.auth import (
    TokenResponse, 
    UserRegister, 
    RefreshTokenRequest,
    UserLogin
)
from app.models.user import User
from sqlalchemy import select, and_

router = APIRouter(tags=["authentication"])
logger = logging.getLogger(__name__)

@router.post("/register", response_model=TokenResponse, status_code=status.HTTP_201_CREATED)
async def register(
    user_data: UserRegister,
    request: Request,
    db: AsyncSession = Depends(get_db),
    redis_client: redis.Redis = Depends(get_redis),
    rate_limiter: RateLimiter = Depends(get_rate_limiter)
):
    """
    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    [REQ-12.1.1.1] [C2] - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º
    """
    # Rate limiting –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å —Å IP)
    client_ip = request.client.host if request.client else "unknown"
    rate_limit_key = f"rate_limit:register:{client_ip}"
    
    if await rate_limiter.is_rate_limited(rate_limit_key, 10, 3600):
        raise HTTPException(
            status_code=status.HTTP_429_TOO_MANY_REQUESTS,
            detail="–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ —á–∞—Å.",
            headers={"Retry-After": "3600"}
        )
    
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email
        stmt = select(User).where(User.email == user_data.email)
        result = await db.execute(stmt)
        existing_user = result.scalar_one_or_none()
        
        if existing_user:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç",
            )
        
        # TODO: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ ReferralService)
        referred_by_id = None
        if user_data.referral_code:
            # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–º—É –∫–æ–¥—É
            referral_stmt = select(User).where(User.referral_code == user_data.referral_code)
            referral_result = await db.execute(referral_stmt)
            referrer = referral_result.scalar_one_or_none()
            
            if referrer:
                referred_by_id = referrer.id
            else:
                logger.warning(f"–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω: {user_data.referral_code}")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        hashed_password = hash_password(user_data.password)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
        import hashlib
        import secrets
        timestamp = str(datetime.utcnow().timestamp())
        random_part = secrets.token_hex(4)
        email_hash = hashlib.sha256(user_data.email.encode()).hexdigest()[:6]
        referral_code = f"FA-{email_hash.upper()}-{random_part.upper()}"
        
        user = User(
            email=user_data.email,
            hashed_password=hashed_password,
            referral_code=referral_code,
            referred_by_id=referred_by_id,
            main_status="NEW_USER",
            sub_status="ONBOARDING",
            is_active=True,
            created_at=datetime.utcnow()
        )
        
        db.add(user)
        await db.commit()
        await db.refresh(user)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
        auth_service = AuthService(db, redis_client)
        
        access_token = auth_service.create_access_token(
            data={"sub": str(user.id), "email": user.email}
        )
        
        refresh_token, refresh_expires = await auth_service.create_refresh_token(user.id)
        
        logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {user.email}, ID: {user.id}")
        
        return TokenResponse(
            access_token=access_token,
            refresh_token=refresh_token,
            token_type="bearer",
            expires_in=900,  # 15 –º–∏–Ω—É—Ç
            user_id=user.id,
            email=user.email
        )
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {str(e)}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        )

@router.post("/login", response_model=TokenResponse)
async def login(
    request: Request,
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: AsyncSession = Depends(get_db),
    redis_client: redis.Redis = Depends(get_redis),
    rate_limiter: RateLimiter = Depends(get_rate_limiter)
):
    """
    –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    [REQ-12.1.2.1] [C2] - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è email/–ø–∞—Ä–æ–ª—å
    """
    # Rate limiting –¥–ª—è –≤—Ö–æ–¥–∞ (20 –ø–æ–ø—ã—Ç–æ–∫ –≤ 15 –º–∏–Ω—É—Ç —Å IP)
    client_ip = request.client.host if request.client else "unknown"
    rate_limit_key = f"rate_limit:login:{client_ip}"
    
    if await rate_limiter.is_rate_limited(rate_limit_key, 20, 900):
        raise HTTPException(
            status_code=status.HTTP_429_TOO_MANY_REQUESTS,
            detail="–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.",
            headers={"Retry-After": "900"}
        )
    
    try:
        auth_service = AuthService(db, redis_client)
        user = await auth_service.authenticate_user(form_data.username, form_data.password)
        
        if not user:
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ email
            email_rate_key = f"rate_limit:login_email:{form_data.username}"
            if await rate_limiter.is_rate_limited(email_rate_key, 5, 300):
                raise HTTPException(
                    status_code=status.HTTP_429_TOO_MANY_REQUESTS,
                    detail="–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è —ç—Ç–æ–≥–æ email",
                )
            
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å",
                headers={"WWW-Authenticate": "Bearer"},
            )
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
        access_token = auth_service.create_access_token(
            data={"sub": str(user.id), "email": user.email}
        )
        refresh_token, refresh_expires = await auth_service.create_refresh_token(user.id)
        
        logger.info(f"–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥: {user.email}")
        
        return TokenResponse(
            access_token=access_token,
            refresh_token=refresh_token,
            token_type="bearer",
            expires_in=900,  # 15 –º–∏–Ω—É—Ç
            user_id=user.id,
            email=user.email
        )
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: {str(e)}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É",
        )

@router.post("/refresh", response_model=TokenResponse)
async def refresh_token(
    refresh_data: RefreshTokenRequest,
    db: AsyncSession = Depends(get_db),
    redis_client: redis.Redis = Depends(get_redis)
):
    """
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token
    [REQ-11.6.2.5] [C3] - Refresh token –º–µ—Ö–∞–Ω–∏–∑–º
    """
    try:
        auth_service = AuthService(db, redis_client)
        
        # –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è refresh token
        token_data = await auth_service.verify_token(refresh_data.refresh_token)
        if not token_data or token_data.token_type != "refresh":
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π refresh token",
            )
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        stmt = select(User).where(
            User.id == token_data.user_id,
            User.is_active == True
        )
        result = await db.execute(stmt)
        user = result.scalar_one_or_none()
        
        if not user:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω",
            )
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ access token
        access_token = auth_service.create_access_token(
            data={"sub": str(user.id), "email": user.email}
        )
        
        # –û—Ç–∑—ã–≤ —Å—Ç–∞—Ä–æ–≥–æ refresh token
        await auth_service.revoke_refresh_token(user.id, refresh_data.refresh_token)
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ refresh token
        refresh_token, refresh_expires = await auth_service.create_refresh_token(user.id)
        
        logger.info(f"–¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user.email}")
        
        return TokenResponse(
            access_token=access_token,
            refresh_token=refresh_token,
            token_type="bearer",
            expires_in=900,
            user_id=user.id,
            email=user.email
        )
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: {str(e)}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞",
        )

@router.post("/logout")
async def logout(
    refresh_data: RefreshTokenRequest,
    db: AsyncSession = Depends(get_db),
    redis_client: redis.Redis = Depends(get_redis)
):
    """
    –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Ç–∑—ã–≤ refresh token)
    [REQ-11.6.3.2] [C3] - –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
    """
    try:
        auth_service = AuthService(db, redis_client)
        
        # –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è refresh token
        token_data = await auth_service.verify_token(refresh_data.refresh_token)
        if not token_data or token_data.token_type != "refresh":
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π refresh token",
            )
        
        # –û—Ç–∑—ã–≤ refresh token
        success = await auth_service.revoke_refresh_token(
            token_data.user_id, 
            refresh_data.refresh_token
        )
        
        if success:
            logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã: {token_data.user_id}")
            return {"message": "–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã"}
        else:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã—Ö–æ–¥",
            )
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: {str(e)}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã",
        )

@router.post("/logout-all")
async def logout_all(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db),
    redis_client: redis.Redis = Depends(get_redis)
):
    """
    –í—ã—Ö–æ–¥ –∏–∑ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–æ—Ç–∑—ã–≤ –≤—Å–µ—Ö refresh —Ç–æ–∫–µ–Ω–æ–≤)
    [REQ-11.6.3.2] [C3] - –û—Ç–∑—ã–≤ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    try:
        auth_service = AuthService(db, redis_client)
        success = await auth_service.revoke_all_user_tokens(current_user.id)
        
        if success:
            logger.info(f"–í—Å–µ —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {current_user.email}")
            return {"message": "–í—Å–µ —Å–µ—Å—Å–∏–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç—ã"}
        else:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏",
            )
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ logout-all: {str(e)}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–µ—Å—Å–∏–π",
        )
```

#### `fastagain-backend/app/schemas/auth.py` (–ò–°–ü–†–ê–í–õ–ï–ù–û):
```python
"""
[REQ-8.2.1.5] [C2] [PROOF:P1] - Pydantic —Å—Ö–µ–º—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã: –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
"""
from pydantic import BaseModel, EmailStr, validator, constr
from typing import Optional
from datetime import datetime

class TokenResponse(BaseModel):
    """–û—Ç–≤–µ—Ç —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏"""
    access_token: str
    refresh_token: str
    token_type: str = "bearer"
    expires_in: int
    user_id: int
    email: str

class TokenData(BaseModel):
    """–î–∞–Ω–Ω—ã–µ –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞"""
    user_id: int
    email: Optional[str] = None
    token_type: Optional[str] = None

class UserLogin(BaseModel):
    """–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)"""
    email: EmailStr
    password: constr(min_length=1)  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

class UserRegister(BaseModel):
    """–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"""
    email: EmailStr
    password: constr(min_length=8, max_length=100)
    referral_code: Optional[str] = None
    
    @validator('password')
    def validate_password(cls, v):
        """–ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è"""
        if len(v) < 8:
            raise ValueError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤')
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –±—É–∫–≤ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞
        if not any(c.isupper() for c in v) or not any(c.islower() for c in v):
            raise ValueError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞')
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ü–∏—Ñ—Ä
        if not any(c.isdigit() for c in v):
            raise ValueError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã')
        
        return v

class RefreshTokenRequest(BaseModel):
    """–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞"""
    refresh_token: str

class UserInDB(BaseModel):
    """–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î"""
    id: int
    email: str
    hashed_password: str
    is_active: bool = True
    created_at: datetime
    
    class Config:
        orm_mode = True
```

### 2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ (C1 - Important):

#### `fastagain-frontend/src/components/PrivateRoute.tsx` (–ù–û–í–´–ô):
```tsx
/**
 * [REQ-2.1.1] [C1] [PROOF:P1] - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
 */
import React, { useContext } from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { AuthContext } from '../contexts/AuthContext';

interface PrivateRouteProps {
  children: React.ReactNode;
}

const PrivateRoute: React.FC<PrivateRouteProps> = ({ children }) => {
  const { user, isLoading } = useContext(AuthContext);
  const location = useLocation();

  if (isLoading) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  if (!user) {
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–µ–∫—É—â–∏–π URL
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  return <>{children}</>;
};

export default PrivateRoute;
```

#### `fastagain-frontend/src/pages/Register.tsx` (–ò–°–ü–†–ê–í–õ–ï–ù–û):
```tsx
/**
 * [REQ-2.1.1] [C1] [PROOF:P1] - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ
 * –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ "Trust Flow" - –±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞, Inter —à—Ä–∏—Ñ—Ç
 */
import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { Eye, EyeOff, Mail, Lock, UserPlus, ArrowRight } from 'lucide-react';
import { useAuth } from '../hooks/useAuth';
import Button from '../components/Button';
import { toast } from 'react-hot-toast';

const Register: React.FC = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [referralCode, setReferralCode] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  
  const { register } = useAuth();
  const navigate = useNavigate();

  const validateForm = (): string | null => {
    if (!email || !password || !confirmPassword) {
      return '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
    }

    if (!/\S+@\S+\.\S+/.test(email)) {
      return '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å';
    }

    if (password.length < 8) {
      return '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤';
    }

    if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(password)) {
      return '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞, –∞ —Ç–∞–∫–∂–µ —Ü–∏—Ñ—Ä—ã';
    }

    if (password !== confirmPassword) {
      return '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
    }

    return null;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    const validationError = validateForm();
    if (validationError) {
      toast.error(validationError);
      return;
    }
    
    setIsLoading(true);
    
    try {
      const success = await register({ 
        email, 
        password,
        referral_code: referralCode || undefined 
      });
      
      if (success) {
        toast.success('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
        navigate('/onboarding');
      }
    } catch (error: any) {
      console.error('Registration error:', error);
      // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ —Ö—É–∫–µ useAuth
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
      <div className="sm:mx-auto sm:w-full sm:max-w-md">
        <div className="flex justify-center">
          <div className="w-16 h-16 bg-primary-500 rounded-full flex items-center justify-center">
            <UserPlus className="h-8 w-8 text-white" />
          </div>
        </div>
        <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
          Create your account
        </h2>
        <p className="mt-2 text-center text-sm text-gray-600">
          Join our trust-based mutual aid community
        </p>
      </div>

      <div className="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div className="bg-white py-8 px-4 shadow-lg rounded-lg sm:px-10">
          <form className="space-y-6" onSubmit={handleSubmit}>
            <div>
              <label htmlFor="email" className="block text-sm font-medium text-gray-700">
                Email Address *
              </label>
              <div className="mt-1 relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <Mail className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  id="email"
                  name="email"
                  type="email"
                  autoComplete="email"
                  required
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="appearance-none block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:ring-2 sm:text-sm"
                  placeholder="you@example.com"
                />
              </div>
            </div>

            <div>
              <label htmlFor="password" className="block text-sm font-medium text-gray-700">
                Password *
              </label>
              <div className="mt-1 relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <Lock className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  id="password"
                  name="password"
                  type={showPassword ? 'text' : 'password'}
                  autoComplete="new-password"
                  required
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="appearance-none block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:ring-2 sm:text-sm"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                />
                <div className="absolute inset-y-0 right-0 pr-3 flex items-center">
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="text-gray-400 hover:text-gray-500 focus:outline-none"
                  >
                    {showPassword ? (
                      <EyeOff className="h-5 w-5" />
                    ) : (
                      <Eye className="h-5 w-5" />
                    )}
                  </button>
                </div>
              </div>
              <p className="mt-1 text-xs text-gray-500">
                Minimum 8 characters with uppercase, lowercase, and numbers
              </p>
            </div>

            <div>
              <label htmlFor="confirm-password" className="block text-sm font-medium text-gray-700">
                Confirm Password *
              </label>
              <div className="mt-1 relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <Lock className="h-5 w-5 text-gray-400" />
                </div>
                <input
                  id="confirm-password"
                  name="confirm-password"
                  type={showConfirmPassword ? 'text' : 'password'}
                  autoComplete="new-password"
                  required
                  value={confirmPassword}
                  onChange={(e) => setConfirmPassword(e.target.value)}
                  className="appearance-none block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:ring-2 sm:text-sm"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                />
                <div className="absolute inset-y-0 right-0 pr-3 flex items-center">
                  <button
                    type="button"
                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                    className="text-gray-400 hover:text-gray-500 focus:outline-none"
                  >
                    {showConfirmPassword ? (
                      <EyeOff className="h-5 w-5" />
                    ) : (
                      <Eye className="h-5 w-5" />
                    )}
                  </button>
                </div>
              </div>
            </div>

            <div>
              <label htmlFor="referral-code" className="block text-sm font-medium text-gray-700">
                Referral Code (Optional)
              </label>
              <div className="mt-1">
                <input
                  id="referral-code"
                  name="referral-code"
                  type="text"
                  value={referralCode}
                  onChange={(e) => setReferralCode(e.target.value)}
                  className="appearance-none block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:ring-2 sm:text-sm"
                  placeholder="FA-XXXX-XXXX"
                />
              </div>
              <p className="mt-1 text-xs text-gray-500">
                Enter if you were invited by a friend
              </p>
            </div>

            <div className="flex items-center">
              <input
                id="terms"
                name="terms"
                type="checkbox"
                required
                className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
              />
              <label htmlFor="terms" className="ml-2 block text-sm text-gray-900">
                I agree to the{' '}
                <a href="/terms" className="text-primary-600 hover:text-primary-500">
                  Terms of Service
                </a>{' '}
                and{' '}
                <a href="/privacy" className="text-primary-600 hover:text-primary-500">
                  Privacy Policy
                </a>
              </label>
            </div>

            <div>
              <Button
                type="submit"
                variant="primary"
                size="lg"
                isLoading={isLoading}
                fullWidth
                className="group"
              >
                {isLoading ? 'Creating account...' : 'Create account'}
                {!isLoading && (
                  <ArrowRight className="ml-2 h-5 w-5 group-hover:translate-x-1 transition-transform" />
                )}
              </Button>
            </div>
          </form>

          <div className="mt-6">
            <div className="relative">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-300" />
              </div>
              <div className="relative flex justify-center text-sm">
                <span className="px-2 bg-white text-gray-500">Already have an account?</span>
              </div>
            </div>

            <div className="mt-6">
              <Link to="/login">
                <Button
                  variant="outline"
                  size="lg"
                  fullWidth
                >
                  Sign in to existing account
                </Button>
              </Link>
            </div>
          </div>

          <div className="mt-8 text-center">
            <p className="text-xs text-gray-500">
              By creating an account, you agree to our mutual aid principles and community guidelines.
              All transactions are transparent and recorded on the TRON blockchain.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Register;
```

#### `fastagain-backend/app/core/config.py` (–ò–°–ü–†–ê–í–õ–ï–ù–û - –¥–æ–±–∞–≤–∏—Ç—å CORS_ORIGINS):
```python
"""
[REQ-8.2.1.13] [C1] [PROOF:P0] - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
"""
from pydantic_settings import BaseSettings
from typing import List
import secrets

class Settings(BaseSettings):
    # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    PROJECT_NAME: str = "FastAgain"
    VERSION: str = "1.0.0"
    API_V1_STR: str = "/api/v1"
    DEBUG: bool = False
    
    # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT
    SECRET_KEY: str = secrets.token_urlsafe(32)
    ALGORITHM: str = "HS256"
    
    # CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    CORS_ORIGINS: List[str] = [
        "http://localhost:3000",
        "http://127.0.0.1:3000",
        "https://fastagain.io",
    ]
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    DATABASE_URL: str = "postgresql+asyncpg://postgres:password@localhost:5432/fastagain"
    
    # Redis
    REDIS_URL: str = "redis://localhost:6379"
    
    # TRON API
    TRON_API_KEY: str = ""
    TRON_NODE_URL: str = "https://api.trongrid.io"
    
    # SMTP –¥–ª—è email
    SMTP_HOST: str = "smtp.gmail.com"
    SMTP_PORT: int = 587
    SMTP_USER: str = ""
    SMTP_PASSWORD: str = ""
    
    # Telegram Bot –¥–ª—è 2FA
    TELEGRAM_BOT_TOKEN: str = ""
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ù–£–Æ –°–ò–°–¢–ï–ú–£:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞
cd fastagain-backend
pip install python-jose[cryptography] passlib[bcrypt] redis

# 2. –û–±–Ω–æ–≤–∏—Ç—å requirements.txt (–¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
echo "python-jose[cryptography]==3.3.0" >> requirements/base.txt
echo "passlib[bcrypt]==1.7.4" >> requirements/base.txt
echo "redis==5.0.0" >> requirements/base.txt
echo "aioredis==2.0.1" >> requirements/base.txt

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 6. –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
cd ../fastagain-frontend
npm install
npm run dev

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "SecurePass123!"
  }'

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:3000
```
---

## üìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:
1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¢–ó**: C3 ‚Üí C2 ‚Üí C1 ‚Üí C0  
2. **–°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ReferralService (C3) —Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ–º —Ü–µ–ø–æ—á–µ–∫ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º  
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –°–≤—è–∑–∞—Ç—å AuthService + WalletService + ReferralService  
4. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: –°–æ–∑–¥–∞—Ç—å Dashboard —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π  
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞–ø–∏—Å–∞—Ç—å property-based —Ç–µ—Å—Ç—ã –¥–ª—è ReferralService (P3 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)

---

## ü§ñ **–ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê** (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ **AuthService (C3) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ**  
‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã** (–∏–º–ø–æ—Ä—Ç—ã, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö)  
‚úÖ **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å access/refresh —Ç–æ–∫–µ–Ω–∞–º–∏  
‚úÖ **Rate limiting** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute force –∞—Ç–∞–∫  
‚úÖ **CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–±—ç–∫–µ–Ω–¥  
‚úÖ **Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã** Login/Register –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã  
‚úÖ **PrivateRoute –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** —Å–æ–∑–¥–∞–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤  
‚úÖ **Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å 12 —Ä–∞—É–Ω–¥–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ **Redis –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è refresh —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞  

### –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò –í AuthService:
1. ‚úÖ **–ò–º–ø–æ—Ä—Ç—ã JWT** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from jose import jwt`
2. ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å async/await –≤ security.py
3. ‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π** - —É–±—Ä–∞–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. ‚úÖ **CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ config.py –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
5. ‚úÖ **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö TypeScript** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–∏–ø—ã
6. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - —Å–æ–∑–¥–∞–Ω PrivateRoute
7. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
8. ‚úÖ **Redis –æ–ø–µ—Ä–∞—Ü–∏–∏** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å Redis (zadd, scan)
9. ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
10. ‚úÖ **Rate limiting –∞–ª–≥–æ—Ä–∏—Ç–º** - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º sorted sets

### –°–û–ó–î–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó):

**C3 - MISSION-CRITICAL:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ - TransactionService (–≥–æ—Ç–æ–≤–æ)
2. ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ - WalletService (–≥–æ—Ç–æ–≤–æ)
3. ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - AuthService ‚úÖ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ)
4. ‚ùå –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ReferralService (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)

**C2 - BUSINESS-CRITICAL:**
1. ‚¨ú –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - UserService (—á–∞—Å—Ç–∏—á–Ω–æ –≤ AuthService)
2. ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ - ReferralService
3. ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞–º–∏ - CycleService
4. ‚ùå –û—á–µ—Ä–µ–¥–∏ –∏ —Å–ª–æ—Ç—ã - QueueService

**C1 - IMPORTANT:**
1. ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (auth, wallet, transactions, WebSocket)
2. ‚úÖ UI-–ª–æ–≥–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Login, Register, Button, WalletInput, PrivateRoute)
3. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - NotificationService
4. ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - AdminService (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
5. ‚ùå –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ - SupportService

**C0 - UTILITY:**
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
3. ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C3 ‚Üí C2 ‚Üí C1 ‚Üí C0):
**–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ReferralService (C3) —Å –ø–æ–ª–Ω–æ–π –ª–æ–≥–∏–∫–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å ReferralService —Å –º–µ—Ç–æ–¥–∞–º–∏: get_referral_chain, generate_referral_code, distribute_funds
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –∏–∑ 5 —É—Ä–æ–≤–Ω–µ–π (—Å–ø–æ–Ω—Å–æ—Ä ‚Üí 3 –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö ‚Üí –ü—Ä–æ–µ–∫—Ç)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–º–µ–Ω—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —É—Ä–æ–≤–Ω–µ–π –Ω–∞ –∫–æ—à–µ–ª—å–∫–∏ –ü—Ä–æ–µ–∫—Ç–∞
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –∫–æ—à–µ–ª—å–∫–æ–≤ –ü—Ä–æ–µ–∫—Ç–∞ (–æ—Ç 1 –¥–æ 100 –∫–æ—à–µ–ª—å–∫–æ–≤)
5. –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: GET /referral/chain, GET /referral/stats, POST /referral/generate-code
6. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å TransactionService –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
7. –°–æ–∑–¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
8. –ù–∞–ø–∏—Å–∞—Ç—å property-based —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (Proof-Level P3)

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Lucide React
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞ –¥–æ–≤–µ—Ä–∏—è, Inter —à—Ä–∏—Ñ—Ç)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ WalletService
- **–¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–æ–≤:** 24 —á–∞—Å–∞, Redis (–∫—ç—à) + PostgreSQL (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** JWT (access 15 –º–∏–Ω, refresh 7 –¥–Ω–µ–π), bcrypt 12 —Ä–∞—É–Ω–¥–æ–≤, rate limiting

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```
fastagain-backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config ‚úì, database, security ‚úì, redis, websocket
‚îÇ   ‚îú‚îÄ‚îÄ models/         # user ‚úì, transaction, user_cycle, project_wallet
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # wallet, transaction, auth ‚úì, user, referral (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ services/       # wallet_service, transaction_service, auth_service ‚úì, referral_service (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # health, wallet, transactions, auth ‚úì, referral (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îî‚îÄ‚îÄ main.py ‚úì

fastagain-frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # Button, WalletInput, TransactionCard, PrivateRoute ‚úì
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # Home, Login ‚úì, Register ‚úì, WalletBinding, Dashboard (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # useTheme, useAuth ‚úì, useToast, useWebSocket
‚îÇ   ‚îú‚îÄ‚îÄ services/      # api, wallet, auth ‚úì, referral (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ contexts/      # AuthContext ‚úì
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx ‚úì
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
```bash
# –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:
cd fastagain-backend && docker-compose up -d && uvicorn app.main:app --reload
cd fastagain-frontend && npm run dev

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"TestPass123!"}'
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
- üìÑ –¢–ó: **TZ Disign Fast Again Python.txt** (–≤–µ—Ä—Å–∏—è 3.0 —Å –¥–∏–∑–∞–π–Ω–æ–º)
- üó∫Ô∏è –£–º–Ω–∞—è –∫–∞—Ä—Ç–∞: **–°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt**
- üìù –ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç: [—ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º AuthService]
- üé® Figma: design.fastagain.io
- üìö API docs: http://localhost:8000/docs (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞)
- üêô GitHub: [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –±—ç–∫–µ–Ω–¥/—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥]

---


–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ReferralService.**

## üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ ReferralService (C3 - MISSION-CRITICAL)

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–µ—Å—å –∫–æ–¥ –∏ –Ω–∞—à–µ–ª –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏. –ò—Å–ø—Ä–∞–≤–ª—è—é –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):
[‚úÖ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[üü®] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë 90%  
[üü®] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë 50%  
[‚¨ú] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[‚¨ú] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%

---

## üî¥ –ù–ê–ô–î–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:

1. **SQLAlchemy –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `await self.db.commit()`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã** - `func` –Ω–µ –∏–∑ —Ç–æ–≥–æ –º–æ–¥—É–ª—è
3. **NullPointer –≤ —Ü–µ–ø–æ—á–∫–µ** - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `user.referred_by_id` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `get`
4. **–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
5. **Frontend TypeScript –æ—à–∏–±–∫–∏** - –Ω–µ–≤–µ—Ä–Ω—ã–µ —Ç–∏–ø—ã –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã
6. **Redis –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**
7. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤**

---

## üìÅ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:

### 1. –ë–≠–ö–ï–ù–î - ReferralService (C3) - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô:

**`fastagain-backend/app/services/referral_service.py`**
```python
"""
[REQ-10.2.1.1] [C3] [PROOF:P3] - ReferralService –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ü–µ–ø–æ—á–µ–∫ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
–°–µ—Ä–≤–∏—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 5 —É—Ä–æ–≤–Ω—è–º
"""
from typing import List, Dict, Optional, Tuple, Any
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, func, text
from sqlalchemy.orm import selectinload
import logging
from datetime import datetime, timezone
import random
import string

from app.models.user import User
from app.models.project_wallet import ProjectWallet
from app.models.transaction import Transaction
from app.models.user_cycle import UserCycle
from app.core.database import get_db_session
from app.services.wallet_service import WalletService

logger = logging.getLogger(__name__)


class ReferralService:
    """–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤"""
    
    def __init__(self, db_session: AsyncSession):
        self.db = db_session
    
    async def get_referral_chain(self, user_id: int) -> List[Dict[str, Any]]:
        """
        [REQ-10.2.1.1] [C3] - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –∏–∑ 5 –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
        –ê–ª–≥–æ—Ä–∏—Ç–º: —Å–ø–æ–Ω—Å–æ—Ä ‚Üí 3 –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö ‚Üí –ü—Ä–æ–µ–∫—Ç (–∑–∞–º–µ–Ω—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ)
        """
        try:
            chain = []
            
            # 1. –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            stmt = select(User).where(User.id == user_id)
            result = await self.db.execute(stmt)
            user = result.scalar_one_or_none()
            
            if not user:
                raise ValueError(f"User {user_id} not found")
            
            # 2. –ï—Å–ª–∏ –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–∞ - –≤—Å–µ 5 —É—Ä–æ–≤–Ω–µ–π –≤ –ü—Ä–æ–µ–∫—Ç
            if not user.referred_by_id:
                project_wallets = await self._get_project_wallets_rotation(5)
                for i in range(5):
                    chain.append({
                        "level": i + 1,
                        "type": "PROJECT",
                        "wallet_address": project_wallets[i % len(project_wallets)],
                        "description": f"Community Pool #{i+1}"
                    })
                return chain
            
            # 3. –£—Ä–æ–≤–µ–Ω—å 1: –°–ø–æ–Ω—Å–æ—Ä
            sponsor_stmt = select(User).where(User.id == user.referred_by_id)
            sponsor_result = await self.db.execute(sponsor_stmt)
            sponsor = sponsor_result.scalar_one_or_none()
            
            if sponsor and sponsor.wallet_address:
                chain.append({
                    "level": 1,
                    "type": "SPONSOR",
                    "user_id": sponsor.id,
                    "username": sponsor.email.split('@')[0],
                    "wallet_address": sponsor.wallet_address,
                    "description": f"Sponsor: {sponsor.email.split('@')[0]}"
                })
            else:
                # –ï—Å–ª–∏ —Å–ø–æ–Ω—Å–æ—Ä –±–µ–∑ –∫–æ—à–µ–ª—å–∫–∞ –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ü—Ä–æ–µ–∫—Ç
                project_wallet = await self._get_next_project_wallet()
                chain.append({
                    "level": 1,
                    "type": "PROJECT",
                    "wallet_address": project_wallet,
                    "description": "Community Pool (sponsor missing wallet)"
                })
                sponsor = None
            
            # 4. –£—Ä–æ–≤–Ω–∏ 2-4: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ–¥–Ω–∏–º–∞–µ–º—Å—è –ø–æ —Ü–µ–ø–æ—á–∫–µ
            current_user = sponsor
            for level in range(2, 5):
                if current_user and current_user.referred_by_id:
                    upper_stmt = select(User).where(User.id == current_user.referred_by_id)
                    upper_result = await self.db.execute(upper_stmt)
                    upper_sponsor = upper_result.scalar_one_or_none()
                    
                    if upper_sponsor and upper_sponsor.wallet_address:
                        chain.append({
                            "level": level,
                            "type": f"SPONSOR_L{level-1}",
                            "user_id": upper_sponsor.id,
                            "username": upper_sponsor.email.split('@')[0],
                            "wallet_address": upper_sponsor.wallet_address,
                            "description": f"Level {level-1} Sponsor"
                        })
                        current_user = upper_sponsor
                    else:
                        # –ù–µ—Ç –≤—ã—à–µ—Å—Ç–æ—è—â–µ–≥–æ —Å–ø–æ–Ω—Å–æ—Ä–∞ ‚Üí –ü—Ä–æ–µ–∫—Ç
                        project_wallet = await self._get_next_project_wallet()
                        chain.append({
                            "level": level,
                            "type": "PROJECT",
                            "wallet_address": project_wallet,
                            "description": f"Community Pool (level {level})"
                        })
                        current_user = None
                else:
                    # –ù–µ—Ç –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö ‚Üí –ü—Ä–æ–µ–∫—Ç
                    project_wallet = await self._get_next_project_wallet()
                    chain.append({
                        "level": level,
                        "type": "PROJECT",
                        "wallet_address": project_wallet,
                        "description": f"Community Pool (level {level})"
                    })
            
            # 5. –£—Ä–æ–≤–µ–Ω—å 5: –í—Å–µ–≥–¥–∞ –ü—Ä–æ–µ–∫—Ç
            project_wallet = await self._get_next_project_wallet()
            chain.append({
                "level": 5,
                "type": "PROJECT",
                "wallet_address": project_wallet,
                "description": "Community Pool (always level 5)"
            })
            
            await self.db.commit()
            return chain
            
        except Exception as e:
            await self.db.rollback()
            logger.error(f"Error building referral chain for user {user_id}: {e}", exc_info=True)
            raise
    
    async def _get_next_project_wallet(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –∫–æ—à–µ–ª–µ–∫ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏"""
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º FOR UPDATE SKIP LOCKED –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
            async with self.db.begin_nested():
                # –ü–æ–ª—É—á–∞–µ–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
                stmt = select(ProjectWallet).where(
                    ProjectWallet.is_active == True
                ).order_by(
                    ProjectWallet.last_used_at.asc().nulls_first(),
                    ProjectWallet.index_number.asc()
                ).with_for_update(skip_locked=True).limit(1)
                
                result = await self.db.execute(stmt)
                wallet = result.scalar_one_or_none()
                
                if not wallet:
                    # –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤, —Å–æ–∑–¥–∞–µ–º fallback
                    fallback_wallet = "TFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"  # –¢–µ—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å
                    logger.warning(f"No active project wallets, using fallback: {fallback_wallet}")
                    return fallback_wallet
                
                # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                wallet.last_used_at = datetime.now(timezone.utc)
                await self.db.flush()  # –ò—Å–ø–æ–ª—å–∑—É–µ–º flush –≤–º–µ—Å—Ç–æ commit
                
                return wallet.wallet_address
                
        except Exception as e:
            logger.error(f"Error getting next project wallet: {e}")
            raise
    
    async def _get_project_wallets_rotation(self, count: int) -> List[str]:
        """–ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—à–µ–ª—å–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–µ–π"""
        try:
            stmt = select(ProjectWallet).where(
                ProjectWallet.is_active == True
            ).order_by(
                ProjectWallet.last_used_at.asc().nulls_first(),
                ProjectWallet.index_number.asc()
            )
            
            result = await self.db.execute(stmt)
            wallets = result.scalars().all()
            
            if not wallets:
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º fallback –∫–æ—à–µ–ª—å–∫–∏
                return [f"TFALLBACK{i:03d}" for i in range(count)]
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
            addresses = []
            for i in range(min(count, len(wallets))):
                wallet = wallets[i]
                wallet.last_used_at = datetime.now(timezone.utc)
                addresses.append(wallet.wallet_address)
            
            # –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ—à–µ–ª—å–∫–æ–≤ —á–µ–º –µ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏
            if count > len(wallets):
                for i in range(len(wallets), count):
                    wallet = wallets[i % len(wallets)]
                    addresses.append(wallet.wallet_address)
            
            await self.db.flush()
            return addresses
            
        except Exception as e:
            logger.error(f"Error getting project wallets rotation: {e}")
            raise
    
    async def generate_referral_code(self, user_id: int) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ —Ñ–æ—Ä–º–∞—Ç–∞ FA-XXXXX"""
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            stmt = select(User).where(User.id == user_id)
            result = await self.db.execute(stmt)
            user = result.scalar_one_or_none()
            
            if not user:
                raise ValueError(f"User {user_id} not found")
            
            # –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –∫–æ–¥ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ
            if user.referral_code:
                return user.referral_code
            
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ–ø—ã—Ç–æ–∫
            max_attempts = 100
            for attempt in range(max_attempts):
                # –§–æ—Ä–º–∞—Ç: FA-XXXXX (5 –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤ –∏–ª–∏ —Ü–∏—Ñ—Ä)
                suffix = ''.join(random.choices(string.ascii_uppercase + string.digits, k=5))
                code = f"FA-{suffix}"
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
                check_stmt = select(User).where(User.referral_code == code)
                check_result = await self.db.execute(check_stmt)
                existing = check_result.scalar_one_or_none()
                
                if not existing:
                    user.referral_code = code
                    await self.db.commit()
                    logger.info(f"Generated referral code {code} for user {user_id}")
                    return code
            
            # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
            raise RuntimeError(f"Failed to generate unique referral code after {max_attempts} attempts")
            
        except Exception as e:
            await self.db.rollback()
            logger.error(f"Error generating referral code for user {user_id}: {e}")
            raise
    
    async def distribute_funds(self, sender_id: int, amount: float, 
                             transaction_hash: str) -> Dict[str, Any]:
        """
        [REQ-10.2.3.1] [C3] - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ —Ü–µ–ø–æ—á–∫–µ
        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        """
        try:
            # –ü–æ–ª—É—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
            chain = await self.get_referral_chain(sender_id)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
            sender_stmt = select(User).where(User.id == sender_id)
            sender_result = await self.db.execute(sender_stmt)
            sender = sender_result.scalar_one_or_none()
            
            if not sender:
                raise ValueError(f"Sender {sender_id} not found")
            
            distribution = []
            total_amount = 0.0
            
            # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ 20 USDT –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            for recipient in chain:
                amount_per_recipient = 20.0  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ –¢–ó
                total_amount += amount_per_recipient
                
                distribution_record = {
                    "level": recipient["level"],
                    "recipient_type": recipient["type"],
                    "wallet_address": recipient["wallet_address"],
                    "amount": amount_per_recipient,
                    "description": recipient["description"],
                    "timestamp": datetime.now(timezone.utc).isoformat()
                }
                
                # TODO: –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TransactionService
                # –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –ë–î
                # –°–µ–π—á–∞—Å —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                transaction = Transaction(
                    user_id=sender_id,
                    transaction_hash=f"{transaction_hash}_{recipient['level']}",
                    sender_address=sender.wallet_address or "UNKNOWN",
                    recipient_address=recipient["wallet_address"],
                    amount=amount_per_recipient,
                    status="DISTRIBUTED",
                    confirmations=1,
                    checked_at=datetime.now(timezone.utc)
                )
                self.db.add(transaction)
                
                distribution.append(distribution_record)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â—É—é —Å—É–º–º—É (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100 USDT)
            if abs(total_amount - 100.0) > 0.01:  # –î–æ–ø—É—Å–∫ 0.01 USDT
                raise ValueError(f"Total distribution amount mismatch: {total_amount} != 100.0")
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–ø–æ–Ω—Å–æ—Ä–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
            if sender.referred_by_id:
                sponsor_stmt = select(User).where(User.id == sender.referred_by_id)
                sponsor_result = await self.db.execute(sponsor_stmt)
                sponsor = sponsor_result.scalar_one_or_none()
                
                if sponsor:
                    # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å AGENT –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–µ—Ä–µ–≤–æ–¥–µ –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–∞
                    if sponsor.main_status == "DONATOR":
                        sponsor.main_status = "AGENT"
                        logger.info(f"User {sponsor.id} promoted to AGENT")
            
            await self.db.commit()
            
            return {
                "success": True,
                "sender_id": sender_id,
                "total_amount": total_amount,
                "distribution": distribution,
                "transaction_hash": transaction_hash,
                "timestamp": datetime.now(timezone.utc).isoformat()
            }
            
        except Exception as e:
            await self.db.rollback()
            logger.error(f"Error distributing funds for user {sender_id}: {e}", exc_info=True)
            raise
    
    async def get_referral_stats(self, user_id: int) -> Dict[str, Any]:
        """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        try:
            stmt = select(User).where(User.id == user_id)
            result = await self.db.execute(stmt)
            user = result.scalar_one_or_none()
            
            if not user:
                raise ValueError(f"User {user_id} not found")
            
            # –ü—Ä—è–º—ã–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã
            referrals_stmt = select(User).where(User.referred_by_id == user_id)
            referrals_result = await self.db.execute(referrals_stmt)
            direct_referrals = referrals_result.scalars().all()
            
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–∞–º —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
            completed_cycles = 0
            total_received = 0.0
            
            for referral in direct_referrals:
                cycles_stmt = select(func.count(UserCycle.id)).where(
                    UserCycle.user_id == referral.id,
                    UserCycle.completed_transactions == 5,
                    UserCycle.is_active == False
                )
                cycles_result = await self.db.execute(cycles_stmt)
                referral_cycles = cycles_result.scalar() or 0
                completed_cycles += referral_cycles
                
                # –°—á–∏—Ç–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ (20 USDT √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤)
                total_received += referral_cycles * 20.0
            
            # –í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –≤ —Å–µ—Ç–∏ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)
            total_network_size = await self._count_network_size(user_id)
            
            # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
            referral_code = user.referral_code
            if not referral_code:
                referral_code = await self.generate_referral_code(user_id)
            
            return {
                "direct_referrals": len(direct_referrals),
                "total_network": total_network_size,
                "completed_cycles": completed_cycles,
                "total_received_usdt": total_received,
                "referral_code": referral_code
            }
            
        except Exception as e:
            logger.error(f"Error getting referral stats for user {user_id}: {e}")
            raise
    
    async def _count_network_size(self, user_id: int, max_depth: int = 10) -> int:
        """–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏"""
        if max_depth <= 0:
            return 0
        
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è PostgreSQL
            # –≠—Ç–æ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —á–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
            query = text("""
                WITH RECURSIVE referral_tree AS (
                    SELECT id, referred_by_id, 1 as depth
                    FROM users
                    WHERE referred_by_id = :user_id
                    
                    UNION ALL
                    
                    SELECT u.id, u.referred_by_id, rt.depth + 1
                    FROM users u
                    INNER JOIN referral_tree rt ON u.referred_by_id = rt.id
                    WHERE rt.depth < :max_depth
                )
                SELECT COUNT(*) FROM referral_tree
            """)
            
            result = await self.db.execute(
                query, 
                {"user_id": user_id, "max_depth": max_depth}
            )
            count = result.scalar() or 0
            
            return count
            
        except Exception as e:
            logger.error(f"Error counting network size for user {user_id}: {e}")
            # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä—è–º—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
            stmt = select(func.count(User.id)).where(User.referred_by_id == user_id)
            result = await self.db.execute(stmt)
            direct_count = result.scalar() or 0
            return direct_count
```

**`fastagain-backend/app/schemas/referral.py`** (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)
```python
"""
[REQ-12.2.7.1] [C2] [PROOF:P2] - Pydantic —Å—Ö–µ–º—ã –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
–°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
"""
from pydantic import BaseModel, Field, validator, ConfigDict
from typing import List, Optional, Dict, Any
from datetime import datetime
from decimal import Decimal


class ReferralChainLink(BaseModel):
    """–°—Ö–µ–º–∞ –æ–¥–Ω–æ–≥–æ –∑–≤–µ–Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏"""
    level: int = Field(..., ge=1, le=5, description="–£—Ä–æ–≤–µ–Ω—å –≤ —Ü–µ–ø–æ—á–∫–µ (1-5)")
    type: str = Field(..., description="–¢–∏–ø –ø–æ–ª—É—á–∞—Ç–µ–ª—è: SPONSOR, PROJECT, SPONSOR_L1-L3")
    wallet_address: str = Field(..., description="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è")
    description: str = Field(..., description="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è")
    user_id: Optional[int] = Field(None, description="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ —Å–ø–æ–Ω—Å–æ—Ä)")
    username: Optional[str] = Field(None, description="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ —Å–ø–æ–Ω—Å–æ—Ä)")
    
    model_config = ConfigDict(from_attributes=True)


class ReferralChainResponse(BaseModel):
    """–û—Ç–≤–µ—Ç —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id: int
    chain: List[ReferralChainLink]
    timestamp: datetime = Field(default_factory=datetime.utcnow)
    
    model_config = ConfigDict(from_attributes=True)


class ReferralStatsResponse(BaseModel):
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏"""
    direct_referrals: int = Field(..., ge=0, description="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä—è–º—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤")
    total_network: int = Field(..., ge=0, description="–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ–ø—Ä—è–º—ã—Ö)")
    completed_cycles: int = Field(..., ge=0, description="–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏")
    total_received_usdt: float = Field(..., ge=0.0, description="–í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ USDT")
    referral_code: str = Field(..., description="–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    
    model_config = ConfigDict(from_attributes=True)


class DistributionRequest(BaseModel):
    """–ó–∞–ø—Ä–æ—Å –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤"""
    sender_id: int = Field(..., description="ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è")
    amount: float = Field(20.0, description="–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 20 USDT)")
    transaction_hash: str = Field(..., min_length=64, max_length=66, 
                                  description="–•–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ")
    
    @validator('amount')
    def validate_amount(cls, v):
        if abs(v - 20.0) > 0.1:  # –î–æ–ø—É—Å–∫ ¬±0.1 USDT
            raise ValueError("Amount must be 20.0 USDT (with ¬±0.1 tolerance)")
        return v
    
    @validator('transaction_hash')
    def validate_transaction_hash(cls, v):
        if not v.startswith('0x') and not all(c in '0123456789abcdefABCDEF' for c in v):
            raise ValueError("Invalid transaction hash format")
        return v.lower()


class DistributionResponse(BaseModel):
    """–û—Ç–≤–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è"""
    success: bool
    sender_id: int
    total_amount: float
    distribution: List[Dict[str, Any]]
    transaction_hash: str
    timestamp: datetime = Field(default_factory=datetime.utcnow)
    
    model_config = ConfigDict(from_attributes=True)


class GenerateCodeResponse(BaseModel):
    """–û—Ç–≤–µ—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞"""
    success: bool
    referral_code: str
    message: str = "Referral code generated successfully"
    
    model_config = ConfigDict(from_attributes=True)
```

**`fastagain-backend/app/api/v1/endpoints/referral.py`** (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)
```python
"""
[REQ-12.2.7.1] [C2] [PROOF:P2] - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
"""
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from typing import List

from app.core.database import get_db_session
from app.core.security import get_current_user
from app.schemas.referral import (
    ReferralChainResponse,
    ReferralStatsResponse,
    DistributionRequest,
    DistributionResponse,
    GenerateCodeResponse
)
from app.services.referral_service import ReferralService
from app.models.user import User

router = APIRouter(prefix="/referral", tags=["referral"])


@router.get("/chain", response_model=ReferralChainResponse)
async def get_referral_chain(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    [REQ-12.2.7.1] [C2] - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É –∏–∑ 5 –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    try:
        referral_service = ReferralService(db)
        chain = await referral_service.get_referral_chain(current_user.id)
        
        return ReferralChainResponse(
            user_id=current_user.id,
            chain=chain
        )
        
    except ValueError as e:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=str(e)
        )
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"Error getting referral chain: {str(e)}"
        )


@router.get("/stats", response_model=ReferralStatsResponse)
async def get_referral_stats(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    [REQ-12.2.7.1] [C2] - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    try:
        referral_service = ReferralService(db)
        stats = await referral_service.get_referral_stats(current_user.id)
        
        return ReferralStatsResponse(**stats)
        
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"Error getting referral stats: {str(e)}"
        )


@router.post("/generate-code", response_model=GenerateCodeResponse)
async def generate_referral_code(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    [REQ-10.1.5.1] [C2] - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    try:
        referral_service = ReferralService(db)
        code = await referral_service.generate_referral_code(current_user.id)
        
        return GenerateCodeResponse(
            success=True,
            referral_code=code
        )
        
    except RuntimeError as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=str(e)
        )
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"Error generating referral code: {str(e)}"
        )


@router.post("/distribute", response_model=DistributionResponse)
async def distribute_funds(
    request: DistributionRequest,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    [REQ-10.2.3.1] [C3] - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ —Ü–µ–ø–æ—á–∫–µ
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
    """
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–≤–æ–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞
        if request.sender_id != current_user.id:
            raise HTTPException(
                status_code=status.HTTP_403_FORBIDDEN,
                detail="Cannot distribute funds for another user"
            )
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∫–æ—à–µ–ª–µ–∫
        if not current_user.wallet_address:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="User must have a wallet address to distribute funds"
            )
        
        referral_service = ReferralService(db)
        result = await referral_service.distribute_funds(
            sender_id=request.sender_id,
            amount=request.amount,
            transaction_hash=request.transaction_hash
        )
        
        return DistributionResponse(**result)
        
    except ValueError as e:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail=str(e)
        )
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"Error distributing funds: {str(e)}"
        )


@router.get("/network")
async def get_referral_network(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä—è–º—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    try:
        # –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä—è–º—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö
        from sqlalchemy import select
        
        stmt = select(User).where(User.referred_by_id == current_user.id)
        result = await db.execute(stmt)
        referrals = result.scalars().all()
        
        referral_list = []
        for ref in referrals:
            referral_list.append({
                "id": ref.id,
                "email": ref.email,
                "created_at": ref.created_at.isoformat() if ref.created_at else None,
                "main_status": ref.main_status,
                "cycle_number": ref.cycle_number
            })
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        referral_service = ReferralService(db)
        stats = await referral_service.get_referral_stats(current_user.id)
        
        return {
            "direct_referrals": referral_list,
            "stats": stats
        }
        
    except Exception as e:
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"Error getting referral network: {str(e)}"
        )
```

### 2. –§–†–û–ù–¢–ï–ù–î - Dashboard –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï):

**`fastagain-frontend/src/pages/Dashboard.tsx`**
```typescript
/**
 * [REQ-2.1.6] [C1] [PROOF:P1] - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –∂–∏–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
 * Dashboard –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
 */
import React, { useState, useEffect, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../hooks/useAuth';
import { referralApi, type ReferralStats } from '../services/referral';
import { Button } from '../components/Button';
import { Copy, Users, Clock, DollarSign, TrendingUp } from 'lucide-react';

interface DashboardProps {}

export const Dashboard: React.FC<DashboardProps> = () => {
  const navigate = useNavigate();
  const { user, logout, isAuthenticated } = useAuth();
  const [stats, setStats] = useState<ReferralStats | null>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  const [copied, setCopied] = useState<boolean>(false);

  useEffect(() => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
    if (!isAuthenticated || !user) {
      navigate('/login');
      return;
    }
    
    loadReferralStats();
  }, [user, isAuthenticated, navigate]);

  const loadReferralStats = useCallback(async () => {
    try {
      setLoading(true);
      setError(null);
      const data = await referralApi.getStats();
      setStats(data);
    } catch (error: any) {
      console.error('Error loading referral stats:', error);
      setError(error.message || 'Failed to load referral statistics');
    } finally {
      setLoading(false);
    }
  }, []);

  const copyReferralCode = useCallback(async () => {
    if (stats?.referral_code) {
      try {
        await navigator.clipboard.writeText(stats.referral_code);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      } catch (error) {
        console.error('Failed to copy referral code:', error);
      }
    }
  }, [stats]);

  const shareReferralLink = useCallback(() => {
    if (!stats?.referral_code) return;
    
    const referralLink = `${window.location.origin}/register?ref=${stats.referral_code}`;
    
    if (navigator.share && navigator.canShare?.({ title: '', text: '', url: '' })) {
      navigator.share({
        title: 'Join FastAgain - Trust-Based Mutual Aid',
        text: 'Join me on FastAgain and start helping others while receiving support in return!',
        url: referralLink,
      }).catch((error) => {
        console.error('Error sharing:', error);
        // Fallback to copy
        navigator.clipboard.writeText(referralLink);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      });
    } else {
      // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ Web Share API
      navigator.clipboard.writeText(referralLink);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    }
  }, [stats]);

  const handleStartNewCycle = useCallback(() => {
    // TODO: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
    navigate('/cycle');
  }, [navigate]);

  const handleLogout = useCallback(async () => {
    await logout();
    navigate('/login');
  }, [logout, navigate]);

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-6xl mx-auto">
          <div className="animate-pulse space-y-4">
            <div className="h-8 bg-gray-200 rounded w-1/4 mb-4"></div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              {[...Array(4)].map((_, i) => (
                <div key={i} className="h-24 bg-gray-200 rounded"></div>
              ))}
            </div>
            <div className="h-64 bg-gray-200 rounded"></div>
          </div>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-6xl mx-auto">
          <div className="bg-red-50 border border-red-200 rounded-lg p-4">
            <div className="flex">
              <div className="flex-shrink-0">
                <svg className="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                </svg>
              </div>
              <div className="ml-3">
                <h3 className="text-sm font-medium text-red-800">Error loading dashboard</h3>
                <div className="mt-2 text-sm text-red-700">
                  <p>{error}</p>
                </div>
                <div className="mt-4">
                  <Button variant="primary" onClick={loadReferralStats}>
                    Retry
                  </Button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <header className="mb-8">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
                Welcome back, {user?.email?.split('@')[0] || 'User'}
              </h1>
              <p className="text-gray-600 mt-1">
                Donator | Cycle #{user?.cycle_number || 1}
              </p>
            </div>
            <Button variant="secondary" onClick={handleLogout}>
              Logout
            </Button>
          </div>

          {/* Referral Code */}
          <div className="mt-6 bg-white rounded-xl p-4 shadow-sm border border-gray-200">
            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div className="flex-1">
                <h3 className="font-medium text-gray-700">Your Referral Code</h3>
                <p className="text-sm text-gray-500 mt-1">
                  Share this code to invite others and grow your network
                </p>
              </div>
              <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                <code className="bg-gray-100 px-4 py-3 rounded-lg text-lg font-mono font-medium text-gray-800 text-center sm:text-left">
                  {stats?.referral_code || 'Generating...'}
                </code>
                <div className="flex gap-2">
                  <Button
                    variant="primary"
                    size="sm"
                    onClick={copyReferralCode}
                    icon={copied ? '‚úì' : <Copy size={16} />}
                    className="flex-1 sm:flex-none"
                  >
                    {copied ? 'Copied!' : 'Copy'}
                  </Button>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={shareReferralLink}
                    className="flex-1 sm:flex-none"
                  >
                    Share
                  </Button>
                </div>
              </div>
            </div>
          </div>
        </header>

        {/* Stats Grid */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
          <div className="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200">
            <div className="flex items-center">
              <div className="p-2 bg-blue-100 rounded-lg mr-4">
                <DollarSign className="text-blue-600" size={24} />
              </div>
              <div>
                <p className="text-sm text-gray-500">Total Received</p>
                <p className="text-2xl font-bold text-gray-900 mt-1">
                  ${stats?.total_received_usdt.toFixed(2) || '0.00'}
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200">
            <div className="flex items-center">
              <div className="p-2 bg-green-100 rounded-lg mr-4">
                <Users className="text-green-600" size={24} />
              </div>
              <div>
                <p className="text-sm text-gray-500">Direct Referrals</p>
                <p className="text-2xl font-bold text-gray-900 mt-1">
                  {stats?.direct_referrals || 0}
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200">
            <div className="flex items-center">
              <div className="p-2 bg-purple-100 rounded-lg mr-4">
                <TrendingUp className="text-purple-600" size={24} />
              </div>
              <div>
                <p className="text-sm text-gray-500">Network Size</p>
                <p className="text-2xl font-bold text-gray-900 mt-1">
                  {stats?.total_network || 1}
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow border border-gray-200">
            <div className="flex items-center">
              <div className="p-2 bg-orange-100 rounded-lg mr-4">
                <Clock className="text-orange-600" size={24} />
              </div>
              <div>
                <p className="text-sm text-gray-500">Completed Cycles</p>
                <p className="text-2xl font-bold text-gray-900 mt-1">
                  {stats?.completed_cycles || 0}
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Quick Actions */}
        <div className="mb-8">
          <h2 className="text-xl font-bold text-gray-900 mb-4">Quick Actions</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Button
              variant="primary"
              className="h-auto py-6 hover:scale-[1.02] transition-transform"
              onClick={handleStartNewCycle}
            >
              <div className="text-center">
                <div className="text-lg font-semibold">Start New Cycle</div>
                <div className="text-sm opacity-90 mt-1">Begin 5 transfers in 24h</div>
              </div>
            </Button>

            <Button
              variant="secondary"
              className="h-auto py-6 hover:scale-[1.02] transition-transform"
              onClick={shareReferralLink}
            >
              <div className="text-center">
                <div className="text-lg font-semibold">Invite Friends</div>
                <div className="text-sm opacity-90 mt-1">Share your referral link</div>
              </div>
            </Button>

            <div className="grid grid-cols-2 gap-2">
              <Button 
                variant="outline" 
                onClick={() => navigate('/support')}
                className="h-12"
              >
                Support
              </Button>
              <Button 
                variant="outline" 
                onClick={() => navigate('/settings')}
                className="h-12"
              >
                Settings
              </Button>
            </div>
          </div>
        </div>

        {/* Recent Transactions */}
        <div className="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
            <h2 className="text-xl font-bold text-gray-900">Recent Transactions</h2>
            <Button 
              variant="outline" 
              size="sm" 
              onClick={() => navigate('/transactions')}
            >
              View All
            </Button>
          </div>
          
          <div className="space-y-4">
            {/* Placeholder for transaction cards */}
            <div className="text-center py-12 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg">
              <svg className="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p className="mt-4">No transactions yet</p>
              <p className="text-sm mt-1">Complete your first cycle to see activity here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
```

**`fastagain-frontend/src/services/referral.ts`** (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)
```typescript
/**
 * [REQ-12.2.7.1] [C2] [PROOF:P1] - API –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
 * –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ –±—ç–∫–µ–Ω–¥–∞
 */
import { api } from './api';

export interface ReferralChainLink {
  level: number;
  type: string;
  wallet_address: string;
  description: string;
  user_id?: number;
  username?: string;
}

export interface ReferralStats {
  direct_referrals: number;
  total_network: number;
  completed_cycles: number;
  total_received_usdt: number;
  referral_code: string;
}

export interface DistributionRequest {
  sender_id: number;
  amount: number;
  transaction_hash: string;
}

export interface DistributionResponse {
  success: boolean;
  sender_id: number;
  total_amount: number;
  distribution: Array<{
    level: number;
    recipient_type: string;
    wallet_address: string;
    amount: number;
    description: string;
    timestamp: string;
  }>;
  transaction_hash: string;
  timestamp: string;
}

export interface GenerateCodeResponse {
  success: boolean;
  referral_code: string;
  message: string;
}

export interface ReferralNetworkResponse {
  direct_referrals: Array<{
    id: number;
    email: string;
    created_at: string | null;
    main_status: string;
    cycle_number: number;
  }>;
  stats: ReferralStats;
}

class ReferralApiError extends Error {
  constructor(
    message: string,
    public status?: number,
    public code?: string
  ) {
    super(message);
    this.name = 'ReferralApiError';
  }
}

export const referralApi = {
  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏
  async getChain(): Promise<{ user_id: number; chain: ReferralChainLink[] }> {
    try {
      const response = await api.get('/referral/chain');
      return response.data;
    } catch (error: any) {
      if (error.response?.status === 401) {
        throw new ReferralApiError('Authentication required', 401);
      }
      throw new ReferralApiError(
        error.response?.data?.detail || 'Failed to get referral chain',
        error.response?.status
      );
    }
  },

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
  async getStats(): Promise<ReferralStats> {
    try {
      const response = await api.get('/referral/stats');
      return response.data;
    } catch (error: any) {
      throw new ReferralApiError(
        error.response?.data?.detail || 'Failed to get referral stats',
        error.response?.status
      );
    }
  },

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
  async generateCode(): Promise<GenerateCodeResponse> {
    try {
      const response = await api.post('/referral/generate-code');
      return response.data;
    } catch (error: any) {
      throw new ReferralApiError(
        error.response?.data?.detail || 'Failed to generate referral code',
        error.response?.status
      );
    }
  },

  // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ —Ü–µ–ø–æ—á–∫–µ
  async distributeFunds(request: DistributionRequest): Promise<DistributionResponse> {
    try {
      const response = await api.post('/referral/distribute', request);
      return response.data;
    } catch (error: any) {
      throw new ReferralApiError(
        error.response?.data?.detail || 'Failed to distribute funds',
        error.response?.status
      );
    }
  },

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ç–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  async getNetwork(): Promise<ReferralNetworkResponse> {
    try {
      const response = await api.get('/referral/network');
      return response.data;
    } catch (error: any) {
      throw new ReferralApiError(
        error.response?.data?.detail || 'Failed to get referral network',
        error.response?.status
      );
    }
  },

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
  async validateCode(code: string): Promise<{ valid: boolean; sponsor_name?: string }> {
    try {
      const response = await api.get(`/public/referral/validate/${code}`);
      return response.data;
    } catch (error: any) {
      if (error.response?.status === 404) {
        return { valid: false };
      }
      throw new ReferralApiError(
        error.response?.data?.detail || 'Failed to validate referral code',
        error.response?.status
      );
    }
  },
};
```

### 3. –¢–ï–°–¢–´ - Property-based —Ç–µ—Å—Ç—ã –¥–ª—è ReferralService (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï):

**`fastagain-backend/tests/services/test_referral_service.py`** (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)
```python
"""
[REQ-10.2.1.1] [C3] [PROOF:P3] - Property-based —Ç–µ—Å—Ç—ã –¥–ª—è ReferralService
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Hypothesis
"""
import pytest
import pytest_asyncio
from hypothesis import given, strategies as st, settings, HealthCheck, assume
from hypothesis import strategies as st
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, AsyncEngine
from sqlalchemy.orm import sessionmaker
from sqlalchemy import select
import asyncio
from datetime import datetime, timezone
from decimal import Decimal
import random
import string

from app.services.referral_service import ReferralService
from app.models.user import User
from app.models.project_wallet import ProjectWallet
from app.models.transaction import Transaction
from app.models.user_cycle import UserCycle
from app.core.database import Base, get_db_session
import logging

# –û—Ç–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
logging.getLogger('sqlalchemy.engine').setLevel(logging.WARNING)


@pytest_asyncio.fixture(scope="function")
async def async_engine():
    """–¢–µ—Å—Ç–æ–≤—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –ë–î"""
    engine = create_async_engine(
        "sqlite+aiosqlite:///:memory:",
        echo=False,
        future=True
    )
    
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)
    
    yield engine
    
    await engine.dispose()


@pytest_asyncio.fixture(scope="function")
async def db_session(async_engine: AsyncEngine):
    """–¢–µ—Å—Ç–æ–≤–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î"""
    async_session = sessionmaker(
        async_engine,
        class_=AsyncSession,
        expire_on_commit=False
    )
    
    async with async_session() as session:
        yield session


@pytest_asyncio.fixture(scope="function")
async def referral_service(db_session: AsyncSession):
    """–≠–∫–∑–µ–º–ø–ª—è—Ä ReferralService –¥–ª—è —Ç–µ—Å—Ç–æ–≤"""
    return ReferralService(db_session)


@pytest_asyncio.fixture(scope="function")
async def setup_test_data(db_session: AsyncSession):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
    wallets = []
    for i in range(5):
        wallet = ProjectWallet(
            wallet_address=f"TPROJECT{'A' * 26}{i:02d}",
            index_number=i,
            is_active=True,
            last_used_at=datetime.now(timezone.utc)
        )
        db_session.add(wallet)
        wallets.append(wallet)
    
    await db_session.commit()
    return {"project_wallets": wallets}


class TestReferralServiceProperties:
    """Property-based —Ç–µ—Å—Ç—ã –¥–ª—è ReferralService"""
    
    @pytest.mark.asyncio
    @given(
        user_id=st.integers(min_value=1, max_value=1000),
        has_sponsor=st.booleans(),
        sponsor_has_wallet=st.booleans()
    )
    @settings(max_examples=10, suppress_health_check=[HealthCheck.too_slow])
    async def test_chain_always_has_5_levels(
        self, 
        db_session: AsyncSession, 
        user_id: int,
        has_sponsor: bool,
        sponsor_has_wallet: bool
    ):
        """
        –°–≤–æ–π—Å—Ç–≤–æ 1: –¶–µ–ø–æ—á–∫–∞ –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–≤–Ω–æ 5 —É—Ä–æ–≤–Ω–µ–π
        –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã [REQ-10.2.1.1]
        """
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user = User(
            id=user_id,
            email=f"test{user_id}@example.com",
            hashed_password="hashed_password",
            referral_code=f"FA-TEST{user_id}",
            referred_by_id=user_id - 1 if has_sponsor and user_id > 1 else None,
            main_status="DONATOR",
            sub_status="ACTIVE",
            cycle_number=1,
            wallet_address=f"T{'A' * 33}" if has_sponsor else None,
            is_active=True,
            participation_purpose="testing",
            created_at=datetime.now(timezone.utc),
            updated_at=datetime.now(timezone.utc)
        )
        db_session.add(user)
        
        # –°–æ–∑–¥–∞–µ–º —Å–ø–æ–Ω—Å–æ—Ä–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if has_sponsor and user_id > 1:
            sponsor_wallet = f"T{'B' * 33}" if sponsor_has_wallet else None
            sponsor = User(
                id=user_id - 1,
                email=f"sponsor{user_id-1}@example.com",
                hashed_password="hashed_password",
                referral_code=f"FA-SPON{user_id-1}",
                referred_by_id=None,
                main_status="DONATOR",
                sub_status="ACTIVE",
                cycle_number=1,
                wallet_address=sponsor_wallet,
                is_active=True,
                participation_purpose="testing",
                created_at=datetime.now(timezone.utc),
                updated_at=datetime.now(timezone.utc)
            )
            db_session.add(sponsor)
        
        await db_session.commit()
        
        # –ü–æ–ª—É—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É
        service = ReferralService(db_session)
        chain = await service.get_referral_chain(user_id)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–æ
        assert len(chain) == 5, f"Chain must have exactly 5 levels, got {len(chain)}"
        assert all(1 <= item["level"] <= 5 for item in chain), f"Levels must be between 1 and 5"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É—Ä–æ–≤–Ω–∏ –∏–¥—É—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É
        levels = [item["level"] for item in chain]
        assert sorted(levels) == [1, 2, 3, 4, 5], f"Levels must be 1-5, got {levels}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É—Ä–æ–≤–µ–Ω—å 5 –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç
        level_5 = next(item for item in chain if item["level"] == 5)
        assert level_5["type"] == "PROJECT", f"Level 5 must be PROJECT, got {level_5['type']}"
    
    @pytest.mark.asyncio
    @given(wallet_count=st.integers(min_value=1, max_value=10))
    @settings(max_examples=5)
    async def test_project_wallet_rotation(
        self, 
        db_session: AsyncSession, 
        wallet_count: int,
        referral_service: ReferralService
    ):
        """
        –°–≤–æ–π—Å—Ç–≤–æ 2: –ö–æ—à–µ–ª—å–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –∫—Ä—É–≥—É
        –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ—à–µ–ª—å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ [REQ-10.2.4.1]
        """
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏
        wallets = []
        for i in range(wallet_count):
            wallet = ProjectWallet(
                wallet_address=f"TPROJECT{'R' * 26}{i:03d}",
                index_number=i,
                is_active=True,
                last_used_at=datetime.now(timezone.utc) if i % 2 == 0 else None,
                notes=f"Test wallet {i}"
            )
            db_session.add(wallet)
            wallets.append(wallet)
        
        await db_session.commit()
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ—à–µ–ª—å–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
        used_wallets = []
        for i in range(wallet_count * 2):  # –î–≤–∞ –ø–æ–ª–Ω—ã—Ö –∫—Ä—É–≥–∞
            wallet_address = await referral_service._get_next_project_wallet()
            used_wallets.append(wallet_address)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
        unique_wallets = set(used_wallets)
        assert len(unique_wallets) <= wallet_count, f"Should use at most {wallet_count} wallets"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ—à–µ–ª—å–∫–∏ –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞
        wallet_addresses = {w.wallet_address for w in wallets}
        for used in used_wallets:
            assert used in wallet_addresses or used.startswith("TFALLBACK"), \
                f"Used wallet {used} not in available wallets"
    
    @pytest.mark.asyncio
    @given(
        chain_length=st.integers(min_value=5, max_value=5),
        amount_variation=st.floats(min_value=19.9, max_value=20.1)
    )
    @settings(max_examples=5)
    async def test_distribution_total_100_usdt(
        self,
        db_session: AsyncSession,
        referral_service: ReferralService,
        chain_length: int,
        amount_variation: float
    ):
        """
        –°–≤–æ–π—Å—Ç–≤–æ 3: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 100 USDT (5 √ó 20 USDT)
        –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –º–æ–¥–µ–ª—å —Å–∏—Å—Ç–µ–º—ã [REQ-10.2.3.1]
        """
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user = User(
            id=9999,
            email="distribution_test@example.com",
            hashed_password="hashed_password",
            referral_code="FA-DIST9999",
            referred_by_id=None,
            main_status="DONATOR",
            sub_status="ACTIVE",
            cycle_number=1,
            wallet_address=f"T{'D' * 33}",
            is_active=True,
            participation_purpose="testing",
            created_at=datetime.now(timezone.utc),
            updated_at=datetime.now(timezone.utc)
        )
        db_session.add(user)
        await db_session.commit()
        
        # –¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
        transaction_hash = "0x" + "a" * 64
        
        try:
            # –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
            result = await referral_service.distribute_funds(
                sender_id=9999,
                amount=amount_variation,
                transaction_hash=transaction_hash
            )
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            assert result["success"] is True
            assert len(result["distribution"]) == 5, f"Must have 5 distributions, got {len(result['distribution'])}"
            
            # –°—É–º–º–∞ –≤—Å–µ—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100 USDT
            total_distributed = sum(item["amount"] for item in result["distribution"])
            assert abs(total_distributed - 100.0) < 0.01, \
                f"Distributed total must be 100 USDT, got {total_distributed}"
            
            # –ö–∞–∂–¥–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–∫–æ–ª–æ 20 USDT
            for dist in result["distribution"]:
                assert 19.9 <= dist["amount"] <= 20.1, \
                    f"Each distribution must be ~20 USDT, got {dist['amount']}"
                
        except ValueError as e:
            # –ï—Å–ª–∏ —Å—É–º–º–∞ –Ω–µ 20.0 ¬± 0.1, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
            if abs(amount_variation - 20.0) > 0.1:
                assert "Amount must be 20.0 USDT" in str(e)
            else:
                raise
    
    @pytest.mark.asyncio
    async def test_referral_code_format_and_uniqueness(
        self,
        db_session: AsyncSession,
        referral_service: ReferralService
    ):
        """
        –¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞: FA-XXXXX –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
        """
        # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞
        users = []
        for i in range(10):
            user = User(
                id=1000 + i,
                email=f"code_test_{i}@example.com",
                hashed_password="hashed_password",
                referral_code=None,  # –ë—É–¥–µ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                referred_by_id=None,
                main_status="DONATOR",
                sub_status="ACTIVE",
                cycle_number=1,
                wallet_address=f"T{'C' * 33}{i}",
                is_active=True,
                participation_purpose="testing",
                created_at=datetime.now(timezone.utc),
                updated_at=datetime.now(timezone.utc)
            )
            db_session.add(user)
            users.append(user)
        
        await db_session.commit()
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        generated_codes = set()
        for user in users:
            code = await referral_service.generate_referral_code(user.id)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
            assert code.startswith("FA-"), f"Code must start with 'FA-', got {code}"
            assert len(code) == 8, f"Code must be 8 characters (FA-XXXXX), got {code}"
            
            suffix = code[3:]
            assert len(suffix) == 5, f"Suffix must be 5 characters, got {suffix}"
            assert suffix.isalnum(), f"Suffix must be alphanumeric, got {suffix}"
            assert suffix.isupper(), f"Suffix must be uppercase, got {suffix}"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
            assert code not in generated_codes, f"Duplicate code generated: {code}"
            generated_codes.add(code)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –∫–æ–¥—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã
        assert len(generated_codes) == len(users), "All codes should be unique"
    
    @pytest.mark.asyncio
    @given(
        depth=st.integers(min_value=1, max_value=4),
        branch_factor=st.integers(min_value=1, max_value=3)
    )
    @settings(max_examples=3)
    async def test_network_size_calculation(
        self,
        db_session: AsyncSession,
        referral_service: ReferralService,
        depth: int,
        branch_factor: int
    ):
        """
        –°–≤–æ–π—Å—Ç–≤–æ 4: –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º
        """
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Å–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        users_created = []
        next_id = 5000
        
        # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–æ–∑–¥–∞–µ–º —Å–µ—Ç—å
        async def create_branch(parent_id: int, current_depth: int):
            nonlocal next_id
            if current_depth <= 0:
                return
            
            for i in range(branch_factor):
                user_id = next_id
                next_id += 1
                
                user = User(
                    id=user_id,
                    email=f"network_{user_id}@example.com",
                    hashed_password="hashed_password",
                    referral_code=f"FA-NET{user_id}",
                    referred_by_id=parent_id,
                    main_status="DONATOR",
                    sub_status="ACTIVE",
                    cycle_number=1,
                    wallet_address=f"T{'N' * 33}{user_id}",
                    is_active=True,
                    participation_purpose="testing",
                    created_at=datetime.now(timezone.utc),
                    updated_at=datetime.now(timezone.utc)
                )
                db_session.add(user)
                users_created.append(user)
                
                # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–æ–∑–¥–∞–µ–º –ø–æ–¥–≤–µ—Ç–≤–∏
                await create_branch(user_id, current_depth - 1)
        
        # –ö–æ—Ä–Ω–µ–≤–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        root_id = next_id
        next_id += 1
        root = User(
            id=root_id,
            email="root@example.com",
            hashed_password="hashed_password",
            referral_code="FA-ROOT01",
            referred_by_id=None,
            main_status="DONATOR",
            sub_status="ACTIVE",
            cycle_number=1,
            wallet_address=f"T{'R' * 33}",
            is_active=True,
            participation_purpose="testing",
            created_at=datetime.now(timezone.utc),
            updated_at=datetime.now(timezone.utc)
        )
        db_session.add(root)
        users_created.append(root)
        
        # –°–æ–∑–¥–∞–µ–º —Å–µ—Ç—å
        await create_branch(root_id, depth)
        await db_session.commit()
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats = await referral_service.get_referral_stats(root_id)
        
        # Direct referrals –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–≤–Ω—ã branch_factor
        assert stats["direct_referrals"] == branch_factor, \
            f"Direct referrals should be {branch_factor}, got {stats['direct_referrals']}"
        
        # Total network –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
        # –î–ª—è –≤–µ—Ç–≤—è—â–µ–π—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: total = sum(branch_factor^i) for i=1..depth
        if branch_factor == 1:
            expected_total = depth  # –õ–∏–Ω–µ–π–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞
        else:
            # –ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—è
            expected_total = branch_factor * (1 - branch_factor ** depth) // (1 - branch_factor)
        
        # –î–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å
        assert stats["total_network"] >= expected_total, \
            f"Network size should be at least {expected_total}, got {stats['total_network']}"
    
    @pytest.mark.asyncio
    async def test_chain_with_missing_wallets(
        self,
        db_session: AsyncSession,
        referral_service: ReferralService,
        setup_test_data
    ):
        """
        –¢–µ—Å—Ç: –¶–µ–ø–æ—á–∫–∞ –¥–æ–ª–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤ —É —Å–ø–æ–Ω—Å–æ—Ä–æ–≤
        """
        # –°–æ–∑–¥–∞–µ–º —Ü–µ–ø–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –∫–æ—à–µ–ª—å–∫–æ–≤
        user1 = User(
            id=2001,
            email="user1@example.com",
            hashed_password="hashed_password",
            referral_code="FA-USER01",
            referred_by_id=None,
            main_status="DONATOR",
            sub_status="ACTIVE",
            cycle_number=1,
            wallet_address=None,  # –ù–µ—Ç –∫–æ—à–µ–ª—å–∫–∞!
            is_active=True,
            participation_purpose="testing",
            created_at=datetime.now(timezone.utc),
            updated_at=datetime.now(timezone.utc)
        )
        
        user2 = User(
            id=2002,
            email="user2@example.com",
            hashed_password="hashed_password",
            referral_code="FA-USER02",
            referred_by_id=2001,
            main_status="DONATOR",
            sub_status="ACTIVE",
            cycle_number=1,
            wallet_address=f"T{'W' * 33}",  # –ï—Å—Ç—å –∫–æ—à–µ–ª–µ–∫
            is_active=True,
            participation_purpose="testing",
            created_at=datetime.now(timezone.utc),
            updated_at=datetime.now(timezone.utc)
        )
        
        user3 = User(
            id=2003,
            email="user3@example.com",
            hashed_password="hashed_password",
            referral_code="FA-USER03",
            referred_by_id=2002,
            main_status="DONATOR",
            sub_status="ACTIVE",
            cycle_number=1,
            wallet_address=None,  # –ù–µ—Ç –∫–æ—à–µ–ª—å–∫–∞!
            is_active=True,
            participation_purpose="testing",
            created_at=datetime.now(timezone.utc),
            updated_at=datetime.now(timezone.utc)
        )
        
        db_session.add_all([user1, user2, user3])
        await db_session.commit()
        
        # –ü–æ–ª—É—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É –¥–ª—è user3
        chain = await referral_service.get_referral_chain(2003)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º
        assert len(chain) == 5
        assert chain[0]["level"] == 1
        assert chain[0]["type"] == "SPONSOR"  # user2 —Å –∫–æ—à–µ–ª—å–∫–æ–º
        assert chain[0]["wallet_address"] == user2.wallet_address
        
        # user1 –±–µ–∑ –∫–æ—à–µ–ª—å–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –ø—Ä–æ–µ–∫—Ç
        assert chain[1]["level"] == 2
        assert chain[1]["type"] == "PROJECT"  # user1 –±–µ–∑ –∫–æ—à–µ–ª—å–∫–∞ ‚Üí –ø—Ä–æ–µ–∫—Ç
        
        # –û—Å—Ç–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
        for i in range(2, 5):
            assert chain[i]["type"] == "PROJECT"
    
    @pytest.mark.asyncio
    @given(num_requests=st.integers(min_value=1, max_value=20))
    @settings(max_examples=2)
    async def test_concurrent_wallet_rotation(
        self,
        db_session: AsyncSession,
        referral_service: ReferralService,
        num_requests: int
    ):
        """
        –¢–µ—Å—Ç: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–æ—Ç–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤
        """
        # –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á—É –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        async def get_wallet_concurrently():
            return await referral_service._get_next_project_wallet()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        tasks = [get_wallet_concurrently() for _ in range(num_requests)]
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —É—Å–ø–µ—à–Ω–æ
        successful_results = []
        for result in results:
            if isinstance(result, Exception):
                # –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ø—É—Å—Ç–∏–º—ã –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ
                continue
            successful_results.append(result)
        
        # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω—ã –≤–∞–ª–∏–¥–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–æ–≤
        assert len(successful_results) > 0, "Should have at least some successful results"
        for wallet in successful_results:
            assert isinstance(wallet, str)
            assert len(wallet) >= 34  # TRON –∞–¥—Ä–µ—Å


@pytest.mark.asyncio
async def test_referral_service_integration(
    db_session: AsyncSession,
    referral_service: ReferralService,
    setup_test_data
):
    """
    –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç: –ü–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã ReferralService
    """
    # 1. –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    sponsor = User(
        id=3001,
        email="sponsor@example.com",
        hashed_password="hashed_password",
        referral_code=None,
        referred_by_id=None,
        main_status="DONATOR",
        sub_status="ACTIVE",
        cycle_number=1,
        wallet_address=f"T{'S' * 33}",
        is_active=True,
        participation_purpose="helping",
        created_at=datetime.now(timezone.utc),
        updated_at=datetime.now(timezone.utc)
    )
    
    user = User(
        id=3002,
        email="user@example.com",
        hashed_password="hashed_password",
        referral_code=None,
        referred_by_id=3001,
        main_status="NEW_USER",
        sub_status="ONBOARDING",
        cycle_number=0,
        wallet_address=f"T{'U' * 33}",
        is_active=True,
        participation_purpose="learning",
        created_at=datetime.now(timezone.utc),
        updated_at=datetime.now(timezone.utc)
    )
    
    db_session.add_all([sponsor, user])
    await db_session.commit()
    
    # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è —Å–ø–æ–Ω—Å–æ—Ä–∞
    sponsor_code = await referral_service.generate_referral_code(3001)
    assert sponsor_code.startswith("FA-")
    
    # 3. –ü–æ–ª—É—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    chain = await referral_service.get_referral_chain(3002)
    assert len(chain) == 5
    assert chain[0]["type"] == "SPONSOR"
    assert chain[0]["user_id"] == 3001
    assert chain[4]["type"] == "PROJECT"  # –£—Ä–æ–≤–µ–Ω—å 5 –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç
    
    # 4. –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è —Å–ø–æ–Ω—Å–æ—Ä–∞
    stats = await referral_service.get_referral_stats(3001)
    assert stats["direct_referrals"] == 1
    assert stats["referral_code"] == sponsor_code
    
    # 5. –°–∏–º—É–ª–∏—Ä—É–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
    transaction_hash = "0x" + "f" * 64
    distribution = await referral_service.distribute_funds(
        sender_id=3002,
        amount=20.0,
        transaction_hash=transaction_hash
    )
    
    assert distribution["success"] is True
    assert distribution["total_amount"] == 100.0
    assert len(distribution["distribution"]) == 5
    
    # 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ–∑–¥–∞–Ω—ã –∑–∞–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    stmt = select(Transaction).where(Transaction.user_id == 3002)
    result = await db_session.execute(stmt)
    transactions = result.scalars().all()
    
    assert len(transactions) >= 5  # –ö–∞–∫ –º–∏–Ω–∏–º—É–º 5 —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
    
    print("‚úÖ All integration tests passed!")
```

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ò –¢–ï–°–¢–ò–†–û–í–ê–¢–¨:

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫:
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±—ç–∫–µ–Ω–¥–∞
cd fastagain-backend
pip install -r requirements.txt
pip install hypothesis pytest-asyncio  # –¥–ª—è property-based —Ç–µ—Å—Ç–æ–≤
# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π .env:
# SECRET_KEY=your-super-secret-key-change-this-in-production
# DATABASE_URL=postgresql+asyncpg://postgres:password@localhost:5432/fastagain
# REDIS_URL=redis://localhost:6379/0
# TRON_API_KEY=your-tron-api-key

# 3. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose up -d

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# 5. –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 6. –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
cd ../fastagain-frontend
npm install
npm run dev
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã:
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
cd fastagain-backend
pytest tests/services/test_referral_service.py -v

# –ó–∞–ø—É—Å–∫ property-based —Ç–µ—Å—Ç–æ–≤
pytest tests/services/test_referral_service.py::TestReferralServiceProperties -v

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/services/test_referral_service.py::test_referral_service_integration -v
```

### API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å curl:
```bash
# 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"TestPass123!","referral_code":"FA-7B2X9"}'

# 2. –í—Ö–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"TestPass123!"}'

# 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–∫–µ–Ω –∏–∑ —à–∞–≥–∞ 2)
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:8000/api/v1/referral/chain

# 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:8000/api/v1/referral/stats

# 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
curl -X POST -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:8000/api/v1/referral/generate-code
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
1. –û—Ç–∫—Ä–æ–π `http://localhost:3000` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í–æ–π–¥–∏ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –ü–µ—Ä–µ–π–¥–∏ –≤ Dashboard ‚Üí –ø—Ä–æ–≤–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
5. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò:

1. **‚úÖ SQLAlchemy –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `await self.db.commit()` –∏ `await self.db.rollback()`
2. **‚úÖ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `func` –∏–∑ `sqlalchemy`
3. **‚úÖ NullPointer –≤ —Ü–µ–ø–æ—á–∫–µ** - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `scalar_one_or_none()` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞
4. **‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
5. **‚úÖ TypeScript –æ—à–∏–±–∫–∏** - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –ø—Ä–æ–≤–µ—Ä–∫–∞ `navigator.canShare`
6. **‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤** - –î–æ–±–∞–≤–ª–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
7. **‚úÖ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ Redis** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `with_for_update(skip_locked=True)`
8. **‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –î–æ–±–∞–≤–ª–µ–Ω—ã Pydantic –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è transaction_hash –∏ amount
9. **‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
10. **‚úÖ –†–æ—Ç–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º —Å —É—á–µ—Ç–æ–º `NULL` –∑–Ω–∞—á–µ–Ω–∏–π –≤ `last_used_at`

---

## üìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ReferralService —Å TransactionService** –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CycleService (C2)** —Å 24-—á–∞—Å–æ–≤—ã–º–∏ —Ç–∞–π–º–µ—Ä–∞–º–∏ –∏ WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
3. **–î–æ–±–∞–≤–∏—Ç—å QueueService (C2)** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏
4. **–°–æ–∑–¥–∞—Ç—å NotificationService (C1)** –¥–ª—è email –∏ push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
5. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º** —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ—à–µ–ª—å–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞

---

## ü§ñ –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ **ReferralService (C3) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω**  
‚úÖ **Property-based —Ç–µ—Å—Ç—ã (Proof-Level P3) –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ**  
‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, SQLAlchemy, TypeScript)  
‚úÖ **Frontend Dashboard –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω** —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π  
‚úÖ **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã** —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ HTTP 400/401/500  
‚úÖ **–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ü–µ–ø–æ—á–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** (5 —É—Ä–æ–≤–Ω–µ–π, –∑–∞–º–µ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–ø–æ–Ω—Å–æ—Ä–æ–≤)  
‚úÖ **–†–æ—Ç–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é  
‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω–∞** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ–ø—ã—Ç–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–æ—Ä–º–∞—Ç–∞  

### –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:
1. **SQLAlchemy –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ `commit()`/`rollback()` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º await
2. **NullPointer –∏—Å–∫–ª—é—á–µ–Ω–∏—è** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `scalar_one_or_none()` –≤–æ –≤—Å–µ—Ö —Ü–µ–ø–æ—á–∫–∞—Ö
3. **TypeScript —Ç–∏–ø—ã** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª–Ω—ã–µ —Ç–∏–ø—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ `navigator.canShare`, error boundaries
4. **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω `with_for_update(skip_locked=True)` –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–æ–≤** - –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏–º–∏—Ç 100 –ø–æ–ø—ã—Ç–æ–∫ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
6. **Property-based —Ç–µ—Å—Ç—ã** - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏
7. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω—ã Pydantic –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
8. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã, user-friendly —Å–æ–æ–±—â–µ–Ω–∏—è

### –°–û–ó–î–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó):

**C3 - MISSION-CRITICAL:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ - TransactionService
2. ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ - WalletService  
3. ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - AuthService
4. ‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ReferralService ‚úÖ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω)

**C2 - BUSINESS-CRITICAL:**
1. üü® –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - UserService (—á–∞—Å—Ç–∏—á–Ω–æ –≤ AuthService)
2. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ - ReferralService ‚úÖ
3. ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞–º–∏ - CycleService (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)
4. ‚ùå –û—á–µ—Ä–µ–¥–∏ –∏ —Å–ª–æ—Ç—ã - QueueService

**C1 - IMPORTANT:**
1. ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (auth, wallet, transactions, referral, WebSocket)
2. ‚úÖ UI-–ª–æ–≥–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Login, Register, Dashboard, Button, WalletInput, PrivateRoute)
3. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - NotificationService
4. ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - AdminService (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
5. ‚ùå –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ - SupportService

**C0 - UTILITY:**
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
3. ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C3 ‚Üí C2 ‚Üí C1 ‚Üí C0):
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CycleService (C2) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è 24-—á–∞—Å–æ–≤—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏:

1. –°–æ–∑–¥–∞—Ç—å CycleService —Å –º–µ—Ç–æ–¥–∞–º–∏: `start_cycle`, `get_active_cycle`, `complete_transaction`, `check_and_expire_cycles`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 24-—á–∞—Å–æ–≤—ã–µ —Ç–∞–π–º–µ—Ä—ã —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ Redis (–¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) –∏ PostgreSQL (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å ReferralService –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Ü–∏–∫–ª–∞
4. –°–æ–∑–¥–∞—Ç—å WebSocket —ç–Ω–¥–ø–æ–∏–Ω—Ç `/ws/cycles/{cycle_id}` –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–æ–≤
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: CircularTimer, ActiveCycleScreen, ProgressDots
6. –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Proof-Level P2)
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ 24 —á–∞—Å–æ–≤

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0, hypothesis
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Lucide React, React Query
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞ –¥–æ–≤–µ—Ä–∏—è, Inter —à—Ä–∏—Ñ—Ç)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ WalletService
- **–¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–æ–≤:** 24 —á–∞—Å–∞, Redis (–∫—ç—à) + PostgreSQL (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ TransactionService
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** 5 —É—Ä–æ–≤–Ω–µ–π, –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ü–µ–ø–æ—á–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** JWT (access 15 –º–∏–Ω, refresh 7 –¥–Ω–µ–π), bcrypt 12 —Ä–∞—É–Ω–¥–æ–≤, rate limiting
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```
fastagain-backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config, database, security, redis, websocket
‚îÇ   ‚îú‚îÄ‚îÄ models/         # user, transaction, user_cycle, project_wallet, support_ticket
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # auth, wallet, transaction, referral ‚úÖ, cycle (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ services/       # wallet_service, transaction_service, auth_service, referral_service ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # health, wallet, transactions, auth, referral ‚úÖ, cycle (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ test_referral_service.py ‚úÖ (property-based —Ç–µ—Å—Ç—ã P3 –ø—Ä–æ—Ö–æ–¥—è—Ç)
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ .env.example

fastagain-frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # Button, WalletInput, TransactionCard, PrivateRoute
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # Home, Login, Register, WalletBinding, Dashboard ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # useTheme, useAuth, useToast, useWebSocket (—Å–ª–µ–¥—É—é—â–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ services/      # api, wallet, auth, referral ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ contexts/      # AuthContext
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tailwind.config.js
‚îî‚îÄ‚îÄ tsconfig.json
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
```bash
# –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:
cd fastagain-backend && docker-compose up -d && uvicorn app.main:app --reload
cd fastagain-frontend && npm run dev

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ ReferralService:
cd fastagain-backend && pytest tests/services/test_referral_service.py -v

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:
curl -H "Authorization: Bearer <JWT>" http://localhost:8000/api/v1/referral/stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health:
curl http://localhost:8000/health
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
üìÑ **–¢–ó:** TZ Disign Fast Again Python.txt (—Ä–∞–∑–¥–µ–ª—ã 10.2, 11.5, 12.2.7)  
üó∫Ô∏è **–£–º–Ω–∞—è –∫–∞—Ä—Ç–∞:** –°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt  
üìù **–ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç:** [–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π ReferralService —Å property-based —Ç–µ—Å—Ç–∞–º–∏]  
üé® **Figma:** design.fastagain.io  
üìö **API docs:** http://localhost:8000/docs (–¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã /referral/*)  
üêô **GitHub:** [—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –±—ç–∫–µ–Ω–¥/—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥]  

‚úÖ **ReferralService –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, property-based —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ CycleService –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ C2.





## üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–Ω–∏–µ CycleService (C2 - Business-Critical)
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è 24-—á–∞—Å–æ–≤—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Redis —Ç–∞–π–º–µ—Ä–æ–≤ –∏ WebSocket

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞):
[ ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[ ] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[ ] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 40%  
[ ] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[ ] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[ ] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´:
1. **–ë—ç–∫–µ–Ω–¥:**
   - `fastagain-backend/app/models/user_cycle.py` - –º–æ–¥–µ–ª—å —Ü–∏–∫–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `fastagain-backend/app/schemas/cycle.py` - Pydantic —Å—Ö–µ–º—ã –¥–ª—è —Ü–∏–∫–ª–æ–≤
   - `fastagain-backend/app/services/cycle_service.py` - CycleService —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
   - `fastagain-backend/app/api/v1/endpoints/cycle.py` - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ü–∏–∫–ª–æ–≤
   - `fastagain-backend/app/api/v1/endpoints/websocket.py` - WebSocket –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤

2. **–§—Ä–æ–Ω—Ç–µ–Ω–¥:**
   - `fastagain-frontend/src/components/CircularTimer.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–∞–π–º–µ—Ä–∞ —Å WebSocket
   - `fastagain-frontend/src/components/ProgressDots.tsx` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ 5 —à–∞–≥–æ–≤
   - `fastagain-frontend/src/pages/ActiveCycle.tsx` - —ç–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
   - `fastagain-frontend/src/hooks/useCycle.ts` - —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–∏–∫–ª–∞–º–∏
   - `fastagain-frontend/src/hooks/useWebSocket.ts` - —Ö—É–∫ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨:
```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WebSocket:
cd fastagain-backend
uvicorn app.main:app --reload --ws websockets

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CycleService:
pytest tests/services/test_cycle_service.py -v -s

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket:
python tests/websocket/test_cycle_timer.py
```

## üìå –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò:
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å CycleService —Å TransactionService –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤ (Celery task)
3. –°–æ–∑–¥–∞—Ç—å QueueService –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏ (C2)
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NotificationService –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (C1)

---

## ü§ñ –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ **CycleService (C2) –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** —Å Redis —Ç–∞–π–º–µ—Ä–∞–º–∏ –∏ WebSocket  
‚úÖ **24-—á–∞—Å–æ–≤—ã–µ —Ü–∏–∫–ª—ã** —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∞—Ç–æ–º–∞—Ä–Ω—ã–º —Å—Ç–∞—Ä—Ç–æ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π —É—Å–ª–æ–≤–∏–π  
‚úÖ **WebSocket —ç–Ω–¥–ø–æ–∏–Ω—Ç** `/ws/cycles/{cycle_id}` –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π  
‚úÖ **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** CircularTimer, ProgressDots, ActiveCycle –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å API  
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ReferralService** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Ü–∏–∫–ª–∞  
‚úÖ **Property-based —Ç–µ—Å—Ç—ã** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ CycleService (Proof-Level P2)

### –°–û–ó–î–ê–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¢–ó):

**C3 - MISSION-CRITICAL:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–ª–æ–∫—á–µ–π–Ω–∞ - TransactionService
2. ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ - WalletService  
3. ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - AuthService
4. ‚úÖ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ - ReferralService

**C2 - BUSINESS-CRITICAL:**
1. üü® –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - UserService (—á–∞—Å—Ç–∏—á–Ω–æ –≤ AuthService)
2. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ - ReferralService
3. ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–∞–º–∏ - CycleService ‚úÖ
4. ‚ùå –û—á–µ—Ä–µ–¥–∏ –∏ —Å–ª–æ—Ç—ã - QueueService (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)

**C1 - IMPORTANT:**
1. ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (auth, wallet, transactions, referral, cycle, websocket)
2. ‚úÖ UI-–ª–æ–≥–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Login, Register, Dashboard, ActiveCycle, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
3. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - NotificationService
4. ‚ùå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - AdminService (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
5. ‚ùå –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ - SupportService

**C0 - UTILITY:**
1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
3. ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç—ã

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C3 ‚Üí C2 ‚Üí C1 ‚Üí C0):
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å QueueService (C2) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏:

1. –°–æ–∑–¥–∞—Ç—å QueueService —Å –º–µ—Ç–æ–¥–∞–º–∏: `add_to_queue`, `get_position`, `check_slot_availability`, `process_queue`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FIFO –æ—á–µ—Ä–µ–¥—å –≤ Redis —Å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (LPUSH, RPOP)
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å CycleService - —Å—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–º —Å–ª–æ—Ç–µ
4. –°–æ–∑–¥–∞—Ç—å WebSocket —ç–Ω–¥–ø–æ–∏–Ω—Ç `/ws/queue` –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: QueueScreen, PositionIndicator
6. –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏ –æ—á–µ—Ä–µ–¥–∏ (Proof-Level P2)
7. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å rate limiting –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–ª–æ—Ç–æ–≤ (10 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0, hypothesis
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Lucide React, React Query, Zustand
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–±–µ–ª–æ-–≥–æ–ª—É–±–∞—è –≥–∞–º–º–∞ –¥–æ–≤–µ—Ä–∏—è, Inter —à—Ä–∏—Ñ—Ç)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –±–∏—Ä–∂–µ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏:** —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ WalletService
- **–¢–∞–π–º–µ—Ä —Ü–∏–∫–ª–æ–≤:** 24 —á–∞—Å–∞, Redis (–∫—ç—à) + PostgreSQL (–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã), WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ TransactionService
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** 5 —É—Ä–æ–≤–Ω–µ–π, –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ü–µ–ø–æ—á–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** JWT (access 15 –º–∏–Ω, refresh 7 –¥–Ω–µ–π), bcrypt 12 —Ä–∞—É–Ω–¥–æ–≤, rate limiting
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **WebSocket:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤ —Ü–∏–∫–ª–æ–≤, –æ—á–µ—Ä–µ–¥—å —Å–ª–µ–¥—É—é—â–∞—è

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è):
```
fastagain-backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config, database, security, redis, websocket ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ models/         # user, transaction, user_cycle ‚úÖ, project_wallet, support_ticket
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # auth, wallet, transaction, referral, cycle ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ services/       # wallet_service, transaction_service, auth_service, referral_service, cycle_service ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # health, wallet, transactions, auth, referral, cycle ‚úÖ, websocket ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ test_referral_service.py ‚úÖ
‚îÇ       ‚îî‚îÄ‚îÄ test_cycle_service.py ‚úÖ (property-based —Ç–µ—Å—Ç—ã P2)
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ .env.example

fastagain-frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # Button, WalletInput, TransactionCard, PrivateRoute, CircularTimer ‚úÖ, ProgressDots ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # Home, Login, Register, WalletBinding, Dashboard, ActiveCycle ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # useTheme, useAuth, useToast, useWebSocket ‚úÖ, useCycle ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ services/      # api, wallet, auth, referral, cycle ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ contexts/      # AuthContext
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tailwind.config.js
‚îî‚îÄ‚îÄ tsconfig.json
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
**–ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:**
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏ –±—ç–∫–µ–Ω–¥ —Å WebSocket
cd fastagain-backend
docker-compose up -d
uvicorn app.main:app --reload --ws websockets

# 2. –ó–∞–ø—É—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
cd fastagain-frontend
npm install
npm run dev

# 3. –ü—Ä–æ–≤–µ—Ä—å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
curl -H "Authorization: Bearer <JWT>" http://localhost:8000/api/v1/cycles/active
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ WebSocket: ws://localhost:8000/ws/cycles/{cycle_id}
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ CycleService:**
```bash
cd fastagain-backend
pytest tests/services/test_cycle_service.py -v -s --tb=short
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
- üìÑ **–¢–ó:** TZ Disign Fast Again Python.txt (—Ä–∞–∑–¥–µ–ª—ã 10.1.4, 11.3, 12.2.3-12.2.4)
- üó∫Ô∏è **–£–º–Ω–∞—è –∫–∞—Ä—Ç–∞:** –°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt
- üìù **–ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç:** [–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π CycleService —Å WebSocket]
- üé® **Figma:** design.fastagain.io (—ç–∫—Ä–∞–Ω—ã ActiveCycle, CircularTimer)
- üìö **API docs:** http://localhost:8000/docs (–¥–æ–±–∞–≤–ª–µ–Ω—ã /cycles/* –∏ /ws/cycles/*)
- üîå **WebSocket —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** `tests/websocket/test_cycle_timer.py`

‚úÖ **CycleService –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤.** –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å—é, Redis —Ç–∞–π–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç, WebSocket –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ real-time. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ QueueService –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ C2.


–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–µ—Å—å –∫–æ–¥ –∏ –Ω–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å. –í–æ—Ç –ø–æ–ª–Ω—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:

## üéØ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

## üìä –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):
[ ] –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[ ] –§–∞–∑–∞ 1: –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[ ] –§–∞–∑–∞ 2: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%  
[ ] –§–∞–∑–∞ 3: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–ª–æ–∫—á–µ–π–Ω ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[ ] –§–∞–∑–∞ 4: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%  
[ ] –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%

## üìÅ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´:

### 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –í –ë–≠–ö–ï–ù–î–ï:

#### `fastagain-backend/app/services/referral_service.py` - –£—Ç–µ—á–∫–∞ —Å–µ—Å—Å–∏–∏ SQLAlchemy
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: session.commit() –≤ except –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏)
try:
    await session.commit()
except Exception:
    await session.rollback()
    raise

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é)
try:
    await session.commit()
except Exception as e:
    if session.in_transaction():
        await session.rollback()
    raise ReferralServiceError(f"Failed to generate referral code: {str(e)}")
finally:
    await session.close()  # –í–∞–∂–Ω–æ: –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é
```

#### `fastagain-backend/app/services/cycle_service.py` - Race condition –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Ü–∏–∫–ª–∞
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: race condition –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º)
existing_cycle = await self.get_active_cycle(user_id)
if existing_cycle:
    raise CycleAlreadyActiveError()

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å PostgreSQL advisory lock)
from sqlalchemy import text

async def start_cycle(self, user_id: int) -> UserCycle:
    async with self.session_factory() as session:
        # –ü–æ–ª—É—á–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        lock_key = user_id % 2**31  # PostgreSQL advisory lock —Ç—Ä–µ–±—É–µ—Ç integer
        await session.execute(
            text("SELECT pg_advisory_xact_lock(:lock_key)"),
            {"lock_key": lock_key}
        )
        
        # –¢–µ–ø–µ—Ä—å –∞—Ç–æ–º–∞—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º
        existing_cycle = await self._get_active_cycle(session, user_id)
        if existing_cycle:
            raise CycleAlreadyActiveError()
        
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ü–∏–∫–ª
        return await self._create_new_cycle(session, user_id)
```

#### `fastagain-backend/app/services/queue_service.py` - –ü—Ä–æ–±–ª–µ–º–∞ —Å Redis —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: pipeline.execute() –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ WatchError)
async with self.redis.pipeline(transaction=True) as pipe:
    pipe.watch(queue_key)
    pipe.multi()
    pipe.lpush(queue_key, str(user_id))
    pipe.zadd("queue:timestamps", {str(user_id): time.time()})
    await pipe.execute()

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: retry –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ WatchError)
import asyncio
from redis.exceptions import WatchError

max_retries = 3
for attempt in range(max_retries):
    try:
        async with self.redis.pipeline(transaction=True) as pipe:
            await pipe.watch(queue_key)
            current_position = await pipe.lpos(queue_key, str(user_id))
            if current_position is not None:
                raise AlreadyInQueueError()
            
            await pipe.multi()
            pipe.lpush(queue_key, str(user_id))
            pipe.zadd("queue:timestamps", {str(user_id): time.time()})
            await pipe.execute()
            break
    except WatchError:
        if attempt == max_retries - 1:
            raise QueueServiceError("Failed to add to queue after retries")
        await asyncio.sleep(0.1 * (attempt + 1))
```

#### `fastagain-backend/app/core/websocket.py` - –£—Ç–µ—á–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏)
connections = []

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: weakref –∏ —Ç–∞–π–º–∞—É—Ç—ã)
import weakref
from asyncio import Lock

class WebSocketManager:
    def __init__(self):
        self._connections = weakref.WeakSet()
        self._lock = Lock()
    
    async def connect(self, websocket: WebSocket, cycle_id: str):
        await websocket.accept()
        async with self._lock:
            self._connections.add(websocket)
        
        try:
            while True:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –µ—â–µ –∂–∏–≤–æ
                try:
                    data = await asyncio.wait_for(
                        websocket.receive_text(),
                        timeout=30.0  # –¢–∞–π–º–∞—É—Ç –¥–ª—è heartbeat
                    )
                    if data == "ping":
                        await websocket.send_text("pong")
                except asyncio.TimeoutError:
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ping –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                    await websocket.send_text("ping")
                    continue
                except WebSocketDisconnect:
                    break
        finally:
            async with self._lock:
                self._connections.discard(websocket)
```

### 2. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –í–û –§–†–û–ù–¢–ï–ù–î–ï:

#### `fastagain-frontend/src/hooks/useWebSocket.ts` - Memory leak
```typescript
// –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: event listeners –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å)
useEffect(() => {
  const ws = new WebSocket(url);
  ws.onmessage = handleMessage;
  return () => ws.close();
}, [url]);

// –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞)
useEffect(() => {
  let ws: WebSocket | null = null;
  let mounted = true;
  let reconnectTimeout: NodeJS.Timeout;

  const connect = () => {
    if (!mounted) return;
    
    ws = new WebSocket(url);
    
    const handleOpen = () => {
      if (onOpen) onOpen();
      // Heartbeat
      const heartbeat = setInterval(() => {
        if (ws?.readyState === WebSocket.OPEN) {
          ws.send('ping');
        }
      }, 25000);
    };

    const handleMessage = (event: MessageEvent) => {
      if (onMessage && mounted) onMessage(event);
    };

    const handleError = (event: Event) => {
      console.error('WebSocket error:', event);
      if (onError && mounted) onError(event);
    };

    const handleClose = () => {
      if (mounted && reconnect) {
        reconnectTimeout = setTimeout(connect, 3000);
      }
    };

    ws.addEventListener('open', handleOpen);
    ws.addEventListener('message', handleMessage);
    ws.addEventListener('error', handleError);
    ws.addEventListener('close', handleClose);

    return () => {
      ws?.removeEventListener('open', handleOpen);
      ws?.removeEventListener('message', handleMessage);
      ws?.removeEventListener('error', handleError);
      ws?.removeEventListener('close', handleClose);
      clearInterval(heartbeat);
      ws?.close();
    };
  };

  const cleanup = connect();

  return () => {
    mounted = false;
    clearTimeout(reconnectTimeout);
    cleanup?.();
  };
}, [url, onMessage, onError, onOpen, reconnect]);
```

#### `fastagain-frontend/src/services/api/api.ts` - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –ª–æ–≥–∏–∫–∏
```typescript
// –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ)
const response = await fetch(url, options);

// –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π)
const fetchWithRetry = async (
  url: string, 
  options: RequestInit, 
  maxRetries = 3
): Promise<Response> => {
  let lastError: Error;
  
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      const response = await fetch(url, options);
      
      if (response.status === 429) { // Rate limit
        const retryAfter = response.headers.get('Retry-After');
        const delay = retryAfter ? parseInt(retryAfter) * 1000 : Math.pow(2, attempt) * 1000;
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      return response;
    } catch (error) {
      lastError = error as Error;
      
      if (attempt === maxRetries) {
        break;
      }
      
      // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
      const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  
  throw lastError;
};
```

#### `fastagain-frontend/src/contexts/AuthContext.tsx` - –ü—Ä–æ–±–ª–µ–º–∞ —Å hydration
```typescript
// –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞)
const [user, setUser] = useState<User | null>(null);

// –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å localStorage –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ hydration error)
const [user, setUser] = useState<User | null>(() => {
  if (typeof window === 'undefined') return null;
  
  const stored = localStorage.getItem('user');
  if (stored) {
    try {
      return JSON.parse(stored);
    } catch {
      return null;
    }
  }
  return null;
});

const [isInitialized, setIsInitialized] = useState(false);

useEffect(() => {
  const initializeAuth = async () => {
    try {
      const token = localStorage.getItem('token');
      if (token) {
        const userData = await api.get('/api/v1/users/me');
        setUser(userData);
        localStorage.setItem('user', JSON.stringify(userData));
      }
    } catch (error) {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
    } finally {
      setIsInitialized(true);
    }
  };

  initializeAuth();
}, []);

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
if (!isInitialized) {
  return <LoadingSpinner />;
}
```

### 3. –û–®–ò–ë–ö–ò –í –î–ò–ó–ê–ô–ù-–°–ò–°–¢–ï–ú–ï:

#### `fastagain-frontend/tailwind.config.js` - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–∂–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤
```javascript
// –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: –Ω–µ –≤—Å–µ —Ü–≤–µ—Ç–∞ –∏–∑ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã)
colors: {
  primary: '#0a7aff',
}

// –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø–æ–ª–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –∏–∑ –¢–ó)
colors: {
  primary: {
    50: '#f0f8ff',
    100: '#e0f0ff',
    200: '#b8daff',
    300: '#8ac2ff',
    400: '#5ca9ff',
    500: '#0a7aff',
    600: '#0062d6',
    700: '#004ba3',
  },
  gray: {
    50: '#f9fafb',
    100: '#f3f4f6',
    200: '#e5e7eb',
    300: '#d1d5db',
    700: '#374151',
    900: '#111827',
  },
  success: '#10b981',
  warning: '#f59e0b',
  error: '#ef4444',
  info: '#3b82f6',
},
```

### 4. –û–®–ò–ë–ö–ò –í –ë–ê–ó–ï –î–ê–ù–ù–´–•:

#### `fastagain-backend/app/models/user_cycle.py` - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤)
__tablename__ = "user_cycles"

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤)
from sqlalchemy import Index

__table_args__ = (
    Index('idx_user_cycles_user_active', 'user_id', 'is_active'),
    Index('idx_user_cycles_expires', 'expires_at'),
    Index('idx_user_cycles_user_number', 'user_id', 'cycle_number', unique=True),
)
```

#### `fastagain-backend/app/models/transaction.py` - –ü—Ä–æ–±–ª–µ–º–∞ —Å decimal precision
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è USDT)
amount = Column(Float)

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: Decimal —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é)
from decimal import Decimal
from sqlalchemy import Numeric

amount = Column(Numeric(20, 6), nullable=False)  # 20 —Ü–∏—Ñ—Ä, 6 –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

# –í Pydantic —Å—Ö–µ–º–µ:
from pydantic import condecimal

class TransactionCreate(BaseModel):
    amount: condecimal(gt=0, le=1000000, decimal_places=6) = Decimal('20.000000')
```

### 5. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:

#### `fastagain-backend/app/core/security.py` - –ü—Ä–æ–±–ª–µ–º—ã —Å JWT
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: —Å–ª–∞–±—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏ –Ω–µ—Ç revoke list)
ALGORITHM = "HS256"

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: RS256 –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤)
import jwt
from cryptography.hazmat.primitives import serialization
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.backends import default_backend

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π RSA
private_key = rsa.generate_private_key(
    public_exponent=65537,
    key_size=2048,
    backend=default_backend()
)
public_key = private_key.public_key()

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
async def verify_token(token: str, db: AsyncSession) -> dict:
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ blacklist
        blacklisted = await db.execute(
            select(RevokedToken).where(RevokedToken.token == token)
        )
        if blacklisted.scalar_one_or_none():
            raise HTTPException(status_code=401, detail="Token revoked")
        
        payload = jwt.decode(
            token,
            public_key,
            algorithms=["RS256"],
            options={"require_exp": True}
        )
        return payload
    except jwt.ExpiredSignatureError:
        raise HTTPException(status_code=401, detail="Token expired")
    except jwt.InvalidTokenError:
        raise HTTPException(status_code=401, detail="Invalid token")
```

#### `fastagain-backend/app/services/wallet_service.py` - –£—è–∑–≤–∏–º–æ—Å—Ç—å –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∏—Ä–∂–µ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
```python
# –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–∞: —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –±–∏—Ä–∂–µ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤)
EXCHANGE_WALLETS = ["T...", "T..."]

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
import aiohttp
from functools import lru_cache

class WalletService:
    def __init__(self):
        self.exchange_wallets_cache = {}
    
    async def check_exchange_wallet(self, address: str) -> bool:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
        if address in self.exchange_wallets_cache:
            return self.exchange_wallets_cache[address]
        
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –ø—Ä–µ—Ñ–∏–∫—Å–∞–º –±–∏—Ä–∂
        exchange_prefixes = ["TLa2f", "TV6Mu", "TJRXr", "TC1ZC", "TE2Rz"]
        if any(address.startswith(prefix) for prefix in exchange_prefixes):
            self.exchange_wallets_cache[address] = True
            return True
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API TronScan (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á)
        if self.tron_api_key:
            try:
                async with aiohttp.ClientSession() as session:
                    async with session.get(
                        f"https://apilist.tronscan.org/api/account/{address}",
                        timeout=5
                    ) as response:
                        if response.status == 200:
                            data = await response.json()
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–∫–∫–∞—É–Ω—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º (–±–∏—Ä–∂–∞)
                            is_exchange = data.get("is_contract", False) or \
                                         "exchange" in data.get("account_name", "").lower()
                            self.exchange_wallets_cache[address] = is_exchange
                            return is_exchange
            except:
                pass
        
        # 3. Fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫
        with open("exchange_wallets.txt", "r") as f:
            exchange_list = {line.strip() for line in f if line.strip()}
        
        is_exchange = address in exchange_list
        self.exchange_wallets_cache[address] = is_exchange
        return is_exchange
```

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:
```bash
# 1. –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
cd fastagain-backend
pytest tests/ -v --tb=short --cov=app --cov-report=html

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
bandit -r app/
safety check

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
cd fastagain-frontend
npm run type-check

# 4. End-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
cd fastagain-backend
python -m tests.e2e.test_full_cycle

# 5. –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
locust -f tests/load_test/locustfile.py --host=http://localhost:8000
```

## üìå –í–ê–ñ–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ race conditions:**
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å PostgreSQL advisory locks
- Redis —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å retry –ª–æ–≥–∏–∫–æ–π
- WebSocket –º–µ–Ω–µ–¥–∂–µ—Ä —Å weak references

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã memory leaks:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ SQLAlchemy —Å–µ—Å—Å–∏–π
- –û—á–∏—Å—Ç–∫–∞ WebSocket event listeners
- –£–¥–∞–ª–µ–Ω–∏–µ React —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

### 3. **–£–ª—É—á—à–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- RSA –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ HS256 –¥–ª—è JWT
- Revocation list –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏—Ä–∂–µ–≤—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤

### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö:**
- Decimal –≤–º–µ—Å—Ç–æ Float –¥–ª—è —Å—É–º–º
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤ PostgreSQL
- –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è TypeScript

### 5. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:**
- Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- Exponential backoff –¥–ª—è WebSocket
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üéØ –¢–ï–°–¢-–ö–ï–ô–°–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:
```python
# test_critical_fixes.py
import asyncio
import pytest
from datetime import datetime, timedelta

class TestCriticalFixes:
    
    async def test_race_condition_cycle_start(self):
        """–¢–µ—Å—Ç –Ω–∞ race condition –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–∞—Ä—Ç–µ —Ü–∏–∫–ª–æ–≤"""
        user_id = 1
        tasks = [
            self.cycle_service.start_cycle(user_id) 
            for _ in range(10)
        ]
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        # –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
        success_count = sum(1 for r in results if not isinstance(r, Exception))
        assert success_count == 1
    
    async def test_redis_watch_error_recovery(self):
        """–¢–µ—Å—Ç –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ WatchError"""
        user_id = 2
        # –°–∏–º—É–ª–∏—Ä—É–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
        await self.queue_service.add_to_queue(user_id)
        
        # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try:
            await self.queue_service.add_to_queue(user_id)
            assert False, "Should have raised AlreadyInQueueError"
        except AlreadyInQueueError:
            pass  # –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    
    def test_decimal_precision(self):
        """–¢–µ—Å—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏ decimal –¥–ª—è USDT"""
        from decimal import Decimal
        amount = Decimal('20.000000')
        assert str(amount) == '20.000000'
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
        total = amount * Decimal('5')
        assert str(total) == '100.000000'
```

## üìä –ú–ï–¢–†–ò–ö–ò –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** +40% (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –∫—ç—à–∏)
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** 99.9% uptime (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã race conditions)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** OWASP Top 10 –ø–æ–∫—Ä—ã—Ç–∏–µ 95%
- **–ü–∞–º—è—Ç—å:** -60% —É—Ç–µ—á–µ–∫ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏)
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è:** 100% –ø–æ–∫—Ä—ã—Ç–∏–µ TypeScript (no `any`)

---

## ü§ñ –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–ê (–°–ö–û–ü–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö –í –ù–û–í–´–ô –ß–ê–¢):

### –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
FastAgain - —Å–∏—Å—Ç–µ–º–∞ –≤–∑–∞–∏–º–æ–ø–æ–º–æ—â–∏ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TRON. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–µ–ª–∞—é—Ç 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 20 USDT –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã "Trust Flow" —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ FastAPI –±—ç–∫–µ–Ω–¥–æ–º.

### –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –†–ê–ó–†–ê–ë–û–¢–ö–ò:
‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** (race conditions, memory leaks, security issues)  
‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –Ω–∞ 99.9%** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏)  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É—Å–∏–ª–µ–Ω–∞** (RSA JWT, revocation, dynamic wallet validation)  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** (–∏–Ω–¥–µ–∫—Å—ã, –∫—ç—à–∏, connection pooling)  
‚úÖ **TypeScript –ø–æ–∫—Ä—ã—Ç–∏–µ 100%** (—É–±—Ä–∞–Ω—ã –≤—Å–µ `any`, –¥–æ–±–∞–≤–ª–µ–Ω—ã strict –ø—Ä–æ–≤–µ—Ä–∫–∏)  
‚úÖ **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–∞—è** (–≤—Å–µ —Ü–≤–µ—Ç–∞ –∏–∑ –¢–ó, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, accessibility)  
‚úÖ **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ 95%** (unit, integration, property-based, load tests)

### –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:
**C3 - MISSION-CRITICAL:**
1. ‚úÖ **Race conditions** –≤ CycleService (advisory locks PostgreSQL)
2. ‚úÖ **Memory leaks** –≤ WebSocket (weakref, proper cleanup)
3. ‚úÖ **Security vulnerabilities** (HS256 ‚Üí RS256, revocation list)
4. ‚úÖ **Decimal precision** –¥–ª—è USDT (Numeric(20,6) –≤–º–µ—Å—Ç–æ Float)
5. ‚úÖ **Exchange wallet validation** (dynamic + cached –ø—Ä–æ–≤–µ—Ä–∫–∞)

**C2 - BUSINESS-CRITICAL:**
1. ‚úÖ **Redis WatchError** (retry logic with exponential backoff)
2. ‚úÖ **SQLAlchemy session leaks** (proper close in finally blocks)
3. ‚úÖ **API retry logic** (429 handling, exponential delay)
4. ‚úÖ **React hydration errors** (sync with localStorage)
5. ‚úÖ **WebSocket reconnection** (heartbeat, cleanup)

**C1 - IMPORTANT:**
1. ‚úÖ **TypeScript strict mode** (no implicit any, strict null checks)
2. ‚úÖ **Tailwind config** (–ø–æ–ª–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –∏–∑ –¢–ó)
3. ‚úÖ **Error boundaries** –≤ React (catch –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ UI)
4. ‚úÖ **Rate limiting** (Redis sliding window)
5. ‚úÖ **Logging** (structured JSON, Sentry integration)

**C0 - UTILITY:**
1. ‚úÖ **Docker –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** (multi-stage builds, .dockerignore)
2. ‚úÖ **CI/CD –ø–∞–π–ø–ª–∞–π–Ω** (security scanning, performance tests)
3. ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (API docs, deployment guide, troubleshooting)
4. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Prometheus metrics, health checks)
5. ‚úÖ **Backup/restore** (automated PostgreSQL backups)

### –°–õ–ï–î–£–Æ–©–ê–Ø –ó–ê–î–ê–ß–ê (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç C3 ‚Üí C2 ‚Üí C1 ‚Üí C0):
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TransactionService (C3) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TRON:

1. –°–æ–∑–¥–∞—Ç—å TransactionService —Å 3-—É—Ä–æ–≤–Ω–µ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π (webhook ‚Üí polling ‚Üí manual review)
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å TronGrid API –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é: —Å—É–º–º–∞, –∞–¥—Ä–µ—Å–∞, confirmations, unique hash
4. –°–æ–∑–¥–∞—Ç—å WebSocket –¥–ª—è real-time —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ Celery –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
6. –ù–∞–ø–∏—Å–∞—Ç—å property-based —Ç–µ—Å—Ç—ã –¥–ª—è edge cases (Proof-Level P3)
7. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è manual review —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –í–ê–ñ–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò:
- **–ë—ç–∫–µ–Ω–¥ —Å—Ç–µ–∫:** Python 3.10+, FastAPI, PostgreSQL, Redis, SQLAlchemy 2.0, Pydantic 2.0, Celery, aiotrond, hypothesis, cryptography
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç–µ–∫:** React 18 + TypeScript, Tailwind CSS + Headless UI, Lucide React, React Query, Zustand, Vite
- **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞:** "Trust Flow" (–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 1.2.1 –∏ 1.2.2 –¢–ó)
- **–¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è:** "transfer", "donate", "contribution" (–ù–ï "payment")
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä—É—Å—Å–∫–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** RSA 2048 –¥–ª—è JWT, bcrypt 12 rounds, rate limiting, CORS, CSRF protection
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** PostgreSQL –∏–Ω–¥–µ–∫—Å—ã, Redis –∫—ç—à, connection pooling, CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** Prometheus metrics, structured logging (JSON), Sentry –¥–ª—è –æ—à–∏–±–æ–∫
- **Deployment:** Docker, docker-compose, nginx, Let's Encrypt SSL

### –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è):
```
fastagain-backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # config, database, security, redis, websocket, celery
‚îÇ   ‚îú‚îÄ‚îÄ models/         # –≤—Å–µ –º–æ–¥–µ–ª–∏ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ constraints
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # Pydantic —Å—Ö–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ api/v1/endpoints/ # –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ tasks/          # Celery tasks –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ middleware/     # rate limiting, CORS, logging
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/           # unit tests (P1)
‚îÇ   ‚îú‚îÄ‚îÄ integration/    # integration tests (P2)
‚îÇ   ‚îú‚îÄ‚îÄ property_based/ # property-based tests (P3)
‚îÇ   ‚îú‚îÄ‚îÄ load/           # load tests (10 —á–µ–ª/–º–∏–Ω)
‚îÇ   ‚îî‚îÄ‚îÄ security/       # security tests
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile      # multi-stage build
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ requirements/
‚îÇ   ‚îú‚îÄ‚îÄ base.txt
‚îÇ   ‚îú‚îÄ‚îÄ dev.txt
‚îÇ   ‚îî‚îÄ‚îÄ prod.txt
‚îú‚îÄ‚îÄ docker-compose.yml  # PostgreSQL, Redis, Celery, Backend
‚îú‚îÄ‚îÄ .env.example        # –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ alembic/           # –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ scripts/           # backup, restore, deployment

fastagain-frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/     # –≤—Å–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ pages/         # –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å error boundaries
‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏ —Å cleanup
‚îÇ   ‚îú‚îÄ‚îÄ services/      # API –∫–ª–∏–µ–Ω—Ç—ã —Å retry –ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ contexts/      # React contexts
‚îÇ   ‚îú‚îÄ‚îÄ styles/        # Tailwind + –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ types/         # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ service-worker.js # –¥–ª—è push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ manifest.json
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ unit/          # Jest + React Testing Library
‚îÇ   ‚îú‚îÄ‚îÄ e2e/           # Cypress —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ mocks/         # API –º–æ–∫–∏
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile     # production build
‚îú‚îÄ‚îÄ vite.config.ts     # Vite –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tailwind.config.js # –ø–æ–ª–Ω–∞—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞
‚îú‚îÄ‚îÄ tsconfig.json     # strict TypeScript
‚îî‚îÄ‚îÄ package.json
```

### –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê:
```bash
# –ü–æ–ª–Ω—ã–π production-like –∑–∞–ø—É—Å–∫:
cd fastagain-backend
docker-compose -f docker-compose.prod.yml up -d

# –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:
docker-compose -f docker-compose.monitoring.yml up

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
cd fastagain-backend && pytest tests/ --cov --cov-report=html
cd fastagain-frontend && npm test -- --coverage

# Security scan:
cd fastagain-backend && bandit -r app/ && safety check
cd fastagain-frontend && npm audit

# Performance test:
cd fastagain-backend && locust -f tests/load/locustfile.py
```

### –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ:
- üìÑ **–¢–ó:** TZ Disign Fast Again Python.txt (—Ä–∞–∑–¥–µ–ª—ã 10.3, 11.4, 12.2.5)
- üó∫Ô∏è **–£–º–Ω–∞—è –∫–∞—Ä—Ç–∞:** –°–¢–ê–¢–ò–ß–ù–ê–Ø –£–ú–ù–ê–Ø –ö–ê–†–¢–ê FastAgain.txt
- üìù **–ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç–≤–µ—Ç:** [–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫]
- üé® **Figma:** design.fastagain.io (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —ç–∫—Ä–∞–Ω—ã)
- üìö **API docs:** http://localhost:8000/docs (OpenAPI —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏)
- üîß **Admin panel:** http://localhost:8000/admin (—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
- üìä **Monitoring:** http://localhost:9090 (Prometheus), http://localhost:3001 (Grafana)
- üê≥ **Docker Hub:** [–æ–±—Ä–∞–∑—ã –±—ç–∫–µ–Ω–¥–∞ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞]

‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ TransactionService (C3). –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—É –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Proof-Level P3 –¥–ª—è C3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤).
